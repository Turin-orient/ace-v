## STRATEGIES & INSIGHTS

## FORMULAS & CALCULATIONS

## CODE SNIPPETS & TEMPLATES

[code-00004] helpful=0 harmful=0 :: Regex detection template (pseudo-code): - patterns = { 'PaymentsToAcquireBusinessesGross': [/(?:aggregate\s+|total\s+)?purchase\s+price/i, /cash(?:\s+consideration)?\s+paid/i], 'BusinessCombinationConsiderationTransferred1': [/(?:aggregate\s+)?consideration(?:\s+transferred)?/i], 'BusinessAcquisitionEquityInterestsIssuedOrIssuableNumberOfSharesIssued': [/issued\s+\d[\d,]*/i, /shares\s+issued/i] } - For each numeric token in sentence: find nearest matching pattern within N tokens (N=8). - Assign tag of nearest matched pattern. - If multiple tags at equal distance, apply specificity precedence: purchase_price > cash_paid > consideration. - If no match, fall back to semantic classifier but flag for review.
## COMMON MISTAKES TO AVOID

[err-00003] helpful=0 harmful=0 :: Do not conflate 'purchase price' with 'consideration'. Anti-pattern: tagging both an 'aggregate purchase price of $X' and an 'aggregate consideration of $Y' with the same 'consideration' tag. Concrete prevention: enforce lexical-match-first rule (if 'purchase price' appears, do not map that phrase to BusinessCombinationConsiderationTransferred1). Add a unit-test: example sentence 'aggregate purchase price of $162 million' must map to PaymentsToAcquireBusinessesGross; 'aggregate consideration of $1.2 billion' must map to BusinessCombinationConsiderationTransferred1.
[err-00007] helpful=0 harmful=0 :: Anti-patterns and prevention rules (atomic): - Anti-pattern: mapping any 'per share' price to SaleOfStockPricePerShare without checking instrument class. Prevention: before assigning SaleOfStockPricePerShare check for convertible/preferred/mandatory cues in same sentence; if present, map to convertible-specific price tag. - Anti-pattern: treating 'we sold X shares' as a generic secondary sale when underwriter/overallotment/offer language is present. Prevention: if 'we sold' co-occurs with underwriter/overallotment/overallotment exercise/offer language within ±1 sentence, treat as primary issuance and map share counts to StockIssuedDuringPeriodSharesNewIssues. - Anti-pattern: applying nearest-lexical-match only. Prevention: implement precedence override: instrument-type and offering flags must be evaluated and can override nearest lexical match. - Add unit-tests for regressions: include at least 10 sentences mixing convertible language with 'per share' and 'sold' / 'offered' / 'underwriters' to ensure convertible/issuance tags win over generic sale tags.
[err-00010] helpful=0 harmful=0 :: err-XXXX :: Anti-pattern: blanket-mapping 'availability' -> RemainingBorrowingCapacity. Prevention checklist (atomic):
- Do not assign RemainingBorrowingCapacity solely because the word 'availability' appears. First check for a facility-capacity anchor in same or previous sentence ("has a $X credit facility", "in an aggregate principal amount of up to $X").
- If 'availability' is used in a comparative clause referencing a previously stated cap ("may be less than $X" where X == stated cap), map to MaximumBorrowingCapacity (the sentence is comparing to the contractual cap or describing an effective cap constraint).
- If the phrase contains explicit current-amount tokens ("amount available under the facility totaled", "was available under the facility"), map to RemainingBorrowingCapacity.
- If no anchor and no explicit remaining-amount phrase exist, mark as ambiguous and require human review instead of auto-mapping.
- Add automated unit-tests for both positive and negative examples and log ambiguous cases for retraining.
[err-00014] helpful=0 harmful=0 :: Tie-breaker: prefer instrument-specific mapping over generic financial-category tags when instrument anchor present (atomic prevention rule): - Anti-pattern: mapping an 'interest' currency amount to generic InterestExpense or mapping a 'per annum' percentage to a spread tag without checking instrument context. - Prevention checklist (apply in order): 1) If numeric token is percentage AND 'per annum'/'per year' present AND any instrument-anchor (note/loan/term loan/seller note) in sentence ±1 -> map to DebtInstrumentInterestRateStatedPercentage. 2) If numeric token is currency AND interest lexical cue ('interest charges', 'interest expense', 'interest on') AND instrument-anchor in sentence ±1 -> map to InterestExpenseDebt (link numeric to instrument anchor). 3) If both 'spread'/'margin' and 'per annum' cues occur, prefer per-annum/stated-rate mapping; log conflict for QA. 4) If customer + revenue percent detected, map to ConcentrationRiskPercentage1; do not map to generic 'percentage' tags. 5) If instrument-anchor is absent for interest-charge currency amounts, map to generic InterestExpense and flag for human review; add the sentence to a retraining queue. - Unit-tests: include all examples referenced in the above heuristics and assert instrument-specific tags beat generic alternatives.
## PROBLEM-SOLVING HEURISTICS

[ph-00006] helpful=0 harmful=0 :: Delta decision flow (apply in order for each numeric token): 1) Sentence-level scan: detect instrument-type cues (convertible/preferred/mandatory) and offering cues (underwriters, overallotment, offering language) across the sentence ±1 surrounding sentence. 2) If instrument-type == convertible: - If numeric token is a price or appears adjacent to unit tokens like 'per share', 'per common share', 'per depositary share': assign DebtInstrumentConvertibleConversionPrice1 unless an explicit secondary-market sale cue is present. - If numeric token is shares and offering cues present: assign StockIssuedDuringPeriodSharesNewIssues. 3) If offering cues present (even if instrument-type absent): - If numeric token is number-of-shares -> assign StockIssuedDuringPeriodSharesNewIssues (primary issuance). - If numeric token is price and context uses 'offering price', 'issued at', 'offering at' -> prefer issuance-price tag (if available) else flag for review. 4) If no instrument-type or offering cues: use existing lexical-to-tag mapping (e.g., 'sold' -> SaleOfStockNumberOfSharesIssuedInTransaction) as fallback. 5) Tie-breaker precedence (high -> low): instrument-specific issuance tags (convertible conversion price, mandatory-convertible issuance) > issuance/share-specific tags (StockIssuedDuringPeriodSharesNewIssues) > generic sale tags (SaleOfStock*). 6) Ambiguity handling: if fallback mapping would assign a generic sale tag but any instrument/offering cue matched (score difference < threshold), flag the example and record sentence+reason for human review and training. 7) Unit-test generation examples to add to test suite: - "We sold 17,250,000 shares, including the underwriters' exercise of the overallotment option" -> 17,250,000 = StockIssuedDuringPeriodSharesNewIssues. - "Sempra Energy 6% Mandatory Convertible Preferred Stock, Series A, was issued at $100.00 per share" -> $100.00 = DebtInstrumentConvertibleConversionPrice1. - "We sold 500,000 shares on the open market" -> 500,000 = SaleOfStockNumberOfSharesIssuedInTransaction.
## CONTEXT CLUES & INDICATORS

[ctx-00001] helpful=0 harmful=0 :: Lexical-to-tag mapping (exact cues + variants). Use exact phrase detection before higher-level semantic heuristics. Patterns to detect (case-insensitive): - 'purchase price', 'total purchase price', 'aggregate purchase price' -> tag PaymentsToAcquireBusinessesGross. Regex examples: /(?:aggregate\s+|total\s+)?purchase\s+price/i. - 'consideration', 'consideration transferred', 'aggregate consideration' -> tag BusinessCombinationConsiderationTransferred1. Regex examples: /(?:aggregate\s+)?consideration(?:\s+transferred)?/i. - 'cash paid', 'cash consideration', 'cash consideration paid' -> PaymentsToAcquireBusinessesGross. Regex: /cash(?:\s+consideration)?\s+paid/i. - 'shares issued', 'shares were issued', 'issued X shares' -> BusinessAcquisitionEquityInterestsIssuedOrIssuableNumberOfSharesIssued. Regex: /(?:issued|issued\s+approximately)\s+\d+[\d,]*(?:\s+shares)?/i. Apply these matches to the phrase window that contains the numeric amount (±8 tokens) to ensure the amount belongs to the detected cue.
[ctx-00005] helpful=0 harmful=0 :: Instrument-type detection patterns (case-insensitive regexes and token cues): - Convertible indicators: /\bconvertible\b/, /\bconversion price\b/, /\bconversion cap\b/, /\bconvertible preferred\b/, /\bmandatory convertible\b/, /\bmandatory convertible preferred\b/. - Preferred-stock signals: /\bpreferred stock\b/, /\bseries [A-Z]+\b/, /\bdividend(?:-bearing)?\b/. - Debt-like convertible signals: /\b6% mandatory convertible preferred stock\b/ (literal patterns for numerated series acceptable). Offering / primary-issuance indicators: - underwriters: /\bunderwriter(s)?\b/, /\bwe sold\b/, /boffering\b/, /\boverallotment\b/, /\bexercise[d]?\s+overallotment\b/, /\bprimary offering\b/, /\boffered and sold\b/, /\bpurchased by the underwriters\b/. Sale / secondary-market indicators (inverse cues): /\bwe sold to third parties\b/, /\bsecondary offering\b/, /\btraded on\b/, /\bsold on the market\b/. Numeric association window policy: - Primary association window = ±8 tokens around numeric token. - If an instrument-type cue appears anywhere in the same sentence, treat instrument-type as global for that numeric token (i.e., instrument cues outrank local lexical matches within window). - If offering cue appears in same sentence or adjacent sentence (±1 sentence), mark transaction as primary issuance. Precedence mapping rules (applied after detection): - If instrument-type == convertible AND numeric_context == price -> map numeric to DebtInstrumentConvertibleConversionPrice1 (convertible conversion/issuance price). - If offering_flag == true AND numeric_context == shares -> map numeric to StockIssuedDuringPeriodSharesNewIssues. - If instrument-type == convertible AND offering_flag == true AND numeric_context == shares -> StockIssuedDuringPeriodSharesNewIssues (shares issued in offering of convertible instrument). - Only if no instrument-type OR offering cues detected, or if explicit secondary-sale cues present, fall back to SaleOfStockNumberOfSharesIssuedInTransaction / SaleOfStockPricePerShare. Distance weighting: - When multiple cues present, compute score = (instrument_cue_present ? 10 : 0) + (offering_cue_present ? 8 : 0) + (1 / (1 + token_distance_to_numeric)). Choose tag with highest score. Logging: - If generic sale tag would be selected but instrument-type OR offering cues exist with nonzero score, log for human review and mark as 'contextual-overlap' example for retraining.
[ctx-00008] helpful=0 harmful=0 :: Credit-facility vs spread disambiguation (atomic heuristics):
1) Purpose: ensure currency amounts describing facility capacity map to LineOfCreditFacilityMaximumBorrowingCapacity and percentage 'margin/spread' phrases over LIBOR/ABR map to DebtInstrumentBasisSpreadOnVariableRate1.
2) Exact lexical cues (case-insensitive):
   - Facility-capacity cues (map currency -> LineOfCreditFacilityMaximumBorrowingCapacity): /\b(revolv(?:ing)?\s+credit\s+facilit(?:y|ies)|credit\s+facility|revolver)\b/, /\bin\s+an\s+aggregate\s+principal\s+amount\b/, /\b(up\s+to)\b/, /\bmaximum\s+amount\b/, /\bcommitment\b/.
   - Outstanding/borrowings cues (do NOT map to capacity): /\boutstanding\b/, /\bborrowed\b/, /\bamounts?\s+outstanding\b/, /\bprincipal\s+amounts?\s+outstanding\b/.
   - Spread/margin cues (map percentage -> DebtInstrumentBasisSpreadOnVariableRate1): /\bmargin(s)?\b/, /\bspread(s)?\b/, /\bover\s+(?:LIBOR|ABR|an?\s+index)\b/, /\bin\s+the\s+case\s+of\s+(?:LIBOR|ABR)\s+loan(s)?\b/.
   - Absolute/effective-rate cues (do NOT map to spread): /\binterest\s+rate\b/, /\beffective\s+rate\b/, /\bper annum\b/, /\bAPR\b/.
3) Token association window policy: apply matches to numeric tokens using a ±8-token window for lexical cues and ±1 sentence for facility-level cues (e.g., named facility in prior sentence). If a facility-capacity cue appears anywhere in the same sentence or the immediately preceding sentence, currency amounts within ±16 tokens of that cue are capacity candidates.
4) Precedence rules (apply in order):
   a) If numeric is currency AND a facility-capacity cue matches (within window) -> assign LineOfCreditFacilityMaximumBorrowingCapacity.
   b) If numeric is currency AND an outstanding/borrowings cue matches -> assign outstanding-balance tag (do not map to capacity).
   c) If numeric is a percentage AND a spread/margin cue matches (within ±3 tokens) AND the phrase references LIBOR/ABR/index -> assign DebtInstrumentBasisSpreadOnVariableRate1.
   d) If numeric is a percentage AND absolute/effective-rate cues match (within ±3 tokens) -> assign the appropriate interest-rate tag (do NOT map to basis/spread); if no interest-rate tag exists in taxonomy, flag for human review rather than mapping to spread.
   e) If a conflict exists (e.g., 'margin' and 'interest rate' both present), prefer the more specific cue: 'margin/spread over LIBOR/ABR' > 'interest rate' only when text explicitly says 'margin' or 'spread'; otherwise prefer 'interest rate' mapping.
5) Normalization and token checks:
   - Recognize percentages with % or the word 'percent' or numeric forms like '1.00%–2.00%'.
   - Recognize currency with $ or currency words (dollars, EUR, etc.).
6) Logging & QA:
   - If mapping would assign a spread tag but the sentence contains 'interest rate'/'per annum' within ±3 tokens of the percentage, log as 'potential-rate-vs-spread' for human review and add to targeted unit-tests.
7) Minimal unit-tests to add (atomic examples):
   - "revolving credit facilities in an aggregate principal amount of up to $225.0 million" -> $225.0 million = LineOfCreditFacilityMaximumBorrowingCapacity.
   - "The margin ranges from 1.00% to 2.00% in the case of LIBOR loans" -> 1.00% and 2.00% = DebtInstrumentBasisSpreadOnVariableRate1.
   - "The interest rate is 5.00% per annum" -> 5.00% = interest-rate tag (do NOT map to DebtInstrumentBasisSpreadOnVariableRate1); if interest-rate tag missing, flag for review.
   - "$50 million outstanding under the revolver" -> $50 million = outstanding-balance tag (do NOT map to capacity).
8) Implementation notes (for classifiers / regex pipelines):
   - Apply these patterns before generic lexical-to-tag fallbacks.
   - When multiple tags are plausible, compute priority score where facility-capacity cue adds +10, outstanding cue +12 (to avoid mis-tagging as capacity), spread/margin +10, interest-rate cue +11; choose highest score and log ties.
   - Add examples that mix LIBOR/ABR and 'margin' with numeric ranges to training/regression suites to prevent collapse into absolute-rate tags.
[ctx-00009] helpful=0 harmful=0 :: Credit-facility availability vs capacity — atomic disambiguation rule (apply before generic 'availability' fallback):
1) Purpose: ensure currency amounts that reference facility size/capacity map to LineOfCreditFacilityMaximumBorrowingCapacity and only map to LineOfCreditFacilityRemainingBorrowingCapacity when the sentence explicitly reports a point-in-time available amount.
2) Exact lexical patterns (case-insensitive regexes):
   - Facility-capacity anchor (detect stated cap): /(?:has|has a|has an|in an aggregate principal amount of|in an aggregate amount of|in an aggregate principal amount of up to|up to)\s+\$?[\d,]+(?:\.\d+)?\s*(?:million|billion)?\s*(?:revolv(?:ing)?\s+credit\s+facilit(?:y|ies)|credit\s+facility|revolver)/i
   - Explicit remaining-amount cues (map to remaining borrowing capacity): /(?:amount available under the (?:credit )?facility(?: totaled|was|is)|available under the facility totaled|was available under the facility|amount available under the facility is)\b/i
   - Comparative/constraint cues (signal comparison to a stated cap): /availability\s+(?:under|of)\s+(?:this|the)?\s*(?:credit )?facilit(?:y|ies)\s+may\s+be\s+less\s+than\s+\$?[\d,]+(?:\.\d+)?/i, /may\s+be\s+less\s+than\b/i, /as\s+a\s+result\s+of\b/i, /for\s+certain\s+subsidiaries\b/i, /for\s+specific\s+entities\b/i
3) Association windows and antecedent resolution:
   - If a facility-capacity anchor (pattern above) appears anywhere in the same sentence OR in the immediately preceding sentence, consider that dollar amount the canonical facility maximum for subsequent comparative/availability clauses. (Sentence window = ±1 sentence.)
   - Token association: when anchored, allow currency amounts in comparative clauses up to ±16 tokens from the comparative phrase to be treated as referencing the stated cap.
4) Precedence decision flow (apply in order):
   a) If numeric is currency AND explicit remaining-amount cues match (within ±8 tokens) -> assign LineOfCreditFacilityRemainingBorrowingCapacity.
   b) Else if numeric is currency AND comparative/constraint cue matches (e.g., "availability may be less than $X") AND X equals the earlier-detected facility-capacity anchor amount (or the sentence contains a nearby explicit facility-capacity anchor) -> assign LineOfCreditFacilityMaximumBorrowingCapacity (the phrase is comparing to the contractual cap or describing effective cap reductions).
   c) Else if numeric is currency AND comparative/constraint cue matches BUT no prior anchor exists: if clause contains constraint markers ('as a result of', 'for certain subsidiaries', 'for specific entities', 'may be less than') prefer MaximumBorrowingCapacity (treat as described cap limit) but mark as 'ambiguous-availability-without-anchor' and log for review.
   d) Else if numeric is currency AND no comparative/anchor cues but lexical 'availability' appears alone (no 'amount available', no 'totaled') -> treat as ambiguous: do NOT auto-assign RemainingBorrowingCapacity; instead prefer MaximumBorrowingCapacity only if a facility-capacity anchor exists in same or previous sentence; otherwise flag for human review.
5) Tie-breaker and override: facility-capacity anchor presence overrides the naive 'availability -> remaining' rule. Explicit remaining-amount lexical patterns override capacity mapping and must map to RemainingBorrowingCapacity regardless of anchors.
6) Examples / unit-tests (add to targeted suite):
   - "The Company has a $75 million revolving credit facility (credit facility)" -> $75 million = LineOfCreditFacilityMaximumBorrowingCapacity.
   - "availability under this credit facility may be less than $75 million as a result of outstanding letters of credit..." -> $75 million = LineOfCreditFacilityMaximumBorrowingCapacity (because X matches stated cap and clause is comparative/constraint).
   - "an outstanding letter of credit under the credit facility totaled $12.5 million and the amount available under the facility totaled $62.5 million" -> $12.5M = LettersOfCreditOutstandingAmount; $62.5M = LineOfCreditFacilityRemainingBorrowingCapacity (explicit remaining-amount cue).
   - "availability under the facility may be less than $40 million" (no prior stated cap mentioned) -> flag 'ambiguous-availability-without-anchor' and queue for human review (do not auto-assign RemainingBorrowingCapacity).
7) Logging & QA: any case where 'availability' appears but the rule chooses MaximumBorrowingCapacity only because of an antecedent anchor must be logged as 'availability-referenced-cap' with the anchor span and numeric comparison; ambiguous/no-anchor cases must be logged as 'ambiguous-availability' and added to training data.
8) Implementation notes: incorporate these checks before any generic lexical mapping that equates 'availability' -> remaining capacity; add unit-tests above and regressions that ensure 'amount available' still maps to RemainingBorrowingCapacity.
[ctx-00011] helpful=0 harmful=0 :: Interest-rate 'per annum' -> DebtInstrumentInterestRateStatedPercentage (atomic heuristic): - Purpose: map percentages expressed as annual/stated interest rates on named debt instruments to DebtInstrumentInterestRateStatedPercentage. - Exact lexical cues (case-insensitive regexes): /(per\s+annum|per\s+year|annually|annual\s+rate|%\s+per\s+annum|APR)\b/ and instrument anchors: /\b(note|notes|loan|loans|seller\s+note|senior\s+notes|term\s+loan|revolver|debt\b)/i. - Association window: require both a percentage token and at least one instrument-anchor token in the same sentence OR instrument-anchor within the previous sentence (±1 sentence). If instrument name present in same sentence, require token-distance <= 12 tokens; if in prior sentence, allow <= 40 token span across sentence boundary. - Precedence: If 'per annum' (or equivalent) is detected within ±3 tokens of the percentage, prefer DebtInstrumentInterestRateStatedPercentage over spread/basis tags. - Conflict rule: If both 'margin'/'spread' cues and 'per annum' cues are present, prefer 'per annum' -> stated-rate mapping, but log as 'rate-vs-spread-conflict' for QA. - Unit-tests/examples: - "8% per annum on the Seller Notes" -> 8% = DebtInstrumentInterestRateStatedPercentage (anchor 'Seller Notes'). - "The interest rate is 5.00% per year on the term loan" -> 5.00% = DebtInstrumentInterestRateStatedPercentage. - Implementation note: apply before generic percentage-to-spread fallbacks.
[ctx-00012] helpful=0 harmful=0 :: Monetary 'interest charges' mapping to instrument-specific InterestExpenseDebt (atomic heuristic): - Purpose: ensure currency amounts described as interest charges/interest expense tied to a particular note/loan map to InterestExpenseDebt (and are linked to the instrument identity) rather than a generic InterestExpense tag. - Exact lexical cues (case-insensitive regexes): /interest\s+charge(s)?\b/, /interest\s+expense(s)?\b/, /interest\s+cost(s)?\b/, /(interest\s+charges)\s+associated\s+with/, /interest\s+relating\s+to/, /interest\s+on\s+the\s+(?:note|notes|loan|loan\s+agreement)/i. - Association policy: require a currency token (e.g., $179,507) in same sentence and an instrument anchor (note/loan name like 'Seller Notes') in same sentence OR previous sentence. Primary token-distance window = ±12 tokens around numeric; allow ±1 sentence antecedent resolution with span <= 40 tokens. - Precedence: instrument-specific InterestExpenseDebt overrides generic InterestExpense when instrument anchor present. If instrument anchor not present, map to generic InterestExpense and flag 'interest-amount-no-instrument' for review. - Unit-tests/examples: - "$179,507 of interest charges associated with the Seller Notes for the year" -> $179,507 = InterestExpenseDebt (linked to Seller Notes). - "$331,397 of interest expense for the six months ended June 30 related to the Term Loan" -> $331,397 = InterestExpenseDebt. - Logging: record sentence span and instrument anchor for any instrument-linked interest mapping for traceability.
[ctx-00013] helpful=0 harmful=0 :: Customer-concentration percentage mapping -> ConcentrationRiskPercentage1 (atomic heuristic): - Purpose: map percentages that quantify customer concentration of revenues to ConcentrationRiskPercentage1. - Exact lexical cues/patterns (case-insensitive regexes): /(?:two|three|top|largest|the\s+two\s+largest|the\s+largest)\s+customers\b/, /customer\s+concentration\b/, /accounts?\s+for\s+about|accounted\s+for\s+approximately|accounted\s+for\s+|represent(s|ed)\s+approximately\s+\d+\%/i. Percentage capture window: detect percentage token within ±10 tokens of customer/revenue cue and/or the phrase 'of (our|the)? revenues' or 'of revenue'. - Precedence: when percentage is explicitly tied to 'customers' + 'revenues', map to ConcentrationRiskPercentage1 even if other percentage-tag candidates exist. - Unit-tests/examples: - "Our two largest customers accounted for approximately 44% of our revenues" -> 44% = ConcentrationRiskPercentage1. - "The largest customer represented 22% of revenue" -> 22% = ConcentrationRiskPercentage1. - Ambiguity handling: if percent lacks 'customer' anchor but 'of revenues' alone appears, mark as potential concentration and log for human review.
## OTHERS
[misc-00002] helpful=0 harmful=0 :: Micro decision flow for acquisition-related monetary phrases (apply in order): 1) Search sentence (or immediate surrounding sentence ±1) for the exact phrase variants from the lexical-to-tag mapping. 2) If only one cue matches, assign the corresponding tag. 3) If multiple cues match, choose the cue whose token span is closest to the numeric amount (measure token-distance from numeric token to cue span). 4) If both cues are equidistant or no numeric amount is present, break ties by cue specificity: ('purchase price' > 'cash paid' > 'consideration'). 5) If still ambiguous, prefer PaymentsToAcquireBusinessesGross when the sentence explicitly mentions payments, cash, or amounts described as 'paid' or 'paid as part of the acquisition'; prefer BusinessCombinationConsiderationTransferred1 only when the text uses 'consideration' or explicitly 'consideration transferred' and describes the composition of consideration (e.g., cash + shares + other instruments). 6) Log ambiguous cases for human review and add the sentence to a short test-suite.