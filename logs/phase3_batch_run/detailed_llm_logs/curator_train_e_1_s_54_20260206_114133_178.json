{
  "role": "curator",
  "call_id": "train_e_1_s_54",
  "model": "gpt-5-mini",
  "prompt": "# ACE CONTEXT ENGINEERING: CURATOR AGENT\n\nYou are a Curator in the Agentic Context Engineering (ACE) system. Your goal is to maintain a \"living playbook\" of insights.\n\n## GOAL\nIdentify HIGH-SIGNAL, DELTA updates for the playbook based on recent failure analysis.\n\n## CONTEXT ENGINEERING PRINCIPLES\n1. **DELTA UPDATES ONLY**: Do not rewrite what is already there. Only identify what is MISSING.\n2. **CONTEXT-LEAN**: Avoid generic advice. Provide specific, actionable heuristics (domain-specific rules).\n3. **NO CONTEXT COLLAPSE**: Preserve the detail. Bullet points should be exhaustive enough to be useful but atomic enough to be individual units of knowledge.\n\n## CURRENT STATE\n- Token Budget: 1000\n- Progress: Sample 54/1000\n\n### Playbook Statistics\n{\n  \"total_bullets\": 47,\n  \"high_performing\": 0,\n  \"problematic\": 14,\n  \"unused\": 25,\n  \"by_section\": {\n    \"CODE SNIPPETS & TEMPLATES\": {\n      \"count\": 1,\n      \"helpful\": 0,\n      \"harmful\": 0\n    },\n    \"COMMON MISTAKES TO AVOID\": {\n      \"count\": 7,\n      \"helpful\": 2,\n      \"harmful\": 0\n    },\n    \"PROBLEM-SOLVING HEURISTICS\": {\n      \"count\": 1,\n      \"helpful\": 1,\n      \"harmful\": 0\n    },\n    \"CONTEXT CLUES & INDICATORS\": {\n      \"count\": 37,\n      \"helpful\": 11,\n      \"harmful\": 16\n    },\n    \"OTHERS\": {\n      \"count\": 1,\n      \"helpful\": 0,\n      \"harmful\": 1\n    }\n  }\n}\n\n### Input Data\n**Recent Reflection (The Diagnosis):**\n{\n  \"reasoning\": \"I examined the sentences and focused on the numeric tokens 3.88% and 5.00% and their lexical environment. In each sentence the percent token is immediately tied to the word 'notes' (instrument anchor). That pattern — a percent number directly modifying a debt instrument ('note(s)') — semantically denotes the stated coupon/interest rate of the debt. Alternative tags (for example spread, basis, fair value amounts, or carrying amounts) are not signaled by the wording: there are no words like 'spread', 'basis', 'margin', or 'yield' nor is the percent presented as a fair value amount. Therefore the correct US GAAP tag is DebtInstrumentInterestRateStatedPercentage for each of the four entities. The model applied the percent+instrument-anchor heuristic consistently and correctly in both the valuation (Level 2 fair value) and carrying-amount contexts.\",\n  \"error_identification\": \"No substantive error — the model's reasoning and final tag assignments match the ground truth. There were no mislabels or calculation mistakes.\",\n  \"root_cause_analysis\": \"Not applicable because there was no mistake. A potential minor risk (not realized here) is overfocusing on surrounding context words like 'fair values' or 'carrying amounts' and misclassifying a percent as a valuation metric; the model avoided that by prioritizing the percent + debt-instrument anchor relation.\",\n  \"correct_approach\": \"Continue using the instrument-anchor heuristic: when a percent immediately modifies or is tied to a debt instrument (notes, bonds, etc.), tag it as DebtInstrumentInterestRateStatedPercentage. Only consider alternative tags (e.g., spread, effective rate) if explicit cues such as 'spread', 'basis points', 'effective', 'yield', or references to floating rate indices are present.\",\n  \"key_insight\": \"Rule of thumb: percent tokens coupled with a debt instrument noun (note, bond) → DebtInstrumentInterestRateStatedPercentage. Look for explicit cues (spread/margin/yield/effective) before assigning spread/basis/effective-rate tags.\",\n  \"bullet_tags\": []\n}\n\n**Current Playbook (The Knowledge Base):**\n## STRATEGIES & INSIGHTS\n\n## FORMULAS & CALCULATIONS\n\n## CODE SNIPPETS & TEMPLATES\n\n[code-00004] helpful=0 harmful=0 :: Regex detection template (pseudo-code): - patterns = { 'PaymentsToAcquireBusinessesGross': [/(?:aggregate\\s+|total\\s+)?purchase\\s+price/i, /cash(?:\\s+consideration)?\\s+paid/i], 'BusinessCombinationConsiderationTransferred1': [/(?:aggregate\\s+)?consideration(?:\\s+transferred)?/i], 'BusinessAcquisitionEquityInterestsIssuedOrIssuableNumberOfSharesIssued': [/issued\\s+\\d[\\d,]*/i, /shares\\s+issued/i] } - For each numeric token in sentence: find nearest matching pattern within N tokens (N=8). - Assign tag of nearest matched pattern. - If multiple tags at equal distance, apply specificity precedence: purchase_price > cash_paid > consideration. - If no match, fall back to semantic classifier but flag for review.\n## COMMON MISTAKES TO AVOID\n\n[err-00003] helpful=0 harmful=0 :: Do not conflate 'purchase price' with 'consideration'. Anti-pattern: tagging both an 'aggregate purchase price of $X' and an 'aggregate consideration of $Y' with the same 'consideration' tag. Concrete prevention: enforce lexical-match-first rule (if 'purchase price' appears, do not map that phrase to BusinessCombinationConsiderationTransferred1). Add a unit-test: example sentence 'aggregate purchase price of $162 million' must map to PaymentsToAcquireBusinessesGross; 'aggregate consideration of $1.2 billion' must map to BusinessCombinationConsiderationTransferred1.\n[err-00007] helpful=0 harmful=0 :: Anti-patterns and prevention rules (atomic): - Anti-pattern: mapping any 'per share' price to SaleOfStockPricePerShare without checking instrument class. Prevention: before assigning SaleOfStockPricePerShare check for convertible/preferred/mandatory cues in same sentence; if present, map to convertible-specific price tag. - Anti-pattern: treating 'we sold X shares' as a generic secondary sale when underwriter/overallotment/offer language is present. Prevention: if 'we sold' co-occurs with underwriter/overallotment/overallotment exercise/offer language within ±1 sentence, treat as primary issuance and map share counts to StockIssuedDuringPeriodSharesNewIssues. - Anti-pattern: applying nearest-lexical-match only. Prevention: implement precedence override: instrument-type and offering flags must be evaluated and can override nearest lexical match. - Add unit-tests for regressions: include at least 10 sentences mixing convertible language with 'per share' and 'sold' / 'offered' / 'underwriters' to ensure convertible/issuance tags win over generic sale tags.\n[err-00010] helpful=0 harmful=0 :: err-XXXX :: Anti-pattern: blanket-mapping 'availability' -> RemainingBorrowingCapacity. Prevention checklist (atomic):\n- Do not assign RemainingBorrowingCapacity solely because the word 'availability' appears. First check for a facility-capacity anchor in same or previous sentence (\"has a $X credit facility\", \"in an aggregate principal amount of up to $X\").\n- If 'availability' is used in a comparative clause referencing a previously stated cap (\"may be less than $X\" where X == stated cap), map to MaximumBorrowingCapacity (the sentence is comparing to the contractual cap or describing an effective cap constraint).\n- If the phrase contains explicit current-amount tokens (\"amount available under the facility totaled\", \"was available under the facility\"), map to RemainingBorrowingCapacity.\n- If no anchor and no explicit remaining-amount phrase exist, mark as ambiguous and require human review instead of auto-mapping.\n- Add automated unit-tests for both positive and negative examples and log ambiguous cases for retraining.\n[err-00014] helpful=0 harmful=0 :: Tie-breaker: prefer instrument-specific mapping over generic financial-category tags when instrument anchor present (atomic prevention rule): - Anti-pattern: mapping an 'interest' currency amount to generic InterestExpense or mapping a 'per annum' percentage to a spread tag without checking instrument context. - Prevention checklist (apply in order): 1) If numeric token is percentage AND 'per annum'/'per year' present AND any instrument-anchor (note/loan/term loan/seller note) in sentence ±1 -> map to DebtInstrumentInterestRateStatedPercentage. 2) If numeric token is currency AND interest lexical cue ('interest charges', 'interest expense', 'interest on') AND instrument-anchor in sentence ±1 -> map to InterestExpenseDebt (link numeric to instrument anchor). 3) If both 'spread'/'margin' and 'per annum' cues occur, prefer per-annum/stated-rate mapping; log conflict for QA. 4) If customer + revenue percent detected, map to ConcentrationRiskPercentage1; do not map to generic 'percentage' tags. 5) If instrument-anchor is absent for interest-charge currency amounts, map to generic InterestExpense and flag for human review; add the sentence to a retraining queue. - Unit-tests: include all examples referenced in the above heuristics and assert instrument-specific tags beat generic alternatives.\n[err-00002] helpful=1 harmful=0 :: Atomic negation-to-zero rule for availability quantities (prevention of treating negation as 'absent' rather than numeric zero). Purpose: ensure explicit negative availability phrases ('no', 'none', 'not available') are normalized to numeric zero for quantity tags and mapped to the most specific availability tag. Rules:\n1) Negation cues (case-insensitive regex examples): /\\bno\\b/, /\\bnone\\b/, /\\bnot\\s+available\\b/, /\\bthere\\s+are\\s+no\\b/, /\\bzero\\b/ within ±6 tokens of an availability noun ('available', 'remain', 'remain\\s+available', 'available\\s+for\\s+grant').\n2) Quantity mapping: when negation cue co-occurs with availability noun and a plan/instrument anchor as applicable (e.g., 'under the Plan', 'under the facility'), assign numeric value 0 and map to the specific quantity tag (e.g., ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant = 0; LineOfCreditFacilityRemainingBorrowingCapacity = $0 when explicit 'amount available under the facility was $0' or 'no availability under the credit facility').\n3) Scope constraints (do NOT apply universal zero conversion): do not convert negations that apply to non-quantity facts or idiomatic phrases ('no material impact', 'no change', 'no further details'); require proximity to a numeric/quantity noun and an anchor.\n4) Tag-type constraint: only auto-convert to zero for quantity/amount-of-shares/remaining-capacity numeric tags; do not auto-convert percentages unless explicit context indicates 'zero percent' (e.g., 'no revenue' vs 'zero percent of revenue' are different; flag ambiguous percent-negations for review).\n5) Token-window & antecedent resolution: allow antecedent anchors in previous sentence up to ±1 sentence when anaphoric phrase 'the Plan'/'the facility' is used; require confidence threshold for cross-sentence negation mapping; otherwise flag for human review.\n6) Unit-tests/examples to add:\n   - 'no shares remain available under the 2014 Long Term Incentive Plan' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant = 0.\n   - 'There are no amounts available under the credit facility' -> LineOfCreditFacilityRemainingBorrowingCapacity = 0.\n   - 'No material impact was expected' -> do NOT map to any numeric tag (must be filtered by scope constraint).\n7) Logging: any auto-zero assignment should be recorded with the negation cue span and the anchor span for traceability and QA.\n[err-00004] helpful=1 harmful=0 :: Anti-pattern prevention: Do not map currency amounts labeled as 'interest charges'/'interest expense' to generic InterestExpense when an instrument-anchor is present; instead map to InterestExpenseDebt and normalize explicit zeros. - Exact lexical cues (case-insensitive): /interest\\s+charge(s)?\\b/, /interest\\s+expense(s)?\\b/, /interest\\s+on\\s+the\\s+(note|notes|loan|term\\s+loan|seller\\s+note|revolver)/i. - Instrument-anchor detection: detect instrument names (Seller Notes, Term Loan, Revolver, Senior Notes, etc.) in same sentence OR previous sentence (allow antecedent resolution up to ±1 sentence and span <= 40 tokens). - Association window: currency numeric token within ±12 tokens of interest lexical cue (primary) and instrument-anchor within ±40 tokens across sentence boundary if needed. - Mapping rule: if both interest lexical cue and instrument-anchor present -> assign InterestExpenseDebt (link numeric to instrument id). If interest lexical cue present but no instrument-anchor -> assign generic InterestExpense and flag 'interest-amount-no-instrument' for review. - Zero/numeric normalization: if the numeric token is explicit 'zero', 'no interest', 'none' appearing within ±6 tokens of interest lexical cue and instrument-anchor present, normalize to numeric 0 and assign InterestExpenseDebt = 0; log negation cue span and anchor span for traceability. - Precedence: this instrument-specific mapping overrides any generic expense or cash-flow tag. - Unit-tests (atomic): - '$179,507 of interest charges associated with the Seller Notes for the year' -> $179,507 = InterestExpenseDebt (Seller Notes). - 'No interest expense was recorded on the Term Loan' -> InterestExpenseDebt = 0 (Term Loan), logged. - '$331,397 of interest expense for the six months ended June 30 related to the Term Loan' -> $331,397 = InterestExpenseDebt. - Logging: record instrument anchor span and interest phrase span for each mapping for QA and retraining; aggregate 'interest-amount-no-instrument' cases into review queue.\n[err-00014] helpful=0 harmful=0 :: Atomic mistake-prevention: Do not default 'payments to external party' -> BusinessCombinationConsiderationTransferred1 without explicit acquisition-composition cues.\n\n1) Anti-pattern: mapping any scheduled or dated payments to an outside counterparty as acquisition consideration simply because the payment is to a third party.\n\n2) Prevention checklist (atomic):\n  - Before assigning BusinessCombinationConsiderationTransferred1 to any numeric in a payment clause, REQUIRE either (A) a positive-acquisition cue (see context_clues_and_indicators rule) AND an explicit composition phrase tying those numerics to consideration/purchase, OR (B) a heading/section context that labels the clause as 'Acquisition', 'Purchase', 'Business combination', or similar within ±2 sentences.\n  - If the sentence contains words 'installment', 'installments', date tokens for multiple scheduled payments, or enumerated first/second/third payments AND acquisition-cues are absent, default to RepaymentsOfDebt.\n  - If acquisition-cue exists but only in the prior section header (more than ±2 sentences away) and no composition phrase present, DO NOT map to BusinessCombinationConsiderationTransferred1 automatically — flag for review.\n\n3) Unit-tests to add to regression: include the example from the reflection and other borderline cases where 'installment' appears without 'purchase/consideration' words to ensure RepaymentsOfDebt wins.\n\n4) Logging requirement: any override where a payment was mapped to BusinessCombinationConsiderationTransferred1 despite the presence of installment-schedule cues must be logged as 'payment-to-party-acquisition-override' and manually inspected for false positives.\n## PROBLEM-SOLVING HEURISTICS\n\n[ph-00006] helpful=1 harmful=0 :: Delta decision flow (apply in order for each numeric token): 1) Sentence-level scan: detect instrument-type cues (convertible/preferred/mandatory) and offering cues (underwriters, overallotment, offering language) across the sentence ±1 surrounding sentence. 2) If instrument-type == convertible: - If numeric token is a price or appears adjacent to unit tokens like 'per share', 'per common share', 'per depositary share': assign DebtInstrumentConvertibleConversionPrice1 unless an explicit secondary-market sale cue is present. - If numeric token is shares and offering cues present: assign StockIssuedDuringPeriodSharesNewIssues. 3) If offering cues present (even if instrument-type absent): - If numeric token is number-of-shares -> assign StockIssuedDuringPeriodSharesNewIssues (primary issuance). - If numeric token is price and context uses 'offering price', 'issued at', 'offering at' -> prefer issuance-price tag (if available) else flag for review. 4) If no instrument-type or offering cues: use existing lexical-to-tag mapping (e.g., 'sold' -> SaleOfStockNumberOfSharesIssuedInTransaction) as fallback. 5) Tie-breaker precedence (high -> low): instrument-specific issuance tags (convertible conversion price, mandatory-convertible issuance) > issuance/share-specific tags (StockIssuedDuringPeriodSharesNewIssues) > generic sale tags (SaleOfStock*). 6) Ambiguity handling: if fallback mapping would assign a generic sale tag but any instrument/offering cue matched (score difference < threshold), flag the example and record sentence+reason for human review and training. 7) Unit-test generation examples to add to test suite: - \"We sold 17,250,000 shares, including the underwriters' exercise of the overallotment option\" -> 17,250,000 = StockIssuedDuringPeriodSharesNewIssues. - \"Sempra Energy 6% Mandatory Convertible Preferred Stock, Series A, was issued at $100.00 per share\" -> $100.00 = DebtInstrumentConvertibleConversionPrice1. - \"We sold 500,000 shares on the open market\" -> 500,000 = SaleOfStockNumberOfSharesIssuedInTransaction.\n## CONTEXT CLUES & INDICATORS\n\n[ctx-00001] helpful=0 harmful=2 :: Lexical-to-tag mapping (exact cues + variants). Use exact phrase detection before higher-level semantic heuristics. Patterns to detect (case-insensitive): - 'purchase price', 'total purchase price', 'aggregate purchase price' -> tag PaymentsToAcquireBusinessesGross. Regex examples: /(?:aggregate\\s+|total\\s+)?purchase\\s+price/i. - 'consideration', 'consideration transferred', 'aggregate consideration' -> tag BusinessCombinationConsiderationTransferred1. Regex examples: /(?:aggregate\\s+)?consideration(?:\\s+transferred)?/i. - 'cash paid', 'cash consideration', 'cash consideration paid' -> PaymentsToAcquireBusinessesGross. Regex: /cash(?:\\s+consideration)?\\s+paid/i. - 'shares issued', 'shares were issued', 'issued X shares' -> BusinessAcquisitionEquityInterestsIssuedOrIssuableNumberOfSharesIssued. Regex: /(?:issued|issued\\s+approximately)\\s+\\d+[\\d,]*(?:\\s+shares)?/i. Apply these matches to the phrase window that contains the numeric amount (±8 tokens) to ensure the amount belongs to the detected cue.\n[ctx-00005] helpful=0 harmful=1 :: Instrument-type detection patterns (case-insensitive regexes and token cues): - Convertible indicators: /\\bconvertible\\b/, /\\bconversion price\\b/, /\\bconversion cap\\b/, /\\bconvertible preferred\\b/, /\\bmandatory convertible\\b/, /\\bmandatory convertible preferred\\b/. - Preferred-stock signals: /\\bpreferred stock\\b/, /\\bseries [A-Z]+\\b/, /\\bdividend(?:-bearing)?\\b/. - Debt-like convertible signals: /\\b6% mandatory convertible preferred stock\\b/ (literal patterns for numerated series acceptable). Offering / primary-issuance indicators: - underwriters: /\\bunderwriter(s)?\\b/, /\\bwe sold\\b/, /boffering\\b/, /\\boverallotment\\b/, /\\bexercise[d]?\\s+overallotment\\b/, /\\bprimary offering\\b/, /\\boffered and sold\\b/, /\\bpurchased by the underwriters\\b/. Sale / secondary-market indicators (inverse cues): /\\bwe sold to third parties\\b/, /\\bsecondary offering\\b/, /\\btraded on\\b/, /\\bsold on the market\\b/. Numeric association window policy: - Primary association window = ±8 tokens around numeric token. - If an instrument-type cue appears anywhere in the same sentence, treat instrument-type as global for that numeric token (i.e., instrument cues outrank local lexical matches within window). - If offering cue appears in same sentence or adjacent sentence (±1 sentence), mark transaction as primary issuance. Precedence mapping rules (applied after detection): - If instrument-type == convertible AND numeric_context == price -> map numeric to DebtInstrumentConvertibleConversionPrice1 (convertible conversion/issuance price). - If offering_flag == true AND numeric_context == shares -> map numeric to StockIssuedDuringPeriodSharesNewIssues. - If instrument-type == convertible AND offering_flag == true AND numeric_context == shares -> StockIssuedDuringPeriodSharesNewIssues (shares issued in offering of convertible instrument). - Only if no instrument-type OR offering cues detected, or if explicit secondary-sale cues present, fall back to SaleOfStockNumberOfSharesIssuedInTransaction / SaleOfStockPricePerShare. Distance weighting: - When multiple cues present, compute score = (instrument_cue_present ? 10 : 0) + (offering_cue_present ? 8 : 0) + (1 / (1 + token_distance_to_numeric)). Choose tag with highest score. Logging: - If generic sale tag would be selected but instrument-type OR offering cues exist with nonzero score, log for human review and mark as 'contextual-overlap' example for retraining.\n[ctx-00008] helpful=1 harmful=1 :: Credit-facility vs spread disambiguation (atomic heuristics):\n1) Purpose: ensure currency amounts describing facility capacity map to LineOfCreditFacilityMaximumBorrowingCapacity and percentage 'margin/spread' phrases over LIBOR/ABR map to DebtInstrumentBasisSpreadOnVariableRate1.\n2) Exact lexical cues (case-insensitive):\n   - Facility-capacity cues (map currency -> LineOfCreditFacilityMaximumBorrowingCapacity): /\\b(revolv(?:ing)?\\s+credit\\s+facilit(?:y|ies)|credit\\s+facility|revolver)\\b/, /\\bin\\s+an\\s+aggregate\\s+principal\\s+amount\\b/, /\\b(up\\s+to)\\b/, /\\bmaximum\\s+amount\\b/, /\\bcommitment\\b/.\n   - Outstanding/borrowings cues (do NOT map to capacity): /\\boutstanding\\b/, /\\bborrowed\\b/, /\\bamounts?\\s+outstanding\\b/, /\\bprincipal\\s+amounts?\\s+outstanding\\b/.\n   - Spread/margin cues (map percentage -> DebtInstrumentBasisSpreadOnVariableRate1): /\\bmargin(s)?\\b/, /\\bspread(s)?\\b/, /\\bover\\s+(?:LIBOR|ABR|an?\\s+index)\\b/, /\\bin\\s+the\\s+case\\s+of\\s+(?:LIBOR|ABR)\\s+loan(s)?\\b/.\n   - Absolute/effective-rate cues (do NOT map to spread): /\\binterest\\s+rate\\b/, /\\beffective\\s+rate\\b/, /\\bper annum\\b/, /\\bAPR\\b/.\n3) Token association window policy: apply matches to numeric tokens using a ±8-token window for lexical cues and ±1 sentence for facility-level cues (e.g., named facility in prior sentence). If a facility-capacity cue appears anywhere in the same sentence or the immediately preceding sentence, currency amounts within ±16 tokens of that cue are capacity candidates.\n4) Precedence rules (apply in order):\n   a) If numeric is currency AND a facility-capacity cue matches (within window) -> assign LineOfCreditFacilityMaximumBorrowingCapacity.\n   b) If numeric is currency AND an outstanding/borrowings cue matches -> assign outstanding-balance tag (do not map to capacity).\n   c) If numeric is a percentage AND a spread/margin cue matches (within ±3 tokens) AND the phrase references LIBOR/ABR/index -> assign DebtInstrumentBasisSpreadOnVariableRate1.\n   d) If numeric is a percentage AND absolute/effective-rate cues match (within ±3 tokens) -> assign the appropriate interest-rate tag (do NOT map to basis/spread); if no interest-rate tag exists in taxonomy, flag for human review rather than mapping to spread.\n   e) If a conflict exists (e.g., 'margin' and 'interest rate' both present), prefer the more specific cue: 'margin/spread over LIBOR/ABR' > 'interest rate' only when text explicitly says 'margin' or 'spread'; otherwise prefer 'interest rate' mapping.\n5) Normalization and token checks:\n   - Recognize percentages with % or the word 'percent' or numeric forms like '1.00%–2.00%'.\n   - Recognize currency with $ or currency words (dollars, EUR, etc.).\n6) Logging & QA:\n   - If mapping would assign a spread tag but the sentence contains 'interest rate'/'per annum' within ±3 tokens of the percentage, log as 'potential-rate-vs-spread' for human review and add to targeted unit-tests.\n7) Minimal unit-tests to add (atomic examples):\n   - \"revolving credit facilities in an aggregate principal amount of up to $225.0 million\" -> $225.0 million = LineOfCreditFacilityMaximumBorrowingCapacity.\n   - \"The margin ranges from 1.00% to 2.00% in the case of LIBOR loans\" -> 1.00% and 2.00% = DebtInstrumentBasisSpreadOnVariableRate1.\n   - \"The interest rate is 5.00% per annum\" -> 5.00% = interest-rate tag (do NOT map to DebtInstrumentBasisSpreadOnVariableRate1); if interest-rate tag missing, flag for review.\n   - \"$50 million outstanding under the revolver\" -> $50 million = outstanding-balance tag (do NOT map to capacity).\n8) Implementation notes (for classifiers / regex pipelines):\n   - Apply these patterns before generic lexical-to-tag fallbacks.\n   - When multiple tags are plausible, compute priority score where facility-capacity cue adds +10, outstanding cue +12 (to avoid mis-tagging as capacity), spread/margin +10, interest-rate cue +11; choose highest score and log ties.\n   - Add examples that mix LIBOR/ABR and 'margin' with numeric ranges to training/regression suites to prevent collapse into absolute-rate tags.\n[ctx-00009] helpful=1 harmful=1 :: Credit-facility availability vs capacity — atomic disambiguation rule (apply before generic 'availability' fallback):\n1) Purpose: ensure currency amounts that reference facility size/capacity map to LineOfCreditFacilityMaximumBorrowingCapacity and only map to LineOfCreditFacilityRemainingBorrowingCapacity when the sentence explicitly reports a point-in-time available amount.\n2) Exact lexical patterns (case-insensitive regexes):\n   - Facility-capacity anchor (detect stated cap): /(?:has|has a|has an|in an aggregate principal amount of|in an aggregate amount of|in an aggregate principal amount of up to|up to)\\s+\\$?[\\d,]+(?:\\.\\d+)?\\s*(?:million|billion)?\\s*(?:revolv(?:ing)?\\s+credit\\s+facilit(?:y|ies)|credit\\s+facility|revolver)/i\n   - Explicit remaining-amount cues (map to remaining borrowing capacity): /(?:amount available under the (?:credit )?facility(?: totaled|was|is)|available under the facility totaled|was available under the facility|amount available under the facility is)\\b/i\n   - Comparative/constraint cues (signal comparison to a stated cap): /availability\\s+(?:under|of)\\s+(?:this|the)?\\s*(?:credit )?facilit(?:y|ies)\\s+may\\s+be\\s+less\\s+than\\s+\\$?[\\d,]+(?:\\.\\d+)?/i, /may\\s+be\\s+less\\s+than\\b/i, /as\\s+a\\s+result\\s+of\\b/i, /for\\s+certain\\s+subsidiaries\\b/i, /for\\s+specific\\s+entities\\b/i\n3) Association windows and antecedent resolution:\n   - If a facility-capacity anchor (pattern above) appears anywhere in the same sentence OR in the immediately preceding sentence, consider that dollar amount the canonical facility maximum for subsequent comparative/availability clauses. (Sentence window = ±1 sentence.)\n   - Token association: when anchored, allow currency amounts in comparative clauses up to ±16 tokens from the comparative phrase to be treated as referencing the stated cap.\n4) Precedence decision flow (apply in order):\n   a) If numeric is currency AND explicit remaining-amount cues match (within ±8 tokens) -> assign LineOfCreditFacilityRemainingBorrowingCapacity.\n   b) Else if numeric is currency AND comparative/constraint cue matches (e.g., \"availability may be less than $X\") AND X equals the earlier-detected facility-capacity anchor amount (or the sentence contains a nearby explicit facility-capacity anchor) -> assign LineOfCreditFacilityMaximumBorrowingCapacity (the phrase is comparing to the contractual cap or describing effective cap reductions).\n   c) Else if numeric is currency AND comparative/constraint cue matches BUT no prior anchor exists: if clause contains constraint markers ('as a result of', 'for certain subsidiaries', 'for specific entities', 'may be less than') prefer MaximumBorrowingCapacity (treat as described cap limit) but mark as 'ambiguous-availability-without-anchor' and log for review.\n   d) Else if numeric is currency AND no comparative/anchor cues but lexical 'availability' appears alone (no 'amount available', no 'totaled') -> treat as ambiguous: do NOT auto-assign RemainingBorrowingCapacity; instead prefer MaximumBorrowingCapacity only if a facility-capacity anchor exists in same or previous sentence; otherwise flag for human review.\n5) Tie-breaker and override: facility-capacity anchor presence overrides the naive 'availability -> remaining' rule. Explicit remaining-amount lexical patterns override capacity mapping and must map to RemainingBorrowingCapacity regardless of anchors.\n6) Examples / unit-tests (add to targeted suite):\n   - \"The Company has a $75 million revolving credit facility (credit facility)\" -> $75 million = LineOfCreditFacilityMaximumBorrowingCapacity.\n   - \"availability under this credit facility may be less than $75 million as a result of outstanding letters of credit...\" -> $75 million = LineOfCreditFacilityMaximumBorrowingCapacity (because X matches stated cap and clause is comparative/constraint).\n   - \"an outstanding letter of credit under the credit facility totaled $12.5 million and the amount available under the facility totaled $62.5 million\" -> $12.5M = LettersOfCreditOutstandingAmount; $62.5M = LineOfCreditFacilityRemainingBorrowingCapacity (explicit remaining-amount cue).\n   - \"availability under the facility may be less than $40 million\" (no prior stated cap mentioned) -> flag 'ambiguous-availability-without-anchor' and queue for human review (do not auto-assign RemainingBorrowingCapacity).\n7) Logging & QA: any case where 'availability' appears but the rule chooses MaximumBorrowingCapacity only because of an antecedent anchor must be logged as 'availability-referenced-cap' with the anchor span and numeric comparison; ambiguous/no-anchor cases must be logged as 'ambiguous-availability' and added to training data.\n8) Implementation notes: incorporate these checks before any generic lexical mapping that equates 'availability' -> remaining capacity; add unit-tests above and regressions that ensure 'amount available' still maps to RemainingBorrowingCapacity.\n[ctx-00011] helpful=1 harmful=1 :: Interest-rate 'per annum' -> DebtInstrumentInterestRateStatedPercentage (atomic heuristic): - Purpose: map percentages expressed as annual/stated interest rates on named debt instruments to DebtInstrumentInterestRateStatedPercentage. - Exact lexical cues (case-insensitive regexes): /(per\\s+annum|per\\s+year|annually|annual\\s+rate|%\\s+per\\s+annum|APR)\\b/ and instrument anchors: /\\b(note|notes|loan|loans|seller\\s+note|senior\\s+notes|term\\s+loan|revolver|debt\\b)/i. - Association window: require both a percentage token and at least one instrument-anchor token in the same sentence OR instrument-anchor within the previous sentence (±1 sentence). If instrument name present in same sentence, require token-distance <= 12 tokens; if in prior sentence, allow <= 40 token span across sentence boundary. - Precedence: If 'per annum' (or equivalent) is detected within ±3 tokens of the percentage, prefer DebtInstrumentInterestRateStatedPercentage over spread/basis tags. - Conflict rule: If both 'margin'/'spread' cues and 'per annum' cues are present, prefer 'per annum' -> stated-rate mapping, but log as 'rate-vs-spread-conflict' for QA. - Unit-tests/examples: - \"8% per annum on the Seller Notes\" -> 8% = DebtInstrumentInterestRateStatedPercentage (anchor 'Seller Notes'). - \"The interest rate is 5.00% per year on the term loan\" -> 5.00% = DebtInstrumentInterestRateStatedPercentage. - Implementation note: apply before generic percentage-to-spread fallbacks.\n[ctx-00012] helpful=1 harmful=0 :: Monetary 'interest charges' mapping to instrument-specific InterestExpenseDebt (atomic heuristic): - Purpose: ensure currency amounts described as interest charges/interest expense tied to a particular note/loan map to InterestExpenseDebt (and are linked to the instrument identity) rather than a generic InterestExpense tag. - Exact lexical cues (case-insensitive regexes): /interest\\s+charge(s)?\\b/, /interest\\s+expense(s)?\\b/, /interest\\s+cost(s)?\\b/, /(interest\\s+charges)\\s+associated\\s+with/, /interest\\s+relating\\s+to/, /interest\\s+on\\s+the\\s+(?:note|notes|loan|loan\\s+agreement)/i. - Association policy: require a currency token (e.g., $179,507) in same sentence and an instrument anchor (note/loan name like 'Seller Notes') in same sentence OR previous sentence. Primary token-distance window = ±12 tokens around numeric; allow ±1 sentence antecedent resolution with span <= 40 tokens. - Precedence: instrument-specific InterestExpenseDebt overrides generic InterestExpense when instrument anchor present. If instrument anchor not present, map to generic InterestExpense and flag 'interest-amount-no-instrument' for review. - Unit-tests/examples: - \"$179,507 of interest charges associated with the Seller Notes for the year\" -> $179,507 = InterestExpenseDebt (linked to Seller Notes). - \"$331,397 of interest expense for the six months ended June 30 related to the Term Loan\" -> $331,397 = InterestExpenseDebt. - Logging: record sentence span and instrument anchor for any instrument-linked interest mapping for traceability.\n[ctx-00013] helpful=0 harmful=0 :: Customer-concentration percentage mapping -> ConcentrationRiskPercentage1 (atomic heuristic): - Purpose: map percentages that quantify customer concentration of revenues to ConcentrationRiskPercentage1. - Exact lexical cues/patterns (case-insensitive regexes): /(?:two|three|top|largest|the\\s+two\\s+largest|the\\s+largest)\\s+customers\\b/, /customer\\s+concentration\\b/, /accounts?\\s+for\\s+about|accounted\\s+for\\s+approximately|accounted\\s+for\\s+|represent(s|ed)\\s+approximately\\s+\\d+\\%/i. Percentage capture window: detect percentage token within ±10 tokens of customer/revenue cue and/or the phrase 'of (our|the)? revenues' or 'of revenue'. - Precedence: when percentage is explicitly tied to 'customers' + 'revenues', map to ConcentrationRiskPercentage1 even if other percentage-tag candidates exist. - Unit-tests/examples: - \"Our two largest customers accounted for approximately 44% of our revenues\" -> 44% = ConcentrationRiskPercentage1. - \"The largest customer represented 22% of revenue\" -> 22% = ConcentrationRiskPercentage1. - Ambiguity handling: if percent lacks 'customer' anchor but 'of revenues' alone appears, mark as potential concentration and log for human review.\n[ctx-00001] helpful=0 harmful=2 :: Equity / Plan lexical-to-tag atomic rules (exact cues + variants). Purpose: deterministically map par-value, shares-outstanding, plan-availability and plan-authorized numeric tokens to the most specific US GAAP tag. Rules (apply in order):\n1) Par/Stated value per share -> CommonStockParOrStatedValuePerShare\n   - Exact lexical cues (case-insensitive regex examples): /\\$?\\s*[0-9]{1,3}(?:[\\,\\d]*)(?:\\.\\d+)?\\s*(?:per|par)\\s+share(s)?\\b/, /par\\s+value\\s+of\\s+\\$?\\s*[0-9.,]+\\b/, /stated\\s+value\\s+per\\s+share\\b/.\n   - Association window: numeric token and 'per share'/'par value' cue must co-occur in the same sentence and lie within ±8 tokens.\n   - Precedence: if matched, assign CommonStockParOrStatedValuePerShare regardless of other nearby 'price' or 'per share' generic sale cues.\n   - Unit-tests: '$0.001 par value per share' -> CommonStockParOrStatedValuePerShare = 0.001; 'stated value per common share of $0.01' -> CommonStockParOrStatedValuePerShare = 0.01.\n\n2) 'Shares outstanding' -> CommonStockSharesOutstanding\n   - Exact lexical cues: /shares\\s+outstanding\\b/, /outstanding\\s+shares\\b/, /shares\\s+were\\s+outstanding\\b/.\n   - Association window: numeric token within ±8 tokens of the cue; sentence-level anchor required.\n   - Precedence: this tag wins over generic 'shares issued' or offering tags when 'outstanding' is present and no offering/underwriter cues are present in ±1 sentence.\n   - Unit-tests: '28,026,713 shares outstanding' -> CommonStockSharesOutstanding = 28,026,713.\n\n3) Plan context: map plan-specific share counts to plan tags\n   - Plan-anchor detection (case-insensitive): /(?:long[- ]term incentive plan|2014\\s+Long\\s+Term\\s+Incentive\\s+Plan|LTIP|stock\\s+plan|equity\\s+compensation\\s+plan)\\b/ (allow named-year or 'the Plan' with antecedent resolution from prior sentence).\n   - If plan-anchor present in same sentence OR immediately preceding sentence (±1 sentence) then apply plan-specific mappings:\n     a) 'available'/'remain available' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant\n        - Cues: /available\\s+.*?shares|remain\\s+available|shares\\s+available\\s+for\\s+grant\\b/; numeric token within ±8 tokens maps to that tag.\n     b) 'maximum number' / 'may be delivered' / 'authorized' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized\n        - Cues: /maximum\\s+number\\s+of\\s+shares|may\\s+be\\s+delivered\\s+.*?is\\s+\\$?\\s*[\\d,]+|authorized\\s+to\\s+issue\\s+up\\s+to\\s+\\$?\\s*[\\d,]+\\b/, numeric token maps to Authorized tag.\n   - Token association: allow antecedent plan-name in previous sentence when 'the Plan' or year-named plan is used; antecedent span <= 40 tokens across sentence boundary.\n   - Precedence: plan-specific tags override generic share tags (e.g., StockIssuedDuringPeriodSharesNewIssues, SaleOfStockNumberOfSharesIssuedInTransaction) whenever the plan-anchor is detected.\n   - Unit-tests: 'no shares remain available under the 2014 Long Term Incentive Plan' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant = 0; 'maximum number of shares that may be delivered under the plan is 15,000,000' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized = 15,000,000.\n\n4) Association & ambiguity handling\n   - If both a plan-anchor and offering/underwriter cues are present, prefer plan-specific mappings for availability/authorized fields and issuance-specific mappings for issuance events; log any example where plan-anchor and issuance-anchor both score >0 as 'plan-vs-issuance-overlap' for human review.\n   - If no plan-anchor is found but text uses 'available under the plan' with an antecedent plan name earlier in document >1 sentence away, require human-review flag (do not auto-assign) unless antecedent resolution confidence >= threshold.\n\n5) Implementation notes\n   - Apply these rules before generic 'per share' or 'shares' fallbacks; add unit-tests above and log 'plan-availability-zero' cases for QA traceability.\n[ctx-00003] helpful=0 harmful=0 :: Atomic rule: Map 'LIBOR plus X%' (and close variants) -> DebtInstrumentBasisSpreadOnVariableRate1. - Purpose: avoid misinterpreting 'LIBOR plus X%' as an absolute stated interest rate. - Exact lexical patterns (case-insensitive regexes): /(LIBOR|ABR|an? index)\\s*(?:\\+|plus|\\+/-|\\band\\s+an?\\s+adjusted\\s+rate|with\\s+a\\s+margin\\s+of)\\s*([0-9]+(?:\\.[0-9]+)?\\s*%)/i and /(?:margin|spread)\\s*(?:of)?\\s*([0-9]+(?:\\.[0-9]+)?\\s*%)\\s*(?:over|above|to|on)\\s*(LIBOR|ABR|index)/i. - Token association: require percentage token within ±3 tokens of LIBOR/ABR or 'plus'/'over' lexical cue; allow antecedent instrument references in same sentence or previous sentence ±1 if needed for linking. - Precedence/tie-breaker: If both 'per annum'/'per year'/'annual' occurs within ±3 tokens of the percentage, prefer DebtInstrumentInterestRateStatedPercentage only if there is explicit 'per annum' + instrument-anchor; otherwise prefer DebtInstrumentBasisSpreadOnVariableRate1 for 'LIBOR plus X%' forms. - Unit-tests (atomic examples): - 'LIBOR plus 4.15%' -> 4.15% = DebtInstrumentBasisSpreadOnVariableRate1. - 'the margin ranges from 1.00% to 2.00% in the case of LIBOR loans' -> both percents = DebtInstrumentBasisSpreadOnVariableRate1. - 'interest rate of 4.15% per annum' -> 4.15% = DebtInstrumentInterestRateStatedPercentage (not a spread). - Logging: any mapping where both 'margin/spread' and 'per annum' cues are within ±3 tokens should be logged as 'rate-vs-spread-conflict' with spans for QA and unit-test augmentation. - Implementation note: apply this rule before generic percentage-to-interest fallbacks and add targeted regression tests for 'plus/over' surface forms.\n[ctx-00005] helpful=0 harmful=1 :: Atomic lexical rule: map 'borrowing base' -> LineOfCreditFacilityRemainingBorrowingCapacity (alias: LineOfCreditFacilityCurrentBorrowingCapacity).\n- Exact lexical cues (case-insensitive regexes): /\\bborrowing\\s+base\\b/, /\\bamount(?:s)?\\s+available\\s+to\\s+borrow\\b/, /\\bavailable\\s+borrowing\\s+capacity\\b/, /\\bamount\\s+available\\s+under\\s+the\\s+(?:credit\\s+)?facility\\b/.\n- Association window: numeric token must lie within ±8 tokens of the cue in the same sentence; allow antecedent plan/facility name resolution in previous sentence (±1 sentence) if anchor span <= 40 tokens.\n- Precedence rules (apply in order):\n  1) If a cue above matches -> assign LineOfCreditFacilityRemainingBorrowingCapacity for the nearest numeric currency token (override generic 'capacity' or 'availability' fallbacks).\n  2) If the same sentence explicitly contains 'maximum', 'commitment', 'up to', 'in an aggregate principal amount of', or similar contractual-cap cues within ±8 tokens of a different currency token -> assign those tokens to LineOfCreditFacilityMaximumBorrowingCapacity (do NOT remap borrows labeled explicitly as 'maximum').\n  3) If a single sentence contains both a 'borrowing base' cue and a 'maximum/commitment' cue with two different currency tokens, map each numeric to the cue it is adjacent to (token-distance); if one numeric token is within distance of both cues, prefer the 'borrowing base' -> RemainingBorrowingCapacity mapping for that numeric and log as 'borrowbase-vs-commitment-conflict'.\n  4) If only the word 'capacity' or 'availability' appears without an explicit 'borrowing base' or 'amount available' phrasing, defer to existing availability-vs-capacity rules (ctx-00009 / err-00010) and require anchor-checks; do NOT treat 'capacity' alone as proof of remaining-amount.\n- Ambiguity handling: if 'borrowing base' appears but no numeric token in ±8 tokens, flag 'borrowing-base-no-amount' for review (do not guess). If numeric present but sentence contains conflicting language (e.g., 'borrowing base' and 'maximum' both adjacent to the same numeric), map to RemainingBorrowingCapacity and log conflict for QA.\n- Unit-tests (atomic examples to add):\n  - \"The borrowing base under the credit facility is $425.0 million.\" -> $425.0M = LineOfCreditFacilityRemainingBorrowingCapacity.\n  - \"An amount available under the facility totaled $62.5 million\" -> $62.5M = LineOfCreditFacilityRemainingBorrowingCapacity.\n  - \"Revolving credit facility in an aggregate principal amount of up to $225.0 million; the borrowing base available is $150.0 million\" -> $225.0M = LineOfCreditFacilityMaximumBorrowingCapacity; $150.0M = LineOfCreditFacilityRemainingBorrowingCapacity.\n  - \"Availability under this credit facility may be less than $75 million as a result of outstanding letters of credit\" (and $75M equals prior stated cap) -> follow comparative-rule in ctx-00009 (map to MaximumBorrowingCapacity), but if 'borrowing base' is used instead of 'availability' and tied to $75M map to RemainingBorrowingCapacity.\n- Logging & QA: record mapping span with label 'borrowing-base-mapped' including cue span, numeric span, and antecedent facility anchor. Add 'borrowbase-vs-commitment-conflict' and 'borrowing-base-no-amount' to review queues for retraining.\n[ctx-00001] helpful=0 harmful=2 :: Atomic rule: Parenthetical-numbered footnote component resolution (map component amounts to the aggregate/line-item the footnote enumerates). Steps (apply in order for any numeric token appearing inside a parenthetical-numbered clause like \"(3) Includes\", \"(2) Consists of\", leading \"(3)\" or a parenthetical index): 1) Detect footnote-component syntax: regex cues (case-insensitive) for leading parenthetical index + include/consist language within same clause: /^\\(\\d+\\)\\s*(Includes|Consists|Compris(es)?|Consisting\\s+of|Includes\\s+the)\\b/ or tokens pattern [\"(\\d+)\", \"Includes\", \"Consists\", \"Includes the\"]. If matched and numeric tokens present in the clause, mark numeric tokens as candidate footnote-components. 2) Antecedent anchor search (ordered scope): a) Same footnote/clause: scan earlier tokens in same footnote sentence for explicit aggregate label nouns/phrases (within the same sentence or clause) — target lexical anchors: /gain(s)?\\s+on\\s+extinguishment|loss(es)?\\s+on\\s+extinguishment|extinguishment\\s+of\\s+debt|restructur(ing|e)\\s+charge(s)?|acquisition\\s+cost(s)?|settlement\\s+charge(s)?|other\\s+loss(es|es)?/i. If found, assign the component numeric to the same aggregate tag (exact tag mapping table below). b) Previous text window: if no anchor in same sentence, search up to 2 previous sentences and the nearest note heading/title within ±3 sentences for the same anchor phrases or for explicit line-item labels (note titles like 'Debt', 'Gain (Loss) on Extinguishment of Debt', 'Restructuring') and map component amounts to that anchor tag. c) Section-level fallback: if still no explicit anchor but the surrounding note header matches a known note type (e.g., 'Debt', 'Commitments and Contingencies', 'Restructuring and Other Charges'), prefer the plausible transaction tags associated with that note (e.g., 'Debt' -> GainsLossesOnExtinguishmentOfDebt; 'Restructuring' -> RestructuringCharges). 3) Negative-evidence de-prioritization: if candidate tag would be AssetImpairmentCharges but the clause and the preceding 2 sentences do NOT contain impairment keywords (regex: /impair|impairment|write-?down|recoverable|fair\\s+value\\s+less\\s+costs/i), deprioritize and do NOT assign AssetImpairmentCharges solely because of large amount; instead prefer aggregate-anchor tag found via steps 2a-2c or queue for review. 4) Shortlist & tag mapping precedence when anchor ambiguous: construct shortlist of plausible component tags in this order of preference when multiple plausible anchors exist or when anchor is only a generic 'other'/'charges': (high) GainsLossesOnExtinguishmentOfDebt, RestructuringCharges, AcquisitionRelatedCosts, TransactionRelatedGainsLosses (domain-specific candidate tags) -> (low) AssetImpairmentCharges. Only pick AssetImpairmentCharges if explicit impairment lexical cues exist. 5) Multi-amount handling: if clause enumerates multiple numeric tokens separated by 'and' or commas under the same parenthetical index, map all enumerated amounts to the same resolved aggregate tag (do not split across different tags unless explicit sub-labels present in the clause). 6) Ambiguity/triage: if no anchor found in steps 2-4 and no strong negative cues to rule out impairment, do NOT auto-assign AssetImpairmentCharges by magnitude. Instead label the numeric(s) as 'footnote-component-ambiguous' and queue for human review / classifier-resolution. 7) Logging and provenance: when mapping via this rule, record: parenthetical index span, clause span, chosen antecedent anchor span (sentence or heading), resolved tag, and the negative-evidence span if impairment was de-prioritized. 8) Minimal unit-tests (atomic examples to add): - \"(3) Includes $18.5 million, and $135.2 million.\" where prior sentence in note states \"Gains (Losses) on Extinguishment of Debt — total $XX (see (3))\" -> both amounts -> GainsLossesOnExtinguishmentOfDebt. - \"(2) Includes $5.0 million of lease termination costs and $2.0 million of severance\" with note header 'Restructuring and Other Charges' -> both amounts -> RestructuringCharges. - \"(1) Includes of $50.0 and $10.0\" with no impairment keywords and prior heading 'Debt' or 'Note 7 — Debt' -> map to GainsLossesOnExtinguishmentOfDebt (do not map to AssetImpairmentCharges). - Clause with explicit 'impair' nearby -> map to AssetImpairmentCharges. Implementation note: run this rule before magnitude-based fallbacks and before generic lexical-to-tag mapping; add examples where parenthetical indices reference an earlier aggregate via 'see (n)' to training/regression suites to ensure antecedent resolution is learned.\n[ctx-00002] helpful=1 harmful=0 :: Atomic heuristic: Prefer Allocated/Expense taxonomy tags for share-based compensation amounts when sentence context indicates an income-statement expense. Steps (apply in order for each currency numeric candidate near \"share-based\" lexical matches): 1) Income-statement expense detection (must be true to trigger this rule): detect any of these lexical cues in same sentence or ±1 sentence: /total compensation cost|compensation cost|compensation expense|share-?based compensation expense|cost for share-?based payment arrangements|expense recognized|included in operating expenses|on the income statement|for the year ended|for the period ended/ (case-insensitive). 2) Candidate-tag shortlist: when a lexical mapping produces multiple candidate tags for the phrase \"share-based compensation\" (e.g., ShareBasedCompensation, AllocatedShareBasedCompensationExpense, EmployeeServiceShareBasedCompensationTaxBenefitFromCompensationExpense), retrieve each candidate tag's preferred label and definition from the taxonomy. 3) Taxonomy-label/definition signals: compute taxonomy-specific scores using atomic features: +10 if preferred-label or definition contains keywords: '\\bexpense\\b', '\\ballocated\\b', '\\ballocated expense\\b', '\\ballocated compensation\\b'; +6 if contains '\\bcompensation\\b' and '\\bshare\\b' or 'share-based'; +4 if contains 'employee service' (indicates benefit/tax side). 4) Context-match score: compute context score: +8 if income-statement expense detection matched (step 1), +5 if the numeric token is immediately adjacent (±8 tokens) to an explicit expense cue (e.g., 'expense', 'cost', 'total compensation cost'), +3 if sentence contains reporting-period anchors ('for the year ended', 'for the quarter ended'). 5) Decision rule (tie-breaker): final_score = taxonomy_score + context_score. Prefer the candidate with highest final_score. If top candidate has an 'Expense'/'Allocated' taxonomy signal, it must win when income-statement expense detection was true. 6) Negative prevention rule (atomic): do NOT auto-assign generic ShareBasedCompensation when income-statement expense cues are present and a taxonomy candidate with 'Expense' or 'Allocated' exists. 7) Tax-benefit mapping exception: if numeric amount co-occurs with explicit tax cues ('tax benefit', 'tax effect', 'tax benefit related to share-based compensation', 'tax benefit of $X'), map to EmployeeServiceShareBasedCompensationTaxBenefitFromCompensationExpense (explicit tax mapping overrides expense-tag rule for tax amounts). 8) Association windows: apply lexical/income-statement cue detection within the same sentence or ±1 sentence; require numeric-token distance <= 8 tokens to primary expense cue for strongest match. 9) Logging and QA: record chosen tag, competing candidate tags with taxonomy_label/definition snippets, matched expense lexical cue span, and numeric token span. If generic tag would have been selected absent this rule, mark case as 'allocated-expense-overrode-generic' for retraining. 10) Minimal unit-tests (atomic examples to add): - 'Total compensation cost for share-based payment arrangements was $10,730, $13,488 and $19,289' -> $13,488 and $19,289 => AllocatedShareBasedCompensationExpense; $10,730 if described similarly should also map to AllocatedShareBasedCompensationExpense. - 'The tax benefit related to share-based compensation was $2,678 and $5,058' -> both tax amounts => EmployeeServiceShareBasedCompensationTaxBenefitFromCompensationExpense. - 'We recognized $3,200 of share-based compensation as expense in cost of goods sold' -> $3,200 => AllocatedShareBasedCompensationExpense (expense-location cue 'cost of goods sold' present). - 'Share-based compensation outstanding under the Plan: 1,000,000 shares available' -> numeric => plan-availability tag (do not map to AllocatedShareBasedCompensationExpense because income-statement expense cues absent). Implementation note: run this rule immediately after lexical-to-tag candidate generation and before generic fallback-to-first-lexical-match; surface all logged 'allocated-expense-overrode-generic' cases to QA for verification and add to regression suite.\n[ctx-00003] helpful=0 harmful=0 :: Atomic heuristic: Tax-line polarity detection and preference for IncomeTaxExpenseBenefit (expense vs benefit). Purpose: avoid literal-phrase-only mapping for 'income tax' line-items; determine polarity (expense vs benefit) using explicit lexical cues, numeric notation, and economic context and prefer IncomeTaxExpenseBenefit when benefit cues present. Rules (apply in order): 1) Candidate scope: apply when a numeric currency/amount token is in the same clause/sentence as any tax lexical anchor: /income\\s+tax\\b/, /income\\s+tax\\s+expense\\b/, /income\\s+tax\\s+provision\\b/, /provision\\s+for\\s+income\\s+taxes\\b/, /current\\s+tax\\b/, /deferred\\s+tax\\b/. 2) Explicit-benefit lexical cue (highest-confidence): if the same sentence (±0 tokens) contains words/phrases: /benefit(s)?\\b/, /tax\\s+benefit\\b/, /income\\s+tax\\s+benefit\\b/, /credit(s)?\\s+for\\s+income\\s+taxes\\b/, or parenthetical heading variants like /income\\s+tax\\s+benefit\\s*\\(expense\\)|income\\s+tax\\s*\\(benefit\\)/i -> assign IncomeTaxExpenseBenefit (override IncomeTaxExpense). 3) Numeric-sign / notation heuristic (high-confidence): if the numeric token is explicitly negative (leading '-' sign) OR enclosed in parentheses (e.g., '(' and ')') when usual format uses parentheses for negatives, treat as negative -> assign IncomeTaxExpenseBenefit (log that the numeric sign indicated a benefit). 4) Economic-context heuristic (moderate-confidence): if the same sentence or immediately adjacent sentence (±1 sentence) contains pre-tax-loss indicators: /pre-?tax\\s+loss(es)?\\b/, /loss\\s+before\\s+income\\s+tax(es)?\\b/, /net\\s+loss\\b/, /loss\\s+for\\s+the\\s+year\\b/, /income\\s*\\(loss\\)\\s+before\\s+income\\s+tax(es)?\\b/, then prefer IncomeTaxExpenseBenefit over IncomeTaxExpense for tax-line numeric(s) linked to the tax lexical anchors. 5) Parenthetical/label disambiguation (high-confidence): if heading or nearby label contains the pattern 'Income tax (benefit) (expense)' or 'Income tax benefit (expense)' or 'Income tax (expense) (benefit)' choose the more specific tag that matches the explicit parenthetical ordering if 'benefit' is present; otherwise use label ordering + numeric sign to decide. 6) Precedence and tie-breaker: precedence of cues = explicit-benefit-lexical > numeric-sign/parentheses > parenthetical/heading cue > economic-context. If multiple cues conflict (e.g., positive numeric but explicit 'benefit' word), prefer explicit lexical cue but log conflict and mark for review if numeric polarity contradicts lexical cue. 7) Ambiguity handling: if no benefit cues present and neither numeric sign nor pre-tax-loss context present, fall back to existing lexical mapping (IncomeTaxExpense) but add an 'uncertain-tax-polarity' flag and queue example for review/training. 8) Logging & traceability: record selected tag, matched cue type(s) and spans (lexical-benefit span, numeric-sign span, pre-tax-loss phrase span), and confidence score. Any case where economic-context changed a literal lexical match must be logged as 'context-overrode-lexical-tax' for QA. 9) Unit-tests (atomic examples to add): - \"Income tax expense (benefit) of $34.4 and $53.1\" -> both amounts = IncomeTaxExpenseBenefit (parenthetical label includes 'benefit'). - \"We recorded a pre-tax loss of $100 and an income tax expense of $10\" (where 'income tax' appears but context implies benefit) -> $10 = IncomeTaxExpenseBenefit (pre-tax-loss context triggers benefit). - \"Income tax expense was $(5.0) for the year\" -> $(5.0) = IncomeTaxExpenseBenefit (parentheses -> negative). - \"The tax benefit related to continuing operations was $2.5\" -> $2.5 = IncomeTaxExpenseBenefit (explicit 'benefit'). - \"Income tax expense of $7.0 on income before taxes of $20.0\" -> $7.0 = IncomeTaxExpense (no benefit cues). 10) Implementation note: run this heuristic immediately after tax-lexical anchor detection and before any strict lexical-to-tag assignment; surface logged conflicts to the human-review queue and add them to retraining dataset to reduce reliance on exact-token-match.\n[ctx-00004] helpful=0 harmful=0 :: Atomic heuristic: Regulatory rate-requests mapping -> PublicUtilitiesRequestedRateIncreaseDecreaseAmount\n- Purpose: deterministically map currency numeric tokens that express a utility's requested (filed/submitted/asked-for) rate increase or decrease to PublicUtilitiesRequestedRateIncreaseDecreaseAmount and avoid false mapping to Revenues/Expense/generic financial tags.\n- Exact filing/request lexical cues (case-insensitive regex examples): /\\bfiled\\b/, /\\bfiled an application\\b/, /\\bsubmitted a request\\b/, /\\brequested\\b/, /\\bseeks to increase\\b/, /\\bseeking approval to increase\\b/, /\\bpetition(ed)?\\b/, /\\bproposed\\b/, /\\bseeks to decrease\\b/, /\\bsubmitted a petition\\b/, /\\bstipulation .* for a net increase\\b/, /(for|requesting|seeking).*rate (increase|decrease) of/i. If any of these cues co-occur with a rate/increase/decrease lexical anchor, treat as regulatory-request.\n- Rate-change lexical anchors: /rate(s)? (increase|decrease)|increase[s]? rates?|decrease[s]? rates?|net increase|net decrease|rate adjustment|proposed rate change|requested rate change/.\n- Association window & antecedent resolution: require numeric token in the same sentence and within ±12 tokens of a filing/request cue OR within the same clause. Allow antecedent anchors up to ±1 sentence when the numeric is introduced as 'the net increase of $X' or via a parenthetical referring to the filing (e.g., 'in the filing, for a net increase of $1.2 million').\n- Decision rule (apply in order):\n  1) If a filing/request cue AND a rate-change anchor are detected as above -> assign PublicUtilitiesRequestedRateIncreaseDecreaseAmount to the nearest currency numeric token (regardless of 'net' / 'after adjustments' language). If phrase explicitly contains 'decrease', preserve semantic sign (tag remains same but mark as decrease).\n  2) If 'approved', 'authorized', 'granted', 'effective', 'in effect as of', or 'we will implement' appear in place of filing/request cues -> do NOT map to Requested tag; instead map to the taxonomy's approved/implemented-rate-change tag (e.g., PublicUtilitiesApprovedRateIncreaseDecreaseAmount) or, if that tag is absent, flag for human-review rather than mapping to Revenues.\n  3) If sentence describes expected/estimated revenue impact using verbs like 'will result in', 'expected to increase (our) revenues by', 'resulting in additional revenues of' -> do NOT map to the Requested-rate tag; map to the appropriate Revenues/EstimatedImpact tag or flag for review (avoid mapping requested-rate -> Revenues).\n- Precedence/tie-breaker: when a filing/request cue is present, this rule overrides generic lexical matches (e.g., 'increase', 'increase of $X' that could be mis-mapped to Revenues or Contract-related tags). If both filing and 'expected revenue' cues appear, prefer requested-rate mapping but log for human review because text describes both regulatory request and revenue impact.\n- Net/after-adjustment handling: presence of modifiers like 'net', 'after adjustments', 'after pro forma adjustments', or 'net of' does NOT change mapping — still map to PublicUtilitiesRequestedRateIncreaseDecreaseAmount if filing/request cues remain present; record modifier span in logs for provenance.\n- Negative/zero handling: if filing/request clause uses 'decrease' or explicitly states 'a decrease of $X' map same tag and mark as decrease; if phrase is 'no change requested' or contains negation near rate-change anchor, normalize numeric to 0 and map to PublicUtilitiesRequestedRateIncreaseDecreaseAmount = 0 and log negation span.\n- Token-normalization: recognize approximate/caretakers tokens ('approximately', 'about', '~', 'approx.') and numeric ranges ('approximately $5.9 million', '$5.5 – $6.0 million') — map central expression to requested tag and attach span confidence; for ranges, map whole range as candidate value and flag for downstream normalization.\n- Logging & QA: always record filing/request cue span, rate-change anchor span, numeric span, and chosen tag; if the pipeline would otherwise map the numeric to Revenues or to a recognized/approved tag, log as 'regulatory-request-vs-other' for QA. Queue ambiguous/dual-cue sentences (both filing and approved language or both revenue-impact and filing) for human review.\n- Unit-tests (atomic examples to add):\n  - 'filed an application with the Commission for a natural gas rate increase of approximately $5.9 million' -> $5.9M = PublicUtilitiesRequestedRateIncreaseDecreaseAmount.\n  - 'submitted a request to decrease its electric rates by $7.2 million' -> $7.2M (decrease) = PublicUtilitiesRequestedRateIncreaseDecreaseAmount.\n  - 'filed a general rate case with a requested overall increase of approximately $2.3 million' -> $2.3M = PublicUtilitiesRequestedRateIncreaseDecreaseAmount.\n  - 'filed a stipulation with the Commission for a net increase of $1.2 million' -> $1.2M = PublicUtilitiesRequestedRateIncreaseDecreaseAmount (net modifier preserved in log).\n  - 'the Commission approved an increase of $4.0 million' -> do NOT map to Requested tag; map to PublicUtilitiesApprovedRateIncreaseDecreaseAmount or flag for review.\n  - 'the filing is expected to result in annual revenue increases of $3.0 million' -> do NOT map to Requested tag; map to Revenues/EstimatedImpact or flag for review.\n- Implementation note: run this rule early in lexical-to-tag pipeline (before generic currency-to-revenue fallbacks). Ensure supervision records include cue spans to train classifiers to distinguish requested vs approved vs revenue-impact contexts.\n[ctx-00005] helpful=0 harmful=1 :: Atomic rule: Lease-range endpoint mapping when a single 'between A and B' range is used with both 'lease assets' and 'lease liabilities'. Purpose: deterministically map numeric endpoints in phrases like \"recognition of additional lease assets and lease liabilities between $250.0 and $350.0 as of <date>\". Detection patterns (case-insensitive): /(?:recognition|recognise|recognized|recognised).*lease assets?\\s+and\\s+lease liabilities?\\s+between\\s+\\$?[0-9,]+(?:\\.\\d+)?\\s+and\\s+\\$?[0-9,]+(?:\\.\\d+)?/i or general pattern /(lease assets?|lease liabilities?).{0,80}?between\\s+\\$?[0-9,]+(?:\\.\\d+)?\\s+and\\s+\\$?[0-9,]+(?:\\.\\d+)?/i. Decision flow (apply in order): 1) If the clause explicitly assigns amounts to each side (e.g., \"assets of $A and liabilities of $B\"), map accordingly (assets -> OperatingLeaseRightOfUseAsset; liabilities -> OperatingLeaseLiability). 2) Else if the clause uses a two-endpoint range \"between A and B\" and both nouns 'assets' and 'liabilities' appear: a) If nouns appear in order 'assets' then 'liabilities' in the clause, map upper endpoint B -> OperatingLeaseRightOfUseAsset and lower endpoint A -> OperatingLeaseLiability. b) If nouns appear in reverse order ('liabilities' then 'assets'), invert mapping (upper -> liability, lower -> asset). 3) Else if only a single endpoint token is present (e.g., only \"$350.0\" appears) or endpoints are not clearly ordered, apply nearest-noun lexical association (token-distance window ±8 tokens): map the numeric to the most specific tag matching the nearest noun (\"asset\" -> OperatingLeaseRightOfUseAsset; \"liability\" -> OperatingLeaseLiability). 4) If token-distance method yields ties or no nearby asset/liability noun within ±8 tokens, mark the numeric as 'lease-range-ambiguous' and queue for human review (do NOT fall back to generic money tags). 5) Logging: record noun order, token distances, chosen mapping, and clause span. Unit-tests (atomic): - \"recognition of additional lease assets and lease liabilities between $250.0 and $350.0 as of January 1, 2019\" -> $350.0 => OperatingLeaseRightOfUseAsset; $250.0 => OperatingLeaseLiability (assets before liabilities rule). - \"recognition of additional lease liabilities and lease assets between $100 and $200\" -> $200 => OperatingLeaseLiability; $100 => OperatingLeaseRightOfUseAsset (reverse-order rule). - \"We recognized $350.0 of additional lease assets and liabilities\" (single token nearest 'assets') -> $350.0 => OperatingLeaseRightOfUseAsset. Implementation note: apply this rule before generic currency-to-asset/liability fallbacks and log ambiguous-range cases for QA.\n[ctx-00006] helpful=0 harmful=0 :: Atomic lexical-to-tag mapping: 'net sales' + geographic customer anchor -> RevenueFromContractWithCustomerExcludingAssessedTax. Purpose: deterministically map amounts described as 'net sales' to geographically qualified customers (e.g., 'to customers located outside the United States') to the most specific revenue taxonomy element and choose the assessed-tax variant. Detection patterns (case-insensitive): - Net-sales lexical cue: /\\bnet\\s+sales\\b|\\bsales,?\\s+net\\b/ within the sentence. - Geographic-customer anchors: /customers?\\s+(?:located|based)\\s+outside\\s+the\\s+United\\s+States|to\\s+customers\\s+outside\\s+the\\s+United\\s+States|international\\s+customers|foreign\\s+customers/ or short-form '\\boutside the U\\.S\\.?\\b'. Decision flow (apply in order): 1) If a currency numeric token appears within ±10 tokens of 'net sales' and a geographic-customer anchor appears in same sentence (or immediately adjacent sentence ±1), assign RevenueFromContractWithCustomerExcludingAssessedTax to that numeric. 2) Taxonomy-variant selection: prefer the 'ExcludingAssessedTax' variant when the sentence does NOT mention assessed taxes, sales taxes, VAT, GST, or tax-inclusive language. Detection regex for tax-inclusion cues: /assessed tax|sales tax|inclusive of tax|includes tax|VAT|GST|inclusive of|exclusive of taxes/i. 3) If sentence contains explicit assessed/sales-tax inclusion language, map to the 'IncludingAssessedTax' variant (if present) or flag 'revenue-tax-variant-ambiguous' for review. 4) Year-association: when multiple year-labeled numeric values are listed in same sentence (e.g., \"$634.8, $627.1 and $655.6 for 2018, 2017 and 2016\"), preserve mapping of each numeric to its year label by nearest-year-token association (token-distance window ±6 tokens) before applying revenue tag; attach year metadata to each assigned RevenueFromContractWithCustomerExcludingAssessedTax tag. 5) Ambiguity handling: if 'net sales' appears without a customer geographic anchor but a nearby phrase 'international'/'outside' exists, treat as geographic match; otherwise map 'net sales' to the generic RevenueFromContractWithCustomer tag but log for QA. 6) Unit-tests (atomic): - \"Net sales to customers located outside the United States were $634.8, $627.1 and $655.6 for 2018, 2017 and 2016\" -> map each numeric to RevenueFromContractWithCustomerExcludingAssessedTax with corresponding year association. - \"Net sales to foreign customers were $10.0\" -> $10.0 => RevenueFromContractWithCustomerExcludingAssessedTax. - \"Net sales (including sales tax) to customers outside the U.S. were $5.0\" -> map to RevenueFromContractWithCustomerIncludingAssessedTax or flag if taxonomy variant missing. Implementation note: run this rule before generic currency-to-sales fallbacks and always log the presence/absence of assessed-tax cues and year associations for traceability.\n[ctx-00007] helpful=0 harmful=1 :: Equity/Share-based two-step disambiguation (subject-action + specificity precedence) — atomic heuristic to distinguish grants-in-period vs plan-authorized vs generic common-stock-reserved for any share-count numeric. Steps (apply in order): 1) Subject & action extraction (primary anchors): - Detect subject tokens (case-insensitive): /option(s)?\\b/, /award(s)?\\b/, /grant(s)?\\b/, /share-based payment/, /the Plan\\b/, /stock plan\\b/, /Long Term Incentive Plan\\b/, /the Plan\\b/. - Detect action/verb tokens (case-insensitive): GRANT cues = /grant|granted|may continue to receive|may receive|will receive|annual option grant|annual grant|per director|per\\s+year|each\\s+director/; AUTH/RESERVE cues = /authorized|authorised|reserve(d)? for future grant|reserved for future grant|reserved for future issuance|reserved\\b/; ISSUANCE cues = /issued|issued and outstanding|issued to|issued at/; AVAILABILITY cues = /available for grant|remain available|available under the Plan/. 2) Association windows & antecedent resolution: - Require numeric token to be within ±8 tokens of the detected subject/action cue in the same sentence for high-confidence mapping. - Allow antecedent plan-subject resolution from previous sentence if anaphor ('the Plan', named plan) present; antecedent span allowed ≤ 40 tokens across sentence boundary and only ±1 sentence. 3) Per-period / per-award grant detection rules (map -> OptionsGrantsInPeriodGross): - If subject includes 'option(s)'/'grant(s)' AND action cue matches any GRANT cues above (especially modifiers: 'annual', 'per director', 'each', 'no more than', 'maximum annual grant', 'for no more than'), map numeric -> OptionsGrantsInPeriodGross (grants-in-period). - Example triggers (atomic): /annual option grant for no more than\\s+[0-9,]+/, /may continue to receive an annual option grant of\\s+[0-9,]+/, /no more than\\s+[0-9,]+\\s+shares\\s+(per|each|annually)/. 4) Plan-specific authorization/reservation detection rules (map -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized): - If action includes AUTH/RESERVE cues AND subject refers to options/awards/plan (explicit 'options to purchase', 'under the Plan', 'reserved for future grant' co-occurring with 'option(s)'/'award(s)'), map numeric -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized. - Treat the collocation 'authorized and reserved for future grant' with an 'option' subject as a strong plan-authorization signal. 5) Generic common-stock reserved fallback (map -> CommonStockCapitalSharesReservedForFutureIssuance): - If action includes 'reserved'/'reserved for future issuance' but NO explicit option/award/plan anchor within ±8 tokens or antecedent ±1 sentence, map numeric -> CommonStockCapitalSharesReservedForFutureIssuance. 6) Precedence & tie-breakers (apply when multiple candidate tags score >0): - Precedence order: (a) If GRANT cue present -> OptionsGrantsInPeriodGross (highest when 'annual', 'per', 'no more than', 'each', 'may continue to receive' appear). (b) Else if AUTH/RESERVE cue present with option/plan anchor -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized. (c) Else if only generic 'reserved' + common-stock anchor present -> CommonStockCapitalSharesReservedForFutureIssuance. - If both grant-modifier and authorization verb appear in same clause (e.g., 'may receive a grant not to exceed X shares authorized under the Plan for annual grants'), prefer the tag indicated by the modifier that scopes the number: 'per-period/per-award' modifiers (annual/per director/each) -> grants-in-period. If conflict persists, flag as 'plan-grant-auth-ambiguous' for human review and log both anchors. 7) Token matching sensitivity & confidence flags: - Treat words 'annual', 'per', 'each', 'no more than', 'maximum' as strong per-period signals (weight +10). - Treat verbs 'authorized', 'reserved for future grant', 'reserved' with an option/plan anchor as strong authorization signals (weight +9). - Map only when weighted score for chosen tag exceeds alternate by a threshold (e.g., >4); otherwise queue for review. 8) Examples / unit-tests to add (atomic): - 'non-employee directors may continue to receive an annual option grant for no more than 10,000 shares.' -> 10,000 = OptionsGrantsInPeriodGross. - 'options to purchase 989,081 shares ... were authorized and reserved for future grant.' -> 989,081 = ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized. - '1,000,000 shares reserved for future issuance under the charter' (no plan/option mention) -> 1,000,000 = CommonStockCapitalSharesReservedForFutureIssuance. - 'maximum number of shares that may be delivered under the Plan is 15,000,000' -> 15,000,000 = ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized. - 'no shares remain available under the 2014 Long Term Incentive Plan' -> 0 = ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant. 9) Logging & QA: - For every mapping log: subject anchor span, action cue span, chosen tag, competing tag(s) with score differential, and antecedent-plan span if used. - If mapping results in tie or falls below confidence threshold, label 'plan-grant-auth-ambiguous' and queue for human review/training. Implementation note: place this rule immediately after existing ctx-00001 plan-anchor detection and before any generic 'reserved'->CommonStockCapitalSharesReservedForFutureIssuance or nearest-lexical-match fallback to prevent the two mislabels observed.\n[ctx-00008] helpful=1 harmful=1 :: Atomic heuristic: Instrument-class-first mapping for share-based awards (prevent misclassifying SARs/UARs as options). Purpose: always classify award instrument type before selecting grants/issued tag or tag-variant (Gross vs Non-Options). Rules (apply in order): 1) Instrument-class lexicon (case-insensitive regexes; apply exact-match before fuzzy): - Options signals -> /\\boption(s)?\\b|stock\\s+option(s)?|option-based\\b/. - Equity-instruments-other-than-options signals -> /\\b(unit\\s+appreciation\\s+right(s)?|UARs?|UAR|SARs?|SAR|stock\\s+appreciation\\s+right(s)?|restricted\\s+stock\\s+unit(s)?|RSU(s)?|dividend\\s+equivalent\\s+unit(s)?|dividend\\s+equivalent\\b|restricted\\s+stock\\b)/. If both classes appear, prefer explicit token that matches the instrument noun closest to numeric token (distance weighting). 2) Association window: treat the instrument-class cue as global for any numeric token in the same sentence or within ±1 sentence if anaphoric ('the awards', 'such units') and antecedent span <= 40 tokens. 3) Grants-in-period mapping: when action verb indicates issuance/grant (regex: /\\b(grant(ed)?|issued|awarded|awards|grants-in-period|grants|issued and outstanding)\\b/) and instrument-class == options -> map to OptionsGrantsInPeriod... (option grants). If instrument-class == equity-instruments-other-than-options -> map to ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsGrantsInPeriod (grants-in-period for non-options). 4) Outstanding / Nonvested counts: when numeric phrase describes 'units outstanding', 'nonvested', 'nonvested units', 'dividend equivalent units outstanding' and instrument-class matches equity-instruments-other-than-options -> map to ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsNonvestedNumber (or taxonomy NonvestedNumber variant appropriate). 5) Gross-variant guard: only allow selection of an 'Options...Gross' variant when (a) instrument-class == options AND (b) either the sentence contains explicit 'gross' / 'before forfeitures' cues (/\\bgross\\b|before\\s+forfeitur(es)?|gross\\s+of\\s+forfeitures/) OR taxonomy definitions require Gross form. Otherwise, do NOT select an options-Gross variant for non-option instruments. 6) Precedence scoring & tie-breaker: compute score = (instrument_class_exact_match? 10 : 0) + (action_verb_grant? 5 : 0) + (token_distance_factor = max(0, 8 - token_distance_to_numeric)). Choose tag with highest score; require chosen tag score >= next_best + 4, else flag 'instrument-class-ambiguous' for review. 7) Examples / unit-tests (atomic): - '8 thousand unit appreciation rights issued' -> 8,000 = ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsGrantsInPeriod. - '5,000 SARs were granted' -> 5,000 = ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsGrantsInPeriod. - '10,000 options were granted' -> 10,000 = OptionsGrantsInPeriodGross (only if 'gross' cue present) else OptionsGrantsInPeriodNet/appropriate variant per taxonomy. - '33 thousand dividend equivalent units outstanding at March 31' -> 33,000 = EquityInstrumentsOtherThanOptionsNonvestedNumber. 8) Ambiguity handling & logging: log instrument-class cue span, action-verb span, chosen tag, competing tag(s) with scores, and rule reason. On low-confidence or ties, label 'instrument-class-ambiguous' and queue for human review; accumulate these cases for retraining. 9) Implementation note: run this rule before any generic 'grants'/'issued' -> options fallback and before applying 'nearest lexical match' to prevent superficial keyword collisions.\n[ctx-00009] helpful=1 harmful=1 :: Equity-reserved-vs-plan-authorized disambiguation (atomic rule)\nPurpose: When text contains \"reserved\" + a plan reference, decide whether the numeric is a corporate common-stock reservation (CommonStockCapitalSharesReservedForFutureIssuance) or a plan-authorized/share-based-compensation authorization (ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized).\nExact lexical cues (case-insensitive):\n- ESPP plan type cues: /\\bESPP\\b|Employee Stock Purchase Plan|Employee Stock Purchase Plan\\b/\n- Common-stock noun cues: /\\bclass\\s+[A-Z]\\s+common\\s+stock\\b|\\bcommon\\s+stock\\b|\\bshares\\s+of\\s+common\\s+stock\\b/ \n- Share-based-compensation award cues: /award(s)?|option(s)?|RSU(s)?|restricted\\s+stock|available\\s+for\\s+grant|available\\s+for\\s+award|available\\s+under\\s+the\\s+Plan|available\\s+for\\s+grant\\b|awards\\s+reserved|reserved\\s+for\\s+future\\s+grant|authorized\\s+to\\s+issue\\s+under\\s+the\\s+Plan/ \n- Generic reserved cue: /\\breserved\\b|reserved\\s+for\\s+future\\s+issuance\\b/\nAssociation windows & antecedent resolution:\n- Require numeric token to be within ±8 tokens of the reserved cue for high-confidence mapping.\n- Allow antecedent resolution to prior sentence (±1 sentence) when 'the Plan' or a named plan appears earlier; antecedent span must be <= 40 tokens across sentence boundary.\nDecision flow (apply in order):\n1) If an ESPP plan-type cue is present in same sentence OR antecedent plan resolved to an ESPP within ±1 sentence -> map numeric -> CommonStockCapitalSharesReservedForFutureIssuance (ESPP reservations are corporate equity reserved-for-issuance disclosures).\n2) Else if a common-stock noun cue ('Class A common stock', 'common stock', 'shares of common stock') co-occurs with reserved-language in same sentence or immediately adjacent sentence (±1) -> map numeric -> CommonStockCapitalSharesReservedForFutureIssuance.\n3) Else if reserved-language co-occurs with explicit award/instrument cues (options, RSUs, awards, 'available for grant', 'available under the Plan') within ±8 tokens OR antecedent plan resolved is clearly a 'stock plan' described as for awards -> map numeric -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized.\n4) Else (reserved + plan but no ESPP/common-stock noun and no award/instrument anchor) -> do NOT auto-assign: flag as 'reserved-plan-ambiguous' and queue for human review; prefer CommonStockCapitalSharesReservedForFutureIssuance only when explicit corporate-equity headings or charter references present.\nTie-breakers & precedence:\n- Give ESPP and explicit 'common stock' noun cues precedence over generic 'plan' anchors and over award-sounding verbs (e.g., 'reserved for issuance under the 2016 ESPP' -> CommonStockCapitalSharesReservedForFutureIssuance).\n- If both award-cues and common-stock noun cues appear, prefer CommonStockCapitalSharesReservedForFutureIssuance only when the sentence stresses issuance of common stock (e.g., 'shares of Class A common stock were initially reserved for issuance under the 2016 ESPP'); else if sentence explicitly frames reserved amount as for awards/grants ('reserved for future grant under the Stock Plan') prefer ShareBasedCompensationArrangement...Authorized.\nConfidence scoring notes:\n- ESPP present: +12 weight for CommonStock tag.\n- 'common stock' noun within ±8 tokens: +10 weight for CommonStock tag.\n- Award/instrument cue within ±8 tokens: +9 weight for ShareBasedComp tag.\n- Require chosen tag score >= next_best + 4 or mark 'reserved-plan-ambiguous' for review.\nLogging & QA:\n- Log which cues were matched (span offsets), antecedent plan name (if resolved), chosen tag, competing tags with scores, and confidence decision.\n- Add any ambiguous cases to 'reserved-plan-ambiguous' queue for annotation and retraining.\nUnit-tests (atomic examples):\n- 'A total of 3,800,000 shares of Class A common stock were initially reserved for issuance under the 2016 ESPP.' -> 3,800,000 => CommonStockCapitalSharesReservedForFutureIssuance.\n- '1,000,000 shares reserved for future issuance under the charter' -> 1,000,000 => CommonStockCapitalSharesReservedForFutureIssuance.\n- 'options to purchase 989,081 shares were authorized and reserved for future grant under the Plan.' -> 989,081 => ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized.\n- 'The Plan authorizes up to 15,000,000 shares available for grant.' -> 15,000,000 => ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized.\nImplementation note: insert this rule immediately after ctx-00001 plan-anchor detection and before any generic 'reserved' -> ShareBasedCompensationArrangement... authorized fallback to prevent overgeneralization to plan-authorized tag when the reserved instrument is corporate common stock or when an ESPP is involved.\n[ctx-00010] helpful=1 harmful=0 :: Atomic heuristic — Temporal-expression disambiguation: map 'years' to vesting vs expiration/term by linking the numeric to its governing noun (semantic-governor-first, not proximity-first). Rules (apply in order): 1) Governing-noun detection (exact cues, case-insensitive): VESTING cues = /\\bvest(?:s|ed|ing)?\\b|vesting\\b|vests?\\s+over\\b|vested\\s+over\\b/; EXPIRATION/TERM cues = /\\bterm\\b|\\bterm\\s+of\\b|\\bexpire(?:s|d|s)?\\b|\\bexpiration\\b|\\bexpire\\s+after\\b|\\bexpires\\s+after\\b/. 2) Strong syntactic patterns (highest-priority): if numeric appears inside or immediately adjacent to prepositional phrase matching patterns -> map accordingly: - /term\\s+of\\s+(?:a\\s+)?(?:\\d+|[A-Za-z\\-]+)(?:\\s*-\\s*\\d+)?\\s*(?:-?year|years?)/i -> assign SharebasedCompensationArrangementBySharebasedPaymentAwardExpirationPeriod. - /(vest|vesting)\\s+(?:over|in)\\s+(?:a\\s+)?(?:\\d+|[A-Za-z\\-]+)(?:\\s*-\\s*\\d+)?\\s*(?:-?year|years?)/i -> assign ShareBasedCompensationArrangementByShareBasedPaymentAwardAwardVestingPeriod1. 3) Dependency / parser signal (secondary-high priority): if dependency parse shows numeric token as numeric modifier (nummod) of a noun that matches VESTING cues -> vesting tag; if numeric is nummod of 'term'/'expiration'/'expire' -> expiration tag. 4) Token-window lexical association (fallback): if no prepositional or dependency match, look for governing-noun tokens within the same clause with token-distance <= 8 tokens and prefer semantic-governor match (term/expire > vest if numeric modifies 'term'); do NOT rely solely on the nearest occurrence of the word 'years'—require link to a governing noun. 5) Tie-breaker precedence: when a numeric is within windows of both vesting and term cues, prefer explicit 'term of X' / 'expire after X' constructs over 'vest' matches (expiration/term > vesting) because 'term'/'expire' indicates legal expiration. 6) Multi-value and hyphenated forms: handle composite forms such as 'three- or four-year' as a vesting-period match when the phrase is anchored to 'vest'; treat ranges 'between A and B years' similarly using the governing noun. 7) Exact tag verification: before finalizing assignment, validate the chosen tag text exactly matches the taxonomy string (examples above). 8) Ambiguity handling & confidence: if no governing-noun match in same clause and both vest/term cues exist in sentence, label as 'temporal-ambiguous' and queue for human review (do NOT auto-assign). 9) Logging: record numeric token span, governing-noun span (matched pattern or dependency relation), chosen tag, confidence score and rule-match type (prepositional-pattern / dependency / token-window). 10) Unit-tests (atomic examples to add): - 'Awards are generally granted for a term of ten years and vest over a three- or four-year period.' -> 10 years = SharebasedCompensationArrangementBySharebasedPaymentAwardExpirationPeriod; 3/4 years = ShareBasedCompensationArrangementByShareBasedPaymentAwardAwardVestingPeriod1. - 'Options vest over a four-year period and expire after ten years.' -> 4 years -> vesting tag; 10 years -> expiration tag. - 'We grant awards with a term of ten years that vest over three years.' -> ten years -> expiration tag (term); three years -> vesting tag. - 'The awards vest in a three- or four-year period; the term is generally ten years.' -> ten years -> expiration tag. Implementation note: run this heuristic before any proximity-only lexical-to-tag mapping; surface all 'temporal-ambiguous' logs to QA to add targeted examples to training data.\n[ctx-00011] helpful=1 harmful=1 :: Atomic lexical-to-tag rules for amortization-asset-type and operating-segment-count phrases (exact cues, windows, precedence, negatives, unit-tests):\n\n1) Amortization — Intangible assets acquired -> AmortizationOfIntangibleAssets\n- Exact lexical anchors (case-insensitive): /amortiz(e|ation)\\b/, /intangible\\s+asset(s)?\\b/, /intangible\\s+assets\\s+acquir(ed|ed\\b|ing)\\b/, /acquired\\s+intangible\\s+assets\\b/, /amortization\\s+of\\s+intangible\\s+assets\\b/.\n- Association window: require both an amortization cue and an 'intangible asset' anchor to appear in the same sentence with the numeric token within ±8 tokens of at least one of those anchors; allow antecedent 'acquired intangible assets' in prior sentence ±1 when anaphor ('these assets', 'the intangible assets') is used and antecedent span <= 40 tokens.\n- Precedence: if matched, assign AmortizationOfIntangibleAssets and override any generic AmortizationExpense or AmortizationOfOtherAssets tag.\n- Negative-prevention: do NOT map when amortization is described as 'impairment-related amortization' or when the asset anchor indicates internal R&D capitalization unless text explicitly says 'acquired' or 'purchase' — in such cases flag for review or require additional anchor (e.g., 'acquired', 'purchased in the acquisition').\n- Period-invariance: numeric amounts for different periods (three-month, six-month, annual) that reference the same concept must receive the same taxonomy element; record period metadata separately but do not change tag.\n- Unit-tests (atomic examples):\n  - \"$1,696 of amortization expense related to the intangible assets acquired\" -> $1,696 = AmortizationOfIntangibleAssets.\n  - \"Amortization of intangible assets acquired in the acquisition was $2,500\" -> $2,500 = AmortizationOfIntangibleAssets.\n\n2) Amortization — Deferred contract costs / capitalized contract costs -> CapitalizedContractCostAmortization\n- Exact lexical anchors (case-insensitive): /amortiz(e|ation)\\b/, /deferred\\s+contract\\s+cost(s)?\\b/, /capitalized\\s+contract\\s+cost(s)?\\b/, /amortization\\s+of\\s+deferred\\s+contract\\s+costs\\b/.\n- Association window: require 'amortization' + 'deferred contract costs' or 'capitalized contract costs' in same sentence and numeric token within ±8 tokens of the phrase; allow antecedent antecedent resolution ±1 sentence when anaphor ('these deferred contract costs') used (span <= 40 tokens).\n- Precedence: map to CapitalizedContractCostAmortization and override generic amortization tags.\n- Negative-prevention: do NOT map simply because 'deferred' and 'costs' appear; require explicit 'contract' token (i.e., 'deferred contract costs' or synonym 'capitalized contract costs'). If only 'deferred revenue' or 'deferred costs' without 'contract' present, flag for review.\n- Period-invariance: same as above — period labels do not change tag.\n- Unit-tests (atomic):\n  - \"Amortization expense related to deferred contract costs was $X for the three months and $Y for the six months\" -> map each amount to CapitalizedContractCostAmortization with period metadata.\n  - \"We recorded $3,200 of amortization of capitalized contract costs\" -> $3,200 = CapitalizedContractCostAmortization.\n\n3) Count of business lines -> NumberOfOperatingSegments\n- Exact lexical anchors (case-insensitive): /primary\\s+business\\s+lines\\b/, /business\\s+lines\\s+include\\b/, /operating\\s+segments\\b/, /the\\s+number\\s+of\\s+operating\\s+segments\\b/, /we\\s+have\\s+\\d+\\s+primary\\s+business\\s+lines\\b/.\n- Association window: detect an explicit numeric token (cardinal) within ±6 tokens of 'primary business lines'/'operating segments' or in clause like 'Its four primary business lines include...'; map that numeric to NumberOfOperatingSegments.\n- Normalization & cardinal detection: accept both numerals and words ('four', 'three'); convert words to integer via dictionary mapping before assignment.\n- Period-invariance / scope: counts are structural facts — tag is invariant to reporting period. If sentence pairs count with time qualifiers (e.g., 'as of December 31'), attach date metadata but assign NumberOfOperatingSegments regardless of period length.\n- Negative-prevention: if sentence lists business lines without an explicit numeric (e.g., 'Its primary business lines are A, B and C') do not auto-assign a numeric tag; flag for extraction of count via list-length only if deterministic tokenization is available and confidence threshold met.\n- Unit-tests (atomic):\n  - \"Its four primary business lines include...\" -> 4 = NumberOfOperatingSegments.\n  - \"The Company operates in three operating segments\" -> 3 = NumberOfOperatingSegments.\n\n4) Overarching tie-breaker & implementation notes\n- Specificity precedence order (apply when 'amortization' appears): (1) AmortizationOfIntangibleAssets (if 'intangible' + 'acquired'/'acquisition' present), (2) CapitalizedContractCostAmortization (if 'deferred contract costs' or 'capitalized contract costs' present), (3) other asset-specific amortization tags, (4) generic AmortizationExpense.\n- Apply these rules before any generic 'amortization' -> AmortizationExpense fallback in the pipeline.\n- Logging: for any override of generic amortization, record matched anchor spans, antecedent resolution span (if cross-sentence), chosen tag, and period metadata (three-month/six-month/annual) for QA.\n- Add unit-tests to regression suite covering three- and six-month variants, cross-sentence antecedent cases, and negative cases where 'deferred' appears without 'contract'.\n[ctx-00012] helpful=1 harmful=0 :: Atomic lexical-descriptor precedence: map precise numeric descriptors to the exact debt/credit tag before any classifier or nearest-lexical fallback. Rules (apply in order):\n1) Exact-descriptor detection (case-insensitive regexes, apply exact-match first):\n   - /\\boutstanding\\s+(in|under)?\\s*(letters?\\s+of\\s+credit)\\b|letters?\\s+of\\s+credit\\s+outstanding\\b/ -> LettersOfCreditOutstandingAmount\n   - /(?:notes|note)\\s+(?:issued|issued\\s+at|issued\\s+in)\\b|(?:euro|EUR|€)\\s*[-\\d,\\.]+\\s+notes\\s+issued/ -> DebtInstrumentFaceAmount\n   - /\\b(principal\\s+amount|face\\s+amount|stated\\s+face\\s+amount|principal\\s+of\\s+the\\s+notes)\\b/ -> DebtInstrumentFaceAmount\n   - /\\bestimated\\s+fair\\s+value\\s+of\\s+long-?term\\s+debt\\b|\\bfair\\s+value\\s+of\\s+long-?term\\s+debt\\b/ -> LongTermDebtFairValue\n   - /\\bcarrying\\s+(amount|value)\\s+of\\s+debt\\b|book\\s+value\\s+of\\s+debt\\b/ -> DebtInstrumentCarryingAmount\n2) Token-window: require the descriptor match to co-occur within ±8 tokens of the numeric token or in the same clause; allow antecedent resolution in previous sentence up to ±1 sentence only when anaphoric phrase used (\"the notes\", \"the facility\") and antecedent span <= 40 tokens.\n3) Precedence (if multiple descriptors detected): fair-value descriptors > carrying/book-value descriptors > principal/face/issued descriptors > outstanding/letters-of-credit descriptors (i.e., map to the most semantically specific descriptor present). Implement as ordered checks above so first-match wins.\n4) Override rule: when an exact-descriptor regex matches, it MUST override any generic debt, interest or capacity mapping produced by other heuristics or classifiers; record the override in the log with descriptor span and numeric span.\n5) Ambiguity handling: if no exact-descriptor match found within windows, DO NOT guess between face/carrying/fair-value — fall back to the semantic classifier but tag the result as 'low-confidence-descriptor' and queue for human review. If two conflicting exact-descriptor phrases are matched with equal specificity and cannot be resolved by precedence, mark 'descriptor-conflict' and queue for human review.\n6) Unit-tests (atomic examples to add):\n   - \"$144.5 million outstanding in letters of credit and guarantees\" -> LettersOfCreditOutstandingAmount = $144.5M\n   - \"€300,000 euro-denominated notes issued on March 1\" -> DebtInstrumentFaceAmount = €300,000\n   - \"€600,000 of euro-denominated notes issued\" -> DebtInstrumentFaceAmount = €600,000\n   - \"the estimated fair value of long-term debt was $X\" -> LongTermDebtFairValue = $X\n   - \"carrying amount of the senior notes was $Y\" -> DebtInstrumentCarryingAmount = $Y\n7) Logging & provenance: record descriptor regex span, numeric token span, chosen tag, rule-id ('literal-descriptor-precedence'), and confidence. Any forced-override of classifier must be recorded with reason string (which exact-descriptor matched).\n8) Implementation note: place this rule before generic numeric-to-debt-tag fallbacks, before spread/interest heuristics, and before nearest-lexical-match rules to ensure literal descriptor mapping is always prioritized.\n[ctx-00013] helpful=0 harmful=0 :: Atomic heuristic: Disambiguate scheduled payments (installments/dates) vs acquisition consideration (required-positive-acquisition-cues) — apply BEFORE misc-00002 and before any generic 'payments -> BusinessCombinationConsiderationTransferred1' fallback.\n\n1) Purpose: avoid mapping plain installment schedules to BusinessCombinationConsiderationTransferred1 unless explicit acquisition lexicon/role is present.\n\n2) Required positive-acquisition cues (case-insensitive regexes). At least one MUST be present in the same sentence OR within ±1 sentence antecedent (antecedent span <= 40 tokens) to tag a payment as BusinessCombinationConsiderationTransferred1: /\\b(acquir(e|ed|ing)|acquisition|purchase(?:d|s| price| price of)?|purchase price|consideration(?: transferred)?|closing(?: date)?|seller\\b|purchase\\s+price\\b|paid\\s+as\\s+consideration|in\\s+consideration\\s+for)\\b/i.\n\n3) Installment-schedule negative/RepaymentsOfDebt cues (case-insensitive). If any of these appear in the same clause/sentence (preferred) map nearest numeric(s) to RepaymentsOfDebt unless positive-acquisition cues (step 2) are present: /\\binstallment(s)?\\b|installment\\s+payments|installments\\s+of|repay(ment|ments)?\\b|principal\\b|note\\b|loan\\b|maturity\\b|due\\s+on\\s|first\\s+payment\\b|second\\s+payment\\b|by\\s+\\w+\\s+\\d{1,2},?\\s+\\d{4}\\b|on\\s+February\\s+14,?\\s+2018\\b|shall\\s+pay(s|able)?\\b|will\\s+make\\s+\\w+\\s+payment(s)?\\b/ i (include generic date-form regex: /\\b(january|february|march|april|may|june|july|august|september|october|november|december)\\s+\\d{1,2},?\\s+\\d{4}\\b/i).\n\n4) Decision flow (apply in order for each numeric currency token in a payment clause):\n  a) If positive-acquisition cue present within window -> allow BusinessCombinationConsiderationTransferred1 mapping but require an explicit composition phrase tying the numerics to consideration (e.g., 'consideration of', 'purchase price includes', 'paid as part of the purchase') within ±12 tokens of the numeric. If that composition phrase is absent, flag as 'acquisition-cue-no-composition' and require human review.\n  b) Else if installment-schedule negative/RepaymentsOfDebt cue present within same clause/sentence (±8 tokens) -> map numeric -> RepaymentsOfDebt (highest precedence).\n  c) Else if only generic 'payments'/'paid' lexical match exists (no acquisition cue and no installment cue) -> prefer RepaymentsOfDebt by default for dated or scheduled forms; otherwise defer to semantic classifier but mark low-confidence and log for review.\n\n5) Conflict / mixed-cues tie-breaker:\n  - If both acquisition-cue and installment-cue appear, prefer BusinessCombinationConsiderationTransferred1 only when acquisition-cue + composition phrase co-occur (see 4a). If acquisition-cue exists but only a generic 'installment' schedule is present and no composition phrase, prefer RepaymentsOfDebt and log as 'installment-with-acquisition-mention-ambiguous'.\n\n6) Token windows & antecedents:\n  - Positive-acquisition cue window: same sentence OR previous sentence (±1 sentence) with antecedent span <= 40 tokens.\n  - Installment-schedule window: same clause/sentence; date proximity within ±6 tokens of numeric strongly signals schedule.\n\n7) Unit-tests / minimal examples to add (atomic):\n  - 'The Company will make four installment payments ... SFG shall make a first payment to Canarc in the amount of $25,000 by February 14, 2018 ...' -> $25,000 (and other installment amounts) => RepaymentsOfDebt.\n  - 'At closing, the purchase price shall be $1,000,000, with $250,000 payable on closing and $750,000 payable in four installments as consideration.' -> both installment amounts linked by 'consideration' -> BusinessCombinationConsiderationTransferred1 (if composition phrase 'as consideration' present).\n  - 'Buyer will pay $100,000 on closing and $50,000 on each anniversary as remaining consideration for the acquisition.' -> mapped to BusinessCombinationConsiderationTransferred1 (positive acquisition cue + composition phrase).\n  - 'The seller will receive four installment payments: $10,000 on March 1, 2018; $10,000 on June 1, 2018' (no acquisition words) -> RepaymentsOfDebt.\n\n8) Logging & QA:\n  - All mappings using this rule must record: matched positive-acquisition cue span (if any), matched installment-schedule cue span (if any), numeric span, chosen tag, decision-branch (4a/4b/4c), and any composition-phrase span. Cases where acquisition-cue existed but composition phrase was missing must be queued 'acquisition-cue-no-composition' for human review and added to retraining set.\n\n9) Implementation note: insert this rule BEFORE misc-00002 micro decision flow and before any generic 'nearest-lexical-match' fallbacks; ensure classifiers respect this explicit rule for payment-schedule contexts.\n[ctx-00015] helpful=0 harmful=0 :: Delta rule: Depreciable-life & Depreciation atomic mapping\n\nPurpose: deterministically map year-duration tokens that describe asset useful lives -> PropertyPlantAndEquipmentUsefulLife, and monetary tokens labeled as depreciation -> Depreciation. Also enforce exact-tag existence before assignment and safe fallbacks.\n\nExact lexical cues (case-insensitive regexes):\n- Useful-life anchors (must be present to map years): /\\b(depreciable life|depreciable lives|useful life|useful lives|estimated useful life|estimated life|life of (?:the )?(?:asset|assets|building|machinery|equipment|property))\\b/i\n- Year token forms to capture (within allowed window): /\\b\\d{1,3}\\s*(?:-\\s*year|year|years|yrs)\\b|\\b\\d{1,3}\\b(?=\\s+years?)|\\b\\d{1,3}-year\\b/i\n- Depreciation monetary anchors: /\\bdepreciation expense(s)?\\b|\\bdepreciation charge(s)?\\b|\\bdepreciation and amortization\\b|\\bdepreciation\\b/ i\n\nAssociation windows & rules (apply in order):\n1) For any numeric token that matches a year form: require presence of a Useful-life anchor in the same sentence OR within ±1 sentence antecedent (antecedent span <= 40 tokens). Token-distance window for anchor-to-numeric = ±8 tokens in same sentence; cross-sentence allowed only with explicit anaphor ('the useful life', 'these depreciable lives') and antecedent resolution.\n2) If rule 1 satisfied -> before assignment check tag list for exact string 'PropertyPlantAndEquipmentUsefulLife'. If present, assign that exact tag to the numeric (unit = years). If exact tag absent, search tag list for any tag containing substring 'PropertyPlantAndEquipment' AND 'UsefulLife' (literal substring) and prefer the most specific match; if none found, DO NOT auto-map — flag 'useful-life-tag-missing' for human review and record suggested mapping.\n3) Asset-specific disambiguation: if an asset-class token (building, plant, machinery, equipment, leasehold, furniture, fixtures, vehicle, software) appears in same sentence within ±12 tokens of the useful-life anchor, attempt to match a more specific taxonomy tag by looking for exact tag-name that combines asset-class + 'UsefulLife' (literal substring match). If such exact tag exists in tag list, prefer it over the generic PropertyPlantAndEquipmentUsefulLife; otherwise fall back to PropertyPlantAndEquipmentUsefulLife.\n4) Negative-safeguard: do NOT assign when the numeric-year phrase attaches to non-asset governing nouns (e.g., 'term', 'contract', 'license', 'agreement', 'service life of contract') unless text also contains asset/depreciation anchors. If both 'term/expire' and 'useful life' co-occur, prefer the anchor that syntactically governs the numeric (use dependency nummod/governor if available); if ambiguous, flag for review.\n\nDepreciation monetary mapping:\n1) For any currency numeric token in same sentence with Depreciation monetary anchors (within ±12 tokens): check tag list for exact string 'Depreciation'. If present assign that tag to the currency amount and link to any nearby asset anchor if present (token-distance <= 20) for provenance.\n2) If 'depreciation and amortization' present and only combined tag exists (e.g., 'DepreciationAndAmortization' literal in tag list), prefer the combined tag; otherwise map currency to 'Depreciation' and log 'amortization-combined-text' for QA.\n3) If depreciation anchor present but numeric is reported as 'zero', 'none', or negative parentheses, normalize numeric appropriately (0 or negative) and record the negation cue span.\n\nPrecedence & tie-breakers:\n- Useful-life-year mapping (when anchor present) overrides generic numeric->duration fallbacks (e.g., 'years' as tenure/contract) if asset anchor detected.\n- Depreciation monetary mapping overrides generic expense/cost tags when the lexical anchor 'depreciation' is present and an exact 'Depreciation' tag exists.\n\nAmbiguity handling & logging:\n- If exact tag strings required by the rule are absent from provided tag list, do not auto-assign; flag 'exact-tag-missing' and include matched cue spans, numeric span, and suggested exact tag-name (PropertyPlantAndEquipmentUsefulLife or Depreciation) in the review payload.\n- All auto-assignments must log: matched anchor span, numeric token span, chosen tag name (exact), rule-id 'ctx-depr-life-0001', and confidence level.\n\nUnit-tests (atomic examples to add):\n- 'Buildings have a useful life of 20 years' -> 20 years = PropertyPlantAndEquipmentUsefulLife (asset-class 'building' used to prefer building-specific useful-life tag if present).\n- 'Machinery and equipment are depreciable lives of 40 years and 20 years respectively' -> 40 and 20 years = PropertyPlantAndEquipmentUsefulLife with asset-specific preference where available.\n- 'The estimated useful life is three years for certain equipment' -> 3 years = PropertyPlantAndEquipmentUsefulLife.\n- 'Depreciation expense for the year was $467 million' -> $467 million = Depreciation.\n- 'Depreciation and amortization totaled $X' -> assign DepreciationAndAmortization if that exact tag exists, else assign Depreciation and log combined-cue.\n\nImplementation note: place this rule before generic 'years -> duration' fallbacks and before generic currency->expense fallbacks. Ensure exact-string tag lookup is performed atomically and failures are routed to human-review instead of greedy nearest-lexical mapping.\n[ctx-00016] helpful=0 harmful=0 :: ctx-00016 :: Multi-amount interest-charge -> InterestExpenseDebt (atomic heuristic)\n- Purpose: when a clause or sentence contains one interest lexical cue and one instrument-anchor but multiple currency amounts (e.g., amounts for multiple periods or enumerated amounts), assign each currency amount to the instrument-specific InterestExpenseDebt and attach the correct period metadata.\n- Exact lexical cues (case-insensitive): /interest\\s+charge(s)?\\b/, /interest\\s+expense(s)?\\b/, /interest\\s+on\\s+the\\s+(note|notes|loan|term\\s+loan|seller\\s+note|revolver)/i. Instrument-anchor detection: same instrument-name lexicons as ctx-00012 (Seller Notes, Term Loan, Revolver, Senior Notes, etc.) allowing antecedent resolution ±1 sentence and span <=40 tokens.\n- Multi-amount detection & association policy:\n  1) If a sentence/clause contains an interest lexical cue AND an instrument-anchor (same sentence OR antecedent ±1 sentence within 40 tokens) AND contains >=1 currency numeric token, then for EACH currency numeric token in that clause/sentence: assign InterestExpenseDebt linked to the detected instrument id.\n  2) Token-distance windows: primary association window for interest cue -> each currency numeric = ±12 tokens; if a currency falls outside ±12 but remains in the same clause/sentence and only one instrument-anchor/interest-cue exists, still map it to InterestExpenseDebt but mark mapping as 'long-span' and log distances.\n- Period association rules:\n  1) If period-label tokens appear (e.g., 'for the year ended', 'for the six months ended', '2019', '2018', 'three months ended March 31, 2019') associate each currency numeric to the nearest period token within ±10 tokens. For comma-separated lists like \"$A, $B and $C for 2019, 2018 and 2017\" map numerics to years by nearest-year-token order alignment (left-to-right pairing) when explicit year tokens appear; otherwise attach no-period metadata and flag 'multi-amount-no-period'.\n  2) If explicit period tokens are absent but the sentence is a comparative table-like list ('for the year ended 2019, 2018 and 2017: $A, $B, $C'), pair by sequence (left-to-right) and log the heuristic pairing.\n- Zero-normalization: if any numeric is a negation ('no interest', 'none', 'zero') within ±6 tokens of interest cue and instrument-anchor present, normalize to 0 and assign InterestExpenseDebt=0; log negation and anchor spans.\n- Precedence: this multi-amount rule overrides generic InterestExpense mapping and any classifier fallbacks when instrument-anchor present. If instrument-anchor absent, map amounts to generic InterestExpense and flag each numeric with 'interest-amount-no-instrument' for review.\n- Logging & provenance: for each mapped numeric record: numeric span, interest-cue span, instrument-anchor span and instrument id, period token span (if any), token distances, and rule-id 'ctx-00016'. Aggregate 'interest-amount-no-instrument' cases into QA queue.\n- Unit-tests (atomic examples to add):\n  - '$179,507, $160,000, $140,000 and $120,000 of interest charges associated with the Term Loan for the years ended 2019, 2018, 2017 and 2016' -> map each amount to InterestExpenseDebt (Term Loan) with respective years (2019,2018,2017,2016).\n  - '$331,397 of interest expense for the six months ended June 30 and $179,507 for the year ended December 31, related to the Term Loan' -> both amounts -> InterestExpenseDebt (Term Loan) with appropriate period tags.\n  - 'No interest expense was recorded on the Term Loan' -> InterestExpenseDebt = 0 (logged negation).\n  - 'Interest charges of $10, $20 and $30' (no instrument-anchor) -> each -> generic InterestExpense; each flagged 'interest-amount-no-instrument'.\n- Implementation note: run this rule immediately after ctx-00012 detection and before any generic numeric-to-expense fallbacks; require logging for traceability and include test cases in regression suite.\n[ctx-00017] helpful=0 harmful=0 :: ctx-SBC-00001 :: Share-based-compensation semantic-modifier precedence (atomic heuristic)\nPurpose: deterministically map numeric tokens in share-based compensation clauses to the most specific share-based XBRL element by prioritizing semantic modifiers (intrinsic, exercised, vest/vesting, up to/authorized) and plan anchors.\nRules (apply in order):\n1) Exact-modifier detection (case-insensitive regexes; exact-match first):\n   - INTRINSIC+EXERCISED cues -> /intrinsic\\s+value(?:\\s+of)?\\s+(?:the\\s+)?(?:options|option(s)?)\\s*(?:exercis(ed|ing|es)?)?/i\n   - VESTING-duration cues -> /(vest(?:s|ed|ing)?|vesting)\\b.*?(?:over|in|period|for)?|(?:for\\s+a\\s+period\\s+of)\\s*\\d+/i and year-token forms (see token forms below)\n   - AUTH/MAX/\"up to\" shares cues -> /(?:up\\s+to|maximum\\s+number|authorized\\s+to\\s+issue|may\\s+be\\s+delivered|authorized\\s+and\\s+reserved)\\b/i plus share token\n   - SHARES token -> /\\bshare(s)?\\b|shares\\s+available\\b|shares\\s+authorized\\b/i\n2) Token association windows: require the numeric token to co-occur within ±8 tokens of the detected semantic modifier cue in the same sentence for high-confidence mapping. Allow antecedent plan-anchor resolution from the previous sentence when the phrase 'the Plan' or a named plan is used (±1 sentence, antecedent span <= 40 tokens).\n3) Mapping decisions (highest-specificity-first):\n   a) If INTRINSIC+EXERCISED cue matches near numeric -> assign OptionsExercisesIntrinsicValue (the numeric is the total intrinsic value of options exercised). This mapping MUST override any generic monetary/expense tag.\n   b) Else if VESTING-duration cue matches and numeric is a year-duration token (e.g., 'three', '4', 'three- or four-year', token forms: /\\b\\d{1,3}\\b\\s*(?:-year|years?)|\\b(one|two|three|four|five|six|seven|eight|nine|ten)\\b\\s+years?\\b|\\bthree-\\s*or\\s*four-?year\\b/i) -> assign ShareBasedCompensationArrangementByShareBasedPaymentAwardAwardVestingPeriod1 (vest/vesting duration tag). Link time-unit 'years' metadata.\n   c) Else if AUTH/MAX/'up to' + SHARES cue matches near numeric and plan-anchor present (plan name or 'the Plan' antecedent) -> assign ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized. If plan-anchor missing but 'up to' + shares present in same sentence and corporate-reserved cues (ESPP/common stock) absent, still assign authorized tag but mark 'no-plan-anchor' in log for QA.\n   d) Fallback: when share-count numeric occurs with plan-anchor and availability-language ('available', 'remain available') -> assign ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant (including denial-to-zero rules if negation present).\n4) Precedence & tie-breakers: when multiple candidate tags apply, prefer the candidate that encodes BOTH the metric and the semantic modifier (e.g., OptionsExercisesIntrinsicValue beats generic 'monetary amount' or generic 'share-based compensation expense'). Precedence order: INTRINSIC+EXERCISED mapping > VESTING-duration mapping (when duration attached to vest) > AUTH/MAX/'up to' authorized shares > plan-availability mappings > generic share/issuance tags.\n5) Negation and normalization: apply existing negation-to-zero rules (err-00002) for availability/authorized phrases when negation cues (no/none/not available/zero) appear within ±6 tokens of availability nouns and plan-anchor is present.\n6) Unit-tests (atomic examples to add):\n   - 'total intrinsic value of options exercised ... $37 million' -> $37,000,000 => OptionsExercisesIntrinsicValue\n   - 'awards vest over a three to four years period' -> 'three' and 'four' years => ShareBasedCompensationArrangementByShareBasedPaymentAwardAwardVestingPeriod1 (range handling: record as 3-4 years)\n   - 'up to 12.5 million shares ... allows for the grant under the Plan' -> 12,500,000 => ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized\n   - 'no shares remain available under the 2014 Long Term Incentive Plan' -> 0 => ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant = 0 (negation logged)\n7) Logging & QA: every mapping must record numeric span, matched semantic-modifier span, plan-anchor span (if any), chosen tag, competing tags with score differences, and rule-id 'ctx-SBC-00001'. If plan-anchor is absent for an 'authorized' mapping or if multiple candidate tags score within threshold, flag 'sbc-modifier-ambiguous' and queue for human review.\n8) Implementation note: run this rule immediately after plan-anchor detection (ctx-00001/ctx-00007) and before generic lexical-to-tag fallbacks to prevent misclassification. Add the unit-tests above to regression suite and surface logged ambiguous cases for targeted retraining.\n[ctx-00018] helpful=0 harmful=0 :: ctx-DELTA-001 :: Atomic count-disambiguation: 'reportable segments' vs 'operating segments' (prevent over-generalization)\n- Purpose: when a cardinal word/number quantifies segments, prefer the most specific segment noun present in text. Prevent mapping 'reportable segments' counts to NumberOfOperatingSegments.\n- Exact lexical cues (case-insensitive): /reportable\\s+segment(s)?\\b/, /classified\\s+into\\s+reportable\\s+segment(s)?\\b/, /number\\s+of\\s+reportable\\s+segments\\b/, /reportable\\s+operating\\s+segment(s)?\\b/.\n- Association window: if a numeric cardinal token (word or digit) appears within ±8 tokens of any 'reportable' cue in the same sentence, assign NumberOfReportableSegments. Allow antecedent 'the reportable segments' resolved from previous sentence (±1 sentence, antecedent span <= 40 tokens) when anaphor present.\n- Tie-breaker / precedence: when both 'reportable' and 'operating segments' cues appear, prefer NumberOfReportableSegments. More generally, prefer the tag whose lexical noun phrase exactly matches the noun modifier (e.g., 'reportable' is more specific than 'operating').\n- Negative-prevention: do NOT map a count to NumberOfOperatingSegments when 'reportable' is present anywhere in the same clause or sentence. If 'operating segments' appears but 'reportable' appears only in a different clause and antecedent resolution confidence < threshold, flag as 'segment-count-ambiguous' for review instead of auto-mapping.\n- Unit-tests (atomic):\n  - \"The Company is classified into three reportable segments\" -> 3 => NumberOfReportableSegments.\n  - \"We operate in four operating segments; three are reportable\" -> 'three' => NumberOfReportableSegments (three attaches to 'reportable'); 'four' => NumberOfOperatingSegments if explicitly anchored.\n  - \"The number of reportable segments was three as of December 31\" -> 3 => NumberOfReportableSegments.\n- Logging: record matched cue-span ('reportable' span), numeric span, antecedent span (if used), chosen tag and 'ctx-DELTA-001'.\n[ctx-00019] helpful=0 harmful=0 :: ctx-DELTA-002 :: Atomic AOCI-reclassification -> CumulativeEffectOfNewAccountingPrincipleInPeriodOfAdoption (prevent tax-default on reclassifications)\n- Purpose: when a reclassification involving tax effects is described in connection with Accumulated Other Comprehensive Income (AOCI) and adoption/filing language is present, map to a cumulative-effect/adoption tag rather than routine IncomeTaxExpenseBenefit.\n- Strong lexical-conjunction pattern (case-insensitive) — require at least two of the following clusters (one MUST be the 'AOCI' cluster):\n  A) AOCI cluster: /Accumulated\\s+Other\\s+Comprehensive\\s+Income\\b|AOCI\\b|accumulated other comprehensive income/i\n  B) Reclassification cluster: /reclassif(?:y|ication|ied)\\b|reclassification\\s+entry\\b|reclassified\\b|reclassed\\b|reclass\\b/i\n  C) Stranded-tax cluster: /stranded\\s+tax(?:\\s+effect)?s?\\b|stranded\\s+taxes\\b|stranded\\s+tax\\s+effects\\b/i\n  D) Adoption/filing/timing cluster: /in\\s+period\\s+of\\s+adoption\\b|period\\s+of\\s+adoption\\b|on\\s+adoption\\b|adoption\\b|filed\\s+in\\s+the\\s+Annual\\s+Report\\b|Annual\\s+Report|effective\\s+upon\\s+adoption|one-?time\\s+adjustment\\b|cumulative\\s+effect\\b|transition\\b|upon\\s+adoption/i\n- Decision rule (apply in order):\n  1) If AOCI cluster present AND Reclassification cluster present AND (Stranded-tax cluster OR Adoption/filing cluster) present within same sentence OR within ±1 sentence antecedent resolution (antecedent span <= 40 tokens) -> assign CumulativeEffectOfNewAccountingPrincipleInPeriodOfAdoption (or the taxonomy's exact cumulative-adoption tag if available).\n  2) If AOCI + Reclassification present but neither Stranded-tax nor Adoption cues present -> DO NOT default to IncomeTaxExpenseBenefit; instead flag as 'AOCI-reclass-ambiguous' for human review (prefer human review to mis-mapping).\n  3) If AOCI + Reclassification + tax-word only (e.g., 'tax effects') but no adoption/filing signals, prefer CumulativeEffect tag only when explicit one-time/adoption cues (see cluster D) exist; otherwise queue for review.\n- Override of generic tax heuristics: when rule 1 matches, this mapping MUST override any IncomeTaxExpenseBenefit assignment even if 'income tax' or 'tax expense' literal appears near the numeric. Record that lexical 'tax' was observed and that cumulative-adoption override was applied.\n- Association windows: numeric currency token must be within ±12 tokens of at least one of the matched cluster cues; allow period mapping (year/filing note) via nearest-year-token within ±10 tokens.\n- Negative-prevention: do NOT assign IncomeTaxExpenseBenefit by default when 'reclassification' + 'AOCI' are present; instead apply this rule first. If adoption signals absent and ambiguity high, prefer human review rather than tax-expense fallback.\n- Example unit-tests (atomic):\n  - \"A reclassification of $280 of stranded tax effects from Accumulated Other Comprehensive Income was recorded on adoption and disclosed in the Annual Report\" -> $280 => CumulativeEffectOfNewAccountingPrincipleInPeriodOfAdoption.\n  - \"We recorded a reclassification entry in AOCI for stranded tax effects related to the post-retirement plan upon adoption\" -> reclassification amount => CumulativeEffectOfNewAccountingPrincipleInPeriodOfAdoption.\n  - \"AOCI reclassification of $X is reported (see filing)\" -> $X => CumulativeEffectOfNewAccountingPrincipleInPeriodOfAdoption (if filing/adoption signals detected) else flag 'AOCI-reclass-ambiguous'.\n- Logging & QA: record matched cluster spans, numeric span, chosen tag, whether IncomeTaxExpenseBenefit was suppressed, rule-id 'ctx-DELTA-002', and confidence. Queue 'AOCI-reclass-ambiguous' cases for human review and add to regression set.\n[ctx-00020] helpful=0 harmful=0 :: Delta rule: Plan-specific 'authorized under' -> ShareBasedCompensation NumberOfSharesAuthorized (atomic heuristic)\n\nPurpose: When a numeric share-count appears with 'authorized'/'authorized to issue'/'authorized to be issued' or the preposition 'under' that directly references a named plan (e.g., 'Dividend Reinvestment Plan', 'Stock Option Plan', 'the Plan'), map to ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized rather than a generic CommonStockCapitalSharesReservedForFutureIssuance.\n\nExact lexical patterns (case-insensitive regexes; exact-match first):\n- authorized patterns: /\\bauthori(ze|s?ed)\\b(?:\\s+to\\s+(?:issue|be\\s+issued))?/i, /\\bmay\\s+be\\s+delivered\\b/i, /\\bmaximum\\s+number\\s+of\\s+shares\\b/i, /\\bup\\s+to\\b\\s+[0-9,]+\\s+shares\\b/i\n- 'under' plan pattern: /\\bunder\\s+(?:the\\s+)?([A-Z][A-Za-z0-9\\-\\s]{2,60}Plan|Dividend\\s+Reinvestment\\s+Plan|Employee\\s+Stock\\s+Purchase\\s+Plan|ESPP|stock\\s+plan|the\\s+Plan)\\b/i\n- plan-name detection variants: /\\b(Plan|LTIP|Long\\s+Term\\s+Incentive\\s+Plan|Stock\\s+Purchase\\s+Plan|Dividend\\s+Reinvestment\\s+Plan|ESPP)\\b/i\n\nAssociation windows & antecedent resolution:\n- High-confidence: numeric token within ±8 tokens of an 'authorized' cue AND the same clause contains an 'under <PlanName>' match -> assign ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized.\n- Antecedent resolution: if 'the Plan' appears instead of the explicit name, allow antecedent plan-name resolution from the previous sentence within ±1 sentence (antecedent span <= 40 tokens). If antecedent resolves to a plan-like name, apply the same mapping.\n\nPrecedence / tie-breaker rules (apply before generic 'reserved' mapping):\n1) If ('authorized' OR 'maximum' OR 'up to') + 'under' + plan-anchor -> map to ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized (force override of CommonStockCapitalSharesReservedForFutureIssuance).\n2) If 'reserved for future issuance' co-occurs with a plan-anchor but the plan-anchor is an ESPP or text explicitly references 'shares of common stock were initially reserved for issuance under the 2016 ESPP' -> map to CommonStockCapitalSharesReservedForFutureIssuance only when plan type is ESPP and language emphasizes corporate charter/issuance under ESPP; otherwise prefer plan-authorized tag when 'authorized' language present.\n3) If only 'reserved' + plan reference present and no 'authorized'/'maximum'/'up to' cues, prefer ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized when award/instrument cues (option/award/RSU/available for grant) co-occur within ±8 tokens; if common-stock noun ('Class A common stock') or explicit charter/header mention occurs instead, prefer CommonStockCapitalSharesReservedForFutureIssuance.\n\nNegative-safeguard (prevent false-positive):\n- Do NOT map to plan-authorized tag when numeric is adjacent to corporate/charter headings ('under the charter', 'authorized by the certificate of incorporation') and no plan or award words appear within ±12 tokens. In such cases map to CommonStockCapitalSharesReservedForFutureIssuance.\n\nUnit-tests (atomic examples to add):\n- 'The Company is authorized to issue 1,000,000 shares of common stock to stockholders under the Dividend Reinvestment Plan.' -> 1,000,000 = ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized (match 'authorized' + 'under <PlanName>').\n- 'Maximum number of shares that may be delivered under the Plan is 15,000,000.' -> 15,000,000 = ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized.\n- 'A total of 3,800,000 shares of Class A common stock were initially reserved for issuance under the 2016 ESPP.' -> 3,800,000 = CommonStockCapitalSharesReservedForFutureIssuance (ESPP + 'Class A common stock' -> charter/ESPP exception).\n- 'Options to purchase 989,081 shares were authorized and reserved for future grant under the Plan.' -> 989,081 = ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized (award cue + authorized + under Plan).\n\nLogging and QA: For every mapping made by this rule record: numeric span, matched 'authorized' cue span, matched 'under <PlanName>' span (or resolved antecedent), chosen tag, competing tag(s) with score differential, decision branch (precedence clause used), and a flag when an ESPP/charter exception applied. Queue ambiguous reserved+plan cases (no 'authorized' and conflicting cues) under 'reserved-plan-ambiguous' for human review.\n\nImplementation note: Insert this rule immediately after plan-anchor detection (ctx-00001/ctx-00007/ctx-DELTA rules) and BEFORE any generic 'reserved' -> CommonStockCapitalSharesReservedForFutureIssuance fallback to eliminate the misclassification observed in the reflection.\n[ctx-00021] helpful=0 harmful=0 :: [ctx-00021] helpful=0 harmful=0 :: Atomic heuristic: Map percentage tokens that express an effective income tax rate -> EffectiveIncomeTaxRateContinuingOperations\n- Purpose: deterministically map percents that denote the company's effective income tax rate (including continuing-operations qualifiers and prior-period variants) to the canonical EffectiveIncomeTaxRateContinuingOperations tag and avoid mis-mapping to generic percentage tags.\n- Exact lexical cues (case-insensitive regexes; apply exact-match first): /effective\\s+tax\\s+rate\\b/, /effective\\s+income\\s+tax\\s+rate\\b/, /effective\\s+rate\\s+of\\s+income\\s+tax(es)?\\b/, /income\\s+tax\\s+rate\\b/, /effective\\s+tax\\s+rate\\s+for\\s+continuing\\s+operations\\b/, /effective\\s+rate\\b.*?for\\s+income\\s+tax(es)?/i.\n- Association window: require the percentage token (forms: '\\d+(?:\\.\\d+)?%','\\d+\\.\\d+\\s+percent') to co-occur within ±6 tokens of one of the lexical cues above in the same sentence. Allow antecedent resolution to previous sentence (±1 sentence) only when anaphoric phrases like 'the effective rate'/'the rate' appear and antecedent span <= 40 tokens.\n- Precedence & override: when this rule matches, assign EffectiveIncomeTaxRateContinuingOperations and override any generic percentage-to-percentage-tag fallbacks (e.g., generic 'Percentage' tags) or unrelated percent heuristics (spreads, concentration) even if other percent cues exist. If co-occurring text mentions 'statutory', prefer a statutory-rate-specific tag if that exact taxonomy element exists; otherwise, prefer EffectiveIncomeTaxRateContinuingOperations only when 'effective' cue present.\n- Prior-period and multi-value handling: when sentence lists multiple percentages with period labels (e.g., '22.31%, 23.45% and 24.50% for 2019, 2018 and 2017'), map each percent to EffectiveIncomeTaxRateContinuingOperations with corresponding period metadata by nearest-year-token association (±6 tokens) or left-to-right pairing when explicit years are comma-aligned. Do not change tag by period — use same tag with period attribute.\n- Negative/false-positive prevention: do NOT map a percent to the effective-tax tag when the percent is clearly modifying non-tax nouns (examples to block): '/% of revenue|% of sales|% of our shareholders|percentage of shares outstanding|% owned by/'. Require presence of a tax lexical anchor (one of the regexes above) to map; otherwise do not auto-assign EffectiveIncomeTaxRateContinuingOperations.\n- Unit-tests (atomic examples):\n  - 'The effective tax rate was 22.31% for the year' -> 22.31% => EffectiveIncomeTaxRateContinuingOperations.\n  - 'Effective income tax rate: 22.31% (2019)' -> 22.31% => EffectiveIncomeTaxRateContinuingOperations (attach 2019).\n  - 'The effective rate of income taxes for continuing operations was 22.31%.' -> 22.31% => EffectiveIncomeTaxRateContinuingOperations.\n  - 'Statutory tax rate was 21%' -> do NOT map to EffectiveIncomeTaxRateContinuingOperations; map to StatutoryIncomeTaxRate if present, else flag for review.\n  - '22.31% of our revenues came from X' -> do NOT map (missing tax anchor) and flag/skip.\n- Logging & QA: log percent token span, matched tax-anchor span, chosen tag, period metadata (if any) and rule-id 'ctx-00021'. If antecedent resolution used or if mapping overrode a competing percent heuristic, record 'override-reason' in log. Add any ambiguous/no-anchor percent examples to retraining queue.\n- Implementation note: run this rule before generic percentage fallbacks and after tax-line polarity heuristics (ctx-00003) to ensure tax-rate percents are recognized and tagged consistently.\n[ctx-00022] helpful=0 harmful=0 :: Equity numeric-type + class-binding (atomic heuristic): Purpose: deterministically distinguish par/stated-value numbers from share-counts and bind each numeric to the correct equity-class tag (Common vs Preferred) when multiple equity-class mentions occur. Rules (apply in order):\n1) Numeric-type detection (exact lexical + format cues):\n   - Par/stated-value cues: exact lexical patterns (case-insensitive): /par\\s+value(?:\\s+per\\s+share)?/, /stated\\s+value(?:\\s+per\\s+share)?/, /par\\s+value\\s+of\\s+/; also explicit 'per share' or 'per common share' tokens. If such a cue appears in same sentence and a numeric token is within ±8 tokens, map numeric -> ParOrStatedValue tag for the relevant class.\n   - Par-value numeric format: decimals or currency amounts < 1 (e.g., 0.0001, $0.01) or decimals with leading zero are strong par-value signals when 'per share' present. Treat decimals <= 0.01 as HIGH-confidence par values if paired with 'per share' even when $ absent (e.g., '0.0001 par value per share').\n   - Share-count cues: lexical tokens /shares\\b/, /shares\\s+authorized\\b/, /authorized\\s+to\\s+issue\\s+up\\s+to/, /issued\\s+and\\s+outstanding/ within ±8 tokens of numeric; integer formats (no decimal point, may include commas) strongly indicate share counts.\n2) Class-binding (map to class-specific tag):\n   - Class anchors: detect stock-class nouns (case-insensitive) within same clause: /common stock|preferred stock|Class\\s+[A-Z]|Series\\s+[A-Z]|depositary share(s)?|par value per share of common stock/. If a class token appears within same sentence, prefer binding numeric to that class-specific tag variant (e.g., CommonStockParOrStatedValuePerShare, PreferredStockSharesAuthorized).\n   - Locality & precedence: primary association window = same clause / ±8 tokens. If multiple class tokens appear in same sentence, choose the class token with smallest token-distance to the numeric. If distances equal, prefer explicit 'of <class>' or 'shares of <class>' phrasing to bind (scan for /shares\\s+of\\s+(common|preferred)/ within clause). If still tied, use grammatical relation if parser available (numeric nummod attaches to noun phrase); otherwise flag for human review.\n3) Tag assignment mapping (explicit):\n   - If par/stated-value cue matched -> assign <Class>ParOrStatedValuePerShare (e.g., CommonStockParOrStatedValuePerShare or PreferredStockParOrStatedValuePerShare) using class-binding above.\n   - If share-count cue matched and class-binding identifies preferred/common -> assign <Class>SharesAuthorized (if 'authorize'/'authorized' anchor present) or <Class>SharesOutstanding / StockIssuedDuringPeriod... depending on issuance vs authorized cues (respect existing issuance/plan rules). Prefer Authorized tag when 'authorized' or 'authorize us to issue up to' present.\n4) Mixed-clause tie-breakers (multiple numbers + multiple classes):\n   - If a clause contains both a small decimal near 'per share' and a large integer near 'authorized' -> decimal -> ParOrStatedValue tag; integer -> SharesAuthorized tag. Enforce numeric-format sanity-check: decimals map to per-share value; integers map to counts.\n   - If two integers appear and two classes appear but ordering ambiguous, bind each integer to the nearest class token by token-distance; if both integers are identical magnitude or equidistant, prefer explicit class labeling order: when clause enumerates 'preferred stock: X shares; common stock: Y shares' parse label-order pairing left-to-right.\n5) Plan & charter exceptions: if plan-anchor or 'under the Plan' appears and 'authorized' token co-occurs, follow plan-specific authorized-vs-reserved rules (ctx-00007 / ctx-00020) after class-binding; do NOT convert plan-authorized numbers into CommonStockCapitalSharesReservedForFutureIssuance if text explicitly references a Plan-authorized 'shares' count for awards (use plan rules precedence).\n6) Edge/normalization rules:\n   - Accept decimal par values with or without a leading '$'. Normalize numeric to canonical decimal (e.g., '0.0001' -> 0.0001) and record unit 'per share'.\n   - Recognize 'no par value' / 'without par value' phrases: map to a 'NoParValue' flag on the equity instrument (do not assign ParOrStatedValue tag).\n7) Ambiguity & QA handling: when class-binding confidence < threshold (e.g., no class token within ±12 tokens and numeric format ambiguous) -> do NOT auto-assign class-specific tag; flag 'equity-class-binding-ambiguous' with spans for human review. Log both numeric span and nearest class spans and decision reason for traceability.\n8) Minimal unit-tests (atomic examples to add):\n   - 'The par value per share of common stock is $0.0001.' -> 0.0001 => CommonStockParOrStatedValuePerShare.\n   - 'The corporation is authorized to issue up to 10,000,000 shares of preferred stock.' -> 10,000,000 => PreferredStockSharesAuthorized.\n   - 'The Company has authorized 100,000,000 shares of common stock, par value $0.0001 per share.' -> 100,000,000 => CommonStockSharesAuthorized; 0.0001 => CommonStockParOrStatedValuePerShare.\n   - 'Authorized us to issue up to 5,000,000 shares of Series A preferred and 50,000,000 shares of Class A common.' -> 5,000,000 => PreferredStockSharesAuthorized; 50,000,000 => CommonStockSharesAuthorized (left-to-right class-pairing / nearest-binding).\n9) Implementation notes: run this rule early in equity/plan pipeline before generic 'per share' -> SaleOfStockPricePerShare and before nearest-lexical-match fallbacks. Record mapping provenance: numeric span, matched cue span ('par value' or 'shares authorized'), class token span, chosen tag, and confidence score.\n[ctx-00023] helpful=0 harmful=0 :: Share-based-compensation exact-lexical override (atomic heuristic):\n- Purpose: choose the literal ShareBasedCompensation taxonomy element when the sentence literally names recognized share-based compensation, and only prefer Allocated/Expense variants if allocation/expense-location qualifiers appear.\n- Exact lexical detection (case-insensitive regexes): /\\bshare-?based\\s+compensation\\b/, /recognized\\s+non-?cash\\s+share-?based\\s+compensation\\b/, /amounts\\s+recognized\\s+for\\s+share-?based\\s+compensation\\b/.\n- Allocation/expense qualifiers (must be present to select Allocated/Expense variant): /\\ballocat(ed|ion)\\b/, /\\bincluded\\s+in\\s+((costs|cost)\\s+of\\s+goods|selling,? general and administrative|operating\\s+expenses|research and development)\\b/, /\\bexpense(?:s)?\\b|compensation\\s+expense|recognized\\s+as\\s+expense/ (±8 tokens of numeric/token).\n- Decision flow (apply in order):\n  1) If share-based lexical detection matches near numeric (±8 tokens) AND taxonomy contains an exact element named 'ShareBasedCompensation' -> assign ShareBasedCompensation.\n  2) Exception: if allocation/expense qualifiers match in same sentence and are within ±12 tokens of numeric, THEN prefer AllocatedShareBasedCompensationExpense (or other 'Allocated/Expense' taxonomy candidate) but only when qualifier lexical match is explicit (see patterns above).\n  3) If both ShareBasedCompensation and an Allocated/Expense candidate exist but no explicit allocation/expense qualifier present -> prefer ShareBasedCompensation (literal-match override).\n- Association & antecedent: allow antecedent resolution ±1 sentence for anaphors ('these amounts','the foregoing compensation') if antecedent contains the share-based lexical cue; require antecedent span <=40 tokens.\n- Logging: record matched lexical spans, chosen tag, competing candidate tags and whether override applied ('literal-sharebased-over-allocated').\n- Unit-tests (atomic):\n  - 'recognized non-cash share compensation of $3.1, $3.6 and $2.9 million' -> each amount = ShareBasedCompensation.\n  - 'Total share-based compensation expense recognized in the period was $5.0 million' -> because 'compensation expense' qualifier present => AllocatedShareBasedCompensationExpense.\n  - 'We recognized $X of share-based compensation included in operating expenses' -> AllocatedShareBasedCompensationExpense (allocation/location present).\n- Implementation note: run this rule immediately after lexical candidate generation and before ctx-00002's blanket income-statement-preference so that literal taxonomy names are preferred unless explicit allocation/expense qualifiers exist.\n[ctx-00024] helpful=0 harmful=0 :: Nonvested-awards instrument-type suffix enforcement (atomic heuristic):\n- Purpose: when mapping 'unrecognized' / 'not yet recognized' compensation (nonvested awards), require matching any instrument-type suffix in taxonomy (e.g., 'ShareBasedAwardsOtherThanOptions') if the sentence lexically indicates awards other than options; otherwise map to the generic nonvested tag.\n- Exact lexical detection (case-insensitive regexes): UNRECOGNIZED cues = /unrecognized\\s+compensation\\s+expense|compensation\\s+not\\s+yet\\s+recognized|total\\s+compensation\\s+cost\\s+not\\s+yet\\s+recognized|compensation\\s+costs\\s+not\\s+yet\\s+recognized/; NON-OPTION INSTRUMENT cues = /other\\s+than\\s+options|awards\\s+other\\s+than\\s+options|restricted\\s+stock\\s+unit(s)?|RSU(s)?|unit\\s+appreciation\\s+right(s)?|UARs?|SARs?|dividend\\s+equivalent\\s+units?/.\n- Decision flow (apply in order):\n  1) If UNRECOGNIZED cue matches near numeric (±8 tokens) AND taxonomy contains a specific nonvested-awards element with suffix 'ShareBasedAwardsOtherThanOptions' (or similar exact string) AND NON-OPTION INSTRUMENT cue matches in same sentence or antecedent (±1 sentence) -> assign the specific element (e.g., EmployeeServiceShareBasedCompensationNonvestedAwardsTotalCompensationCostNotYetRecognizedShareBasedAwardsOtherThanOptions).\n  2) Else if UNRECOGNIZED cue matches but NO non-option instrument lexical cue present -> assign the generic nonvested-awards element (e.g., EmployeeServiceShareBasedCompensationNonvestedAwardsTotalCompensationCostNotYetRecognized) if present.\n  3) Else if NON-OPTION instrument cue present but UNRECOGNIZED cue absent, do not force nonvested mapping — prefer instrument-specific grants/outstanding mapping rules (ctx-00008/ctx-SBC-00001) depending on action verbs.\n- Association & antecedent: allow antecedent instrument-type resolution up to ±1 sentence (antecedent span <=40 tokens) when anaphors like 'these awards' or 'such awards' appear.\n- Tie-breaker: prefer taxonomy element whose suffix exactly matches the instrument-class wording present in text ('OtherThanOptions' exact-match) over generic nonvested tag. If exact-suffix element is present but text only weakly implies non-options (e.g., mentions 'units' without explicit 'other than options'), require instrument cue match within ±5 tokens to choose suffixed element; otherwise choose generic nonvested.\n- Logging & QA: record UNRECOGNIZED cue span, NON-OPTION instrument span, chosen tag and competing tag names, and whether suffix-exact match applied. Flag cases where taxonomy contains suffixed element but no instrument cue matched as 'sbc-suffix-missing-cue' for human review.\n- Unit-tests (atomic):\n  - 'Unrecognized compensation expense related to nonvested awards of $1.0, $1.2 and $2.1 million' with preceding phrase 'awards other than options' -> each amount => EmployeeService...NotYetRecognizedShareBasedAwardsOtherThanOptions.\n  - 'Unrecognized compensation expense of $2.0 for nonvested RSUs' -> $2.0 => use suffixed non-option taxonomy element.\n  - 'Compensation costs not yet recognized for nonvested awards totaled $X' (no instrument-type stated) -> assign generic nonvested-not-yet-recognized element.\n- Implementation note: place this rule after nonvested lexical detection and before any nearest-lexical fallback so taxonomy suffixes are selected when explicitly supported by text.\n[ctx-00025] helpful=1 harmful=0 :: ctx-DELTA-FACILITY-INSTRUMENT-ATTACHMENT :: Atomic heuristic — Require head-noun attachment before applying 'capacity' vs 'instrument' numeric mappings.\n\nPurpose: Prevent blanket mapping of surface cues like 'up to $X' to LineOfCreditFacilityMaximumBorrowingCapacity by forcing a syntactic/semantic attachment check to determine whether the amount modifies a facility or a distinct debt instrument/tranche.\n\nExact lexical cue sets (case-insensitive):\n- Facility anchors (map currency -> LineOfCreditFacilityMaximumBorrowingCapacity if the numeric attaches to these): /\\b(revolv(?:ing)?\\s+credit\\s+facilit(?:y|ies)|credit\\s+facility|revolver|line\\s+of\\s+credit|facility\\s+commitment|commitment\\b|in\\s+an\\s+aggregate\\s+principal\\s+amount\\b)/i\n- Instrument/tranche anchors (map currency -> DebtInstrumentFaceAmount if numeric attaches): /\\b(tranche\\b|Tranche\\s+[A-Za-z0-9]|term\\s+loan|loan\\b|note\\b|notes\\b|note\\s+series|senior\\s+notes|seller\\s+note|principal\\s+amount\\s+of\\s+the\\s+loan|loan\\s+facility\\s+tranche)/i\n- 'Up to' / capacity lexical: /\\bup\\s+to\\b|\\bmaximum\\s+amount\\b|\\bin\\s+an\\s+aggregate\\s+principal\\s+amount\\b|commitment\\b/i\n\nAttachment & association procedure (apply in order):\n1) Parse-first: if a dependency parse is available, find the numeric token's syntactic governor (the head noun the numeric modifes). If the governor token matches Facility anchors -> map numeric to LineOfCreditFacilityMaximumBorrowingCapacity. If governor matches Instrument anchors -> map numeric to DebtInstrumentFaceAmount (or the instrument-level tag that best matches taxonomy).\n\n2) Fallback lexical-window (no full parse): search same sentence for nearest noun phrase within ±6 tokens of the numeric that matches either Facility anchors or Instrument anchors. If both anchor types appear within window, choose the anchor with the smallest token-distance to the numeric; if distances equal prefer Instrument anchors only if the noun phrase explicitly contains 'Tranche', 'Loan', 'Note', or 'term loan'; otherwise prefer Facility anchors when the exact phrase 'facility', 'revolver', 'line of credit' is present.\n\n3) Antecedent resolution: allow antecedent anchor in immediately preceding sentence (±1 sentence) when anaphoric phrase (the facility, the agreement, the loan, the Tranche A loan) appears; antecedent span <= 40 tokens. Use antecedent anchor only if no clearer same-sentence anchor found.\n\n4) 'Up to' heuristic gating: only apply 'up to' -> LineOfCreditFacilityMaximumBorrowingCapacity when step (1)-(3) confirms the numeric attaches to a Facility anchor. Do NOT apply 'up to' as an unconditional rule.\n\n5) Precedence & overrides:\n- If governor/nearest anchor == facility: assign LineOfCreditFacilityMaximumBorrowingCapacity (override generic 'outstanding' or 'availability' rules only if lexical evidence indicates cap/commitment). Log anchor span.\n- If governor/nearest anchor == instrument/tranche: assign DebtInstrumentFaceAmount (or instrument-specific face/commitment tag) even if 'up to' or 'aggregate principal amount' appears; log instrument id/phrase.\n- If both anchors present and ambiguity persists after token-distance and anchor-type tie-breakers: do NOT auto-assign; flag 'facility-instrument-attachment-ambiguous' and queue for human review.\n\n6) Token normalization & unit-tests (atomic examples to add):\n- 'a secured revolving credit facility of up to $335.0 million' -> $335.0 = LineOfCreditFacilityMaximumBorrowingCapacity.\n- 'a Tranche A loan of $16.0 million' (or 'Tranche A loan in the amount of $16.0 million') -> $16.0 = DebtInstrumentFaceAmount.\n- 'up to $50.0 million for Tranche B loans' -> $50.0 = DebtInstrumentFaceAmount (Tranche-level) NOT facility capacity.\n- 'the revolver, in an aggregate principal amount of up to $225.0 million' -> $225.0 = LineOfCreditFacilityMaximumBorrowingCapacity.\n- 'the commitment under the facility is up to $X; outstanding letters of credit totaled $Y' -> X->MaxBorrowingCapacity; Y->LettersOfCreditOutstandingAmount.\n\n7) Logging & QA: always record numeric span, chosen anchor span, parse-governor (if used), rule-id 'ctx-DELTA-FACILITY-INSTRUMENT-ATTACHMENT', decision branch, and confidence. Accumulate 'facility-instrument-attachment-ambiguous' cases into a focused annotation set to reduce parser fallback reliance.\n\nImplementation note: insert this rule into the numeric-to-debt/facility mapping stage and run before any unconditional 'up to' -> capacity mapping. Enforce this as a gating rule in rule-based pipelines and as a strong feature in ML classifiers (feature: head-noun-type = facility/instrument) to prevent the overgeneralization observed.\n[ctx-00026] helpful=0 harmful=0 :: [err-00026] helpful=0 harmful=0 :: Atomic rule: 'charged to expense' / 'recognized as expense' -> prefer Cost/Expense taxonomy tags (require exact-tag verification)\n\nPurpose: Prevent mapping expense-recognition lexical cues to contribution/cash tags by forcing exact-tag-name verification and semantic-tie-breakers.\n\nExact lexical expense cues (case-insensitive regexes; match first): /charged\\s+to\\s+expense\\b/, /charged\\s+to\\s+expense\\s+in\\s+continuing\\s+operations\\b/, /recognized\\s+as\\s+expense\\b/, /recognized\\s+as\\s+cost\\b/, /included\\s+in\\s+(operating\\s+expenses|selling,?\\s+general\\s+and\\s+administrative)/i, /expense\\s+recognized\\b/, /amounts\\s+charged\\s+to\\s+expense\\b/.\n\nAssociation window: require the expense cue to co-occur in the same sentence as the numeric token or within ±8 tokens of the numeric. Allow antecedent 'the amount' anaphora across ±1 sentence only if antecedent span <= 40 tokens and explicit 'expense' anchor appears.\n\nTag-selection algorithm (apply in order):\n1) Candidate discovery: from the provided taxonomy list, search for exact tag string 'DefinedContributionPlanCostRecognized' (literal) when the plan anchor 'DefinedContributionPlan' is detected. If present -> assign it.\n2) If exact string not found, search taxonomy candidate tags for ANY tag whose preferred label or definition contains BOTH: a) the plan anchor (e.g., 'DefinedContributionPlan') OR a close plan synonym; AND b) one of the expense-identifiers 'Cost', 'CostRecognized', 'Expense', 'ChargedToExpense', 'RecognizedAsExpense' (case-insensitive substring match). Prefer exact 'CostRecognized' over generic 'Cost' if both exist.\n3) Tie-breaker: if taxonomy contains both a Contributions tag (e.g., DefinedContributionPlanContributionsByEmployer) and a Cost/Expense-tag candidate, and the sentence matched an expense lexical cue (above), select the Cost/Expense-tag. Log the tie-break selection.\n4) Exception (use Contributions tag only): if the sentence explicitly uses contribution language (regexes: /contribution(s)?\\b/, /contributed\\b/, /employer\\s+contribution(s)?\\b/, /contributions\\s+by\\s+the\\s+employer\\b/) within ±8 tokens of the numeric, prefer ContributionsByEmployer tag instead.\n5) Safe-fallback: if no Cost/Expense-tag exists in provided taxonomy and contribution keywords are NOT explicit, DO NOT auto-assign ContributionsByEmployer; instead flag the numeric as 'expense-vs-contribution-missing-cost-tag' and queue for human review (do NOT map to Contributions automatically).\n\nLogging & provenance: record matched expense lexical cue span, matched plan-anchor span (if any), taxonomy search results (exact-match found / candidates list), chosen tag name, decision-branch id (1..5), and reason string. If rule deferred to human review, include suggested tag names and why exact tag was missing.\n\nUnit-tests (atomic examples to add):\n- 'Amounts charged to expense in continuing operations for defined contribution plans totaled $57 million in 2018, $43 million in 2017 and $44 million in 2016.' -> map 57, 43, 44 -> DefinedContributionPlanCostRecognized (exact-tag present). Log matched cue 'charged to expense'.\n- 'Employer contributions to defined contribution plans were $20 in 2019' -> map -> DefinedContributionPlanContributionsByEmployer (explicit 'contributions' cue).\n- 'The amounts were recognized as expense under defined contribution plans: $5.' -> map -> DefinedContributionPlanCostRecognized (expense cue, prefer cost tag).\n- 'The plan had $X of contributions by the employer and $Y charged to expense' -> ensure $Y maps to CostRecognized, $X maps to ContributionsByEmployer.\n\nImplementation notes: run this rule immediately after plan-anchor detection and before any generic semantic-similarity / nearest-lexical-match fallbacks. Enforce exact-string lookup of candidate taxonomy tags; if the preferred Cost/Expense tag is absent, prefer human-review rather than mislabeling as Contributions. Add all logged 'expense-vs-contribution-missing-cost-tag' cases to retraining/regression suite.\n[ctx-00027] helpful=0 harmful=0 :: id: ctx-DELTA-LEASE-0001 :: Event-driven override: map \"lease charges\" tied to closures/exit/impairment -> RestructuringCharges\n\nPurpose: Prevent blanket mapping of any phrase containing 'lease' or 'lease charge(s)' to OperatingLeaseExpense when the amount is part of closure/exit/restructuring activity or presented together with impairment/exit charges.\n\nExact lexical/event cues (case-insensitive regexes; require at least one closure/exit/impairment cue):\n- Closure/exit cues: /\\bclose[sd]?\\b/, /\\bsubsequently\\s+closed\\b/, /\\bpreviously\\s+closed\\b/, /\\bstore(s)?\\s+clos(e|ing|ures)?\\b/, /\\bclosure(s)?\\b/, /\\bexit\\b|\\bexiting\\b|\\bexit\\s+activities\\b/, /\\bimpair(ment|ed|ing)\\b/, /\\bclosure-related\\b/, /\\brelated\\s+to\\s+previously\\s+closed\\b/, /\\brelated\\s+to\\s+closed\\b/, /\\brestructur(e|ing|ed)\\b/, /\\bexit-related\\b/, /\\bstore\\s+closure\\b/.\n\nExact lexical lease-charge cues (case-insensitive): /lease\\s+charge(s)?\\b/, /other\\s+lease\\s+charge(s)?\\b/, /lease\\s+termination\\s+cost(s)?\\b/, /lease\\s+related\\s+charges\\b/.\n\nAssociation & windows (apply in order):\n1) High-confidence same-clause match: if a currency numeric token is within ±12 tokens of a lease-charge cue AND the same clause/sentence contains ANY closure/exit/impairment cue above -> assign RestructuringCharges for that numeric (event-driven override).\n2) Grouped-phrase rule: if clause contains a grouped phrase pattern like /impairment(s)?\\s+and\\s+other\\s+lease\\s+charge(s)?/i or /impairment\\s+and\\s+lease\\s+charges/ and the clause ties these amounts to closed stores (closure cues present anywhere in clause) -> map ALL enumerated currency amounts in that grouped clause to RestructuringCharges.\n3) Cross-sentence antecedent resolution: if lease-charge cue is present but closure/impairment cue is only in the immediately preceding sentence (±1 sentence) and antecedent span <= 40 tokens (anaphors like 'these charges', 'related to such closures'), allow mapping to RestructuringCharges. Require explicit linkage tokens such as 'related to', 'arising from', 'in connection with', 'resulting from' appearing within ±16 tokens of either the lease-charge cue or the closure cue.\n4) Multi-amount alignment: when multiple currency amounts appear in same grouped clause (e.g., 'Impairment and other lease charges of $A and $B related to closed restaurants'), assign each currency to RestructuringCharges (do not split by lexical 'lease' presence if grouping + closure cues exist).\n\nPrecedence / tie-breakers (apply before any lexical 'lease' -> OperatingLeaseExpense rule):\n- Event-driven override: if rule conditions (1-3) match, RestructuringCharges MUST override OperatingLeaseExpense.\n- Exception: if the sentence explicitly contains a definitive operating-line lexical tag such as 'Operating lease expense', 'rent expense included in operating expenses', or an unambiguous statement mapping the amount to OperatingLeaseExpense (regex: /Operating\\s+lease\\s+expense|rent\\s+expense\\b/ within ±8 tokens of numeric) AND NO closure/impairment cues are present in same or prior sentence, then map to OperatingLeaseExpense as usual.\n- Conflict logging: if both explicit operating-line lexical tag and closure/impairment cues are present, DO NOT auto-assign; flag as 'lease-closure-conflict' for human review.\n\nAmbiguity handling: if lease-charge cue exists and closure/impairment cues are weak (only generic 'costs' or 'other charges' without explicit closure/impairment/related-to-closed phrasing), DO NOT auto-map to RestructuringCharges; instead mark 'lease-charge-ambiguous' and queue for human review.\n\nNormalization & negation: apply negation-to-zero rules when negation cues ('no', 'none', 'no lease charges') co-occur within ±6 tokens of lease-charge/closure phrases and map numeric to 0 for RestructuringCharges when rule matched.\n\nLogging & QA: for every mapping by this rule record: numeric span, lease-charge cue span, matched closure/impairment cue span, grouping-phrase span (if any), antecedent/anonaphor span (if cross-sentence), chosen tag (RestructuringCharges), rule-id 'ctx-DELTA-LEASE-0001' and decision branch. Add 'lease-closure-conflict' and 'lease-charge-ambiguous' cases to targeted human-review queue and regression tests.\n\nMinimal unit-tests (atomic examples):\n- 'Other lease charges of $1.3 million related to previously closed Company-owned restaurants' -> $1.3M => RestructuringCharges.\n- 'Impairment and other lease charges of $0.1 million and $0.2 million related to closures of sixteen restaurants' -> both amounts => RestructuringCharges.\n- 'We recorded $0.5 million of lease charges included in operating lease expense' (no closure/impairment cues) -> $0.5M => OperatingLeaseExpense.\n- 'Lease charges of $X (see note) and related to closed stores' where 'related to closed stores' appears in previous sentence -> $X => RestructuringCharges (cross-sentence antecedent).\n\nImplementation note: place this rule before any lexical-level 'lease' -> OperatingLeaseExpense mapping in the pipeline. Surface all logged cases where event-driven override applied to QA for inclusion in retraining data to reduce future lexical-only misclassification.\n[ctx-00028] helpful=0 harmful=0 :: ctx-DELTA-OUTSTANDING-FACILITY-0001 :: Atomic heuristic — Map 'outstanding/borrowed under the facility/revolver' -> LineOfCredit (facility-level outstanding borrowings)\n\nPurpose: deterministically assign currency amounts that describe borrowings outstanding under a named credit facility/revolver to the facility-level outstanding-balance tag (e.g., LineOfCredit or taxonomy-equivalent) and not to maximum/capacity, spread, or generic debt-face tags.\n\nExact lexical cues (case-insensitive regexes; match-first): /\\b(outstanding\\b|amounts?\\s+outstanding\\b|borrowed\\b|borrowings?\\b|amount\\s+borrowed\\b|principal\\s+outstanding\\b|was\\s+outstanding\\b|are\\s+outstanding\\b)/i and facility anchors: /\\b(revolv(?:ing)?\\s+credit\\s+facilit(?:y|ies)|credit\\s+facility|revolver|line\\s+of\\s+credit|the\\s+facility)\\b/i.\n\nAssociation & windows (apply in order):\n1) High-confidence pattern: if a currency numeric token lies within ±12 tokens of an outstanding/borrowed cue AND the same sentence contains a facility anchor (revolver/credit facility), assign the numeric -> LineOfCredit (facility outstanding) and link to the facility anchor span.\n2) Antecedent resolution: if outstanding/borrowed cue appears but the facility anchor is anaphoric ('the facility', 'the revolver'), allow antecedent in previous sentence (±1 sentence, antecedent span <= 40 tokens). Require confidence threshold for cross-sentence mapping; if antecedent absent or confidence low, flag for review rather than guessing.\n3) Fallback lexical attachment: when both instrument/tranche anchors (term loan, tranche) and facility anchors appear in the sentence, use syntactic governor/head-noun attachment (dependency parse) if available: if numeric's governor == facility-token -> LineOfCredit; if governor == instrument-token -> instrument-face/loan tag. If no parse available, choose the anchor with smallest token-distance; if equal and neither contains explicit 'Tranche'/'Loan' keywords, prefer facility => LineOfCredit and log conflict.\n\nPrecedence rules (apply before capacity/spread fallbacks):\n- If outstanding/borrowed + facility anchor matches per above -> MUST assign facility-level outstanding tag (LineOfCredit) and override any 'up to'/'capacity' mapping.\n- If numeric is percentage or contains 'margin'/'spread' cues -> do NOT map to outstanding; instead apply spread/interest heuristics (ctx-00008/ctx-00011) as usual.\n- If numeric is currency but also contains 'up to' OR 'aggregate principal amount of up to' with explicit capacity/commitment anchors -> capacity mapping may still be applicable but only after verifying attachment: 'up to $X' attached to a facility anchor by governor -> LineOfCreditFacilityMaximumBorrowingCapacity; outstanding cues explicitly present -> outstanding tag wins.\n\nNegation & normalization:\n- Apply err-00002 negation-to-zero rule: if outstanding/borrowed phrase co-occurs with negation cues ('no amounts outstanding', 'none outstanding', 'there were no borrowings under the facility') within ±6 tokens, normalize numeric to 0 and assign LineOfCredit = 0; log negation span and anchor.\n\nUnit-tests (atomic examples to add):\n- 'There was $50 million outstanding under the revolver.' -> $50M => LineOfCredit (facility outstanding).\n- 'An amount outstanding under the credit facility totaled $12.5 million and the amount available under the facility totaled $62.5 million' -> $12.5M => LineOfCredit; $62.5M => LineOfCreditFacilityRemainingBorrowingCapacity.\n- 'Revolving credit facility in an aggregate principal amount of up to $225.0 million; $50.0 million was outstanding under the revolver.' -> $225.0M => LineOfCreditFacilityMaximumBorrowingCapacity; $50.0M => LineOfCredit.\n- 'No amounts were outstanding under the credit facility at March 31' -> 0 => LineOfCredit (negation normalized and logged).\n- 'Tranche A term loan of $16.0 million; $5.0 million outstanding under the revolver' -> $16.0M => DebtInstrumentFaceAmount (Tranche A); $5.0M => LineOfCredit (revolver outstanding).\n\nLogging & QA: record numeric span, matched 'outstanding/borrowed' cue span, matched facility anchor span (or resolved antecedent), parse-governor (if used), chosen tag, rule-id 'ctx-DELTA-OUTSTANDING-FACILITY-0001', and decision confidence. Queue ambiguous head-noun attachment cases as 'facility-vs-instrument-attachment-ambiguous' for targeted human review and retraining.\n\nImplementation note: insert this rule in the debt/facility numeric-to-tag mapping stage and execute it before any unconditional 'availability'/'up to' -> capacity mapping and before generic lexical fallbacks. Integrate 'parse-head' as a strong feature in ML classifiers and treat this rule as a hard override when high-confidence signals are present.\n## OTHERS\n[misc-00002] helpful=0 harmful=1 :: Micro decision flow for acquisition-related monetary phrases (apply in order): 1) Search sentence (or immediate surrounding sentence ±1) for the exact phrase variants from the lexical-to-tag mapping. 2) If only one cue matches, assign the corresponding tag. 3) If multiple cues match, choose the cue whose token span is closest to the numeric amount (measure token-distance from numeric token to cue span). 4) If both cues are equidistant or no numeric amount is present, break ties by cue specificity: ('purchase price' > 'cash paid' > 'consideration'). 5) If still ambiguous, prefer PaymentsToAcquireBusinessesGross when the sentence explicitly mentions payments, cash, or amounts described as 'paid' or 'paid as part of the acquisition'; prefer BusinessCombinationConsiderationTransferred1 only when the text uses 'consideration' or explicitly 'consideration transferred' and describes the composition of consideration (e.g., cash + shares + other instruments). 6) Log ambiguous cases for human review and add the sentence to a short test-suite.\n\n**Question Context (The Task):**\n\n\n## YOUR TASK\nPerform **DELTA ANALYSIS**. What specific rule, formula, or mistake-prevention strategy is missing from the Playbook that would have fixed the error identified in the Reflection?\n\n## OUTPUT FORMAT\nOutput ONLY a valid JSON object. No markdown, no commentary.\n{\n  \"reasoning\": \"Detailed analysis of why current bullets failed and what specific delta is needed.\",\n  \"operations\": [\n    {\n      \"type\": \"ADD\", \n      \"section\": \"strategies_and_insights | formulas_and_calculations | code_snippets_and_templates | common_mistakes_to_avoid | problem-solving_heuristics | context_clues_and_indicators | others\",\n      \"content\": \"Specific, detailed heuristic content.\"\n    }\n  ]\n}\n",
  "response": "{\n  \"reasoning\": \"The playbook lacked an explicit, atomic rule that encodes the percent+instrument-anchor heuristic and its safe exceptions (valuation/carrying/spread cues). The Reflection shows the model used this heuristic successfully; making it an explicit rule with precise token windows, precedence, exception-list and unit-tests would prevent regressions where percents adjacent to 'notes' are mis-tagged because of nearby words like 'fair value' or 'carrying amount'.\",\n  \"operations\": [\n    {\n      \"type\": \"ADD\",\n      \"section\": \"context_clues_and_indicators\",\n      \"content\": \"ctx-DELTA-INTEREST-PERCENT-INSTRUMENT :: Atomic heuristic: Percent + debt-instrument anchor -> DebtInstrumentInterestRateStatedPercentage (with valuation/spread exceptions)\\nPurpose: deterministically map percentage tokens that syntactically/lexically modify a debt instrument noun (note(s), bond(s), loan, term loan, seller note, senior notes, revolver interest rate phrasing) to DebtInstrumentInterestRateStatedPercentage unless explicit valuation, carrying-amount, spread/margin, or effective-rate cues attach to the percent.\\nExact instrument-anchor cues (case-insensitive): /\\\\b(note|notes|bond|bonds|loan|loans|term\\\\s+loan|seller\\\\s+note|senior\\\\s+notes|revolver|debenture)\\\\b/.\\nPercent forms: '\\\\d+(?:\\\\.\\\\d+)?%','\\\\d+(?:\\\\.\\\\d+)? percent' and numeric ranges including percent.\\nAssociation windows and syntactic attachment (apply in order):\\n 1) Prefer same-noun-phrase attachment: if the percent token occurs within the same noun phrase or within ±3 tokens of an instrument-anchor in the same sentence -> map to DebtInstrumentInterestRateStatedPercentage.\\n 2) If instrument-anchor appears elsewhere in sentence but no syntactic parse, require instrument-anchor within ±6 tokens of the percent to apply this rule with medium confidence.\\nPrecedence & exceptions (apply after association):\\n  - If valuation/carrying cues are present and syntactically attach to the percent within ±5 tokens, DO NOT map to interest-rate. Valuation/carrying cues (case-insensitive): /fair\\\\s+value|estimated\\\\s+fair\\\\s+value|carrying\\\\s+amount|carrying\\\\s+value|book\\\\s+value|measured\\\\s+at\\\\s+fair\\\\s+value|at\\\\s+fair\\\\s+value/. Map to the appropriate fair-value/carrying tag instead.\\n  - If spread/margin/over-LIBOR cues appear within ±5 tokens of the percent: /spread|margin|over\\\\s+LIBOR|over\\\\s+ABR|over\\\\s+an?\\\\s+index|plus\\\\s+LIBOR|LIBOR\\\\s+plus/, map to DebtInstrumentBasisSpreadOnVariableRate1 (or spread tag) rather than stated-rate.\\n  - If effective/yield/APR cues appear within ±5 tokens: /effective\\\\s+rate|yield|APR|effective\\\\s+interest\\\\s+rate|effective\\\\s+rate\\\\s+of/, map to the effective-rate taxonomy element (do not force stated-percentage).\\n  - If percent attaches to a phrase describing carrying/valuation proportions (e.g., 'represented 5.00% of the carrying amount of the notes') map to a ratio/percentage-of-carrying-amount tag (do not map to interest-rate).\\nTie-breaker rules:\\n  - If both instrument-anchor and a conflicting cue (valuation/spread/effective) are present, prefer the cue that syntactically governs the percent (syntactic head/governor if available). If syntactic info unavailable, prefer valuation/spread/effective cues only when they are within ±3 tokens of the percent; otherwise prefer DebtInstrumentInterestRateStatedPercentage.\\nLogging & QA:\\n  - Record: percent token span, instrument-anchor span, any overriding cue span (valuation/spread/effective), decision made and rule-id 'ctx-DELTA-INTEREST-PERCENT-INSTRUMENT'. Flag any conflict cases where both instrument and override cues are within ±3 tokens for human review ('interest-percent-conflict').\\nUnit-tests (atomic examples):\\n  - '3.88% notes' -> 3.88% = DebtInstrumentInterestRateStatedPercentage.\\n  - 'The fair value of the notes was 3.88%' -> 3.88% = DebtInstrumentFairValueAmount (do NOT map to interest-rate).\\n  - '5.00% per annum on the Seller Notes' -> 5.00% = DebtInstrumentInterestRateStatedPercentage.\\n  - 'The margin ranges from 1.00% to 2.00% in the case of LIBOR loans' -> percents = DebtInstrumentBasisSpreadOnVariableRate1 (do NOT map to stated-rate).\\n  - '5.00% of the carrying amount of the notes' -> map to percent-of-carrying-amount tag (do NOT map to interest-rate).\\nImplementation note: run this rule early in percent-handling pipeline and before generic percentage-to-spread or percentage-to-valuation fallbacks; enforce attachment windows strictly to avoid overgeneralization.\"\n    }\n  ]\n}",
  "prompt_time": 0.0,
  "response_time": 21.96886110305786,
  "total_time": 21.96886110305786,
  "call_time": 21.96886110305786,
  "prompt_length": 158212,
  "response_length": 4511,
  "prompt_num_tokens": 37257,
  "response_num_tokens": 1779,
  "timestamp": "20260206_114133_178",
  "datetime": "2026-02-06T11:41:33.178549"
}