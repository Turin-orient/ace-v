{
  "role": "generator",
  "call_id": "train_e_1_s_37_gen_initial",
  "model": "gpt-5-mini",
  "prompt": "You are an analysis expert tasked with answering questions using your knowledge, a curated playbook of strategies and insights and a reflection that goes over the diagnosis of all previous mistakes made while answering the question.\n\n**Instructions:**\n- Read the playbook carefully and apply relevant strategies, formulas, and insights\n- Pay attention to common mistakes listed in the playbook and avoid them\n- Show your reasoning step-by-step\n- Be concise but thorough in your analysis\n- If the playbook contains relevant code snippets or formulas, use them appropriately\n- Double-check your calculations and logic before providing the final answer\n\nYour output should be a json object, which contains the following fields:\n- reasoning: your chain of thought / reasoning / thinking process, detailed analysis and calculations\n- bullet_ids: each line in the playbook has a bullet_id. all bulletpoints in the playbook that's relevant, helpful for you to answer this question, you should include their bullet_id in this list\n- final_answer: your concise final answer\n\n\n**Playbook:**\n## STRATEGIES & INSIGHTS\n\n## FORMULAS & CALCULATIONS\n\n## CODE SNIPPETS & TEMPLATES\n\n[code-00004] helpful=0 harmful=0 :: Regex detection template (pseudo-code): - patterns = { 'PaymentsToAcquireBusinessesGross': [/(?:aggregate\\s+|total\\s+)?purchase\\s+price/i, /cash(?:\\s+consideration)?\\s+paid/i], 'BusinessCombinationConsiderationTransferred1': [/(?:aggregate\\s+)?consideration(?:\\s+transferred)?/i], 'BusinessAcquisitionEquityInterestsIssuedOrIssuableNumberOfSharesIssued': [/issued\\s+\\d[\\d,]*/i, /shares\\s+issued/i] } - For each numeric token in sentence: find nearest matching pattern within N tokens (N=8). - Assign tag of nearest matched pattern. - If multiple tags at equal distance, apply specificity precedence: purchase_price > cash_paid > consideration. - If no match, fall back to semantic classifier but flag for review.\n## COMMON MISTAKES TO AVOID\n\n[err-00003] helpful=0 harmful=0 :: Do not conflate 'purchase price' with 'consideration'. Anti-pattern: tagging both an 'aggregate purchase price of $X' and an 'aggregate consideration of $Y' with the same 'consideration' tag. Concrete prevention: enforce lexical-match-first rule (if 'purchase price' appears, do not map that phrase to BusinessCombinationConsiderationTransferred1). Add a unit-test: example sentence 'aggregate purchase price of $162 million' must map to PaymentsToAcquireBusinessesGross; 'aggregate consideration of $1.2 billion' must map to BusinessCombinationConsiderationTransferred1.\n[err-00007] helpful=0 harmful=0 :: Anti-patterns and prevention rules (atomic): - Anti-pattern: mapping any 'per share' price to SaleOfStockPricePerShare without checking instrument class. Prevention: before assigning SaleOfStockPricePerShare check for convertible/preferred/mandatory cues in same sentence; if present, map to convertible-specific price tag. - Anti-pattern: treating 'we sold X shares' as a generic secondary sale when underwriter/overallotment/offer language is present. Prevention: if 'we sold' co-occurs with underwriter/overallotment/overallotment exercise/offer language within ±1 sentence, treat as primary issuance and map share counts to StockIssuedDuringPeriodSharesNewIssues. - Anti-pattern: applying nearest-lexical-match only. Prevention: implement precedence override: instrument-type and offering flags must be evaluated and can override nearest lexical match. - Add unit-tests for regressions: include at least 10 sentences mixing convertible language with 'per share' and 'sold' / 'offered' / 'underwriters' to ensure convertible/issuance tags win over generic sale tags.\n[err-00010] helpful=0 harmful=0 :: err-XXXX :: Anti-pattern: blanket-mapping 'availability' -> RemainingBorrowingCapacity. Prevention checklist (atomic):\n- Do not assign RemainingBorrowingCapacity solely because the word 'availability' appears. First check for a facility-capacity anchor in same or previous sentence (\"has a $X credit facility\", \"in an aggregate principal amount of up to $X\").\n- If 'availability' is used in a comparative clause referencing a previously stated cap (\"may be less than $X\" where X == stated cap), map to MaximumBorrowingCapacity (the sentence is comparing to the contractual cap or describing an effective cap constraint).\n- If the phrase contains explicit current-amount tokens (\"amount available under the facility totaled\", \"was available under the facility\"), map to RemainingBorrowingCapacity.\n- If no anchor and no explicit remaining-amount phrase exist, mark as ambiguous and require human review instead of auto-mapping.\n- Add automated unit-tests for both positive and negative examples and log ambiguous cases for retraining.\n[err-00014] helpful=0 harmful=0 :: Tie-breaker: prefer instrument-specific mapping over generic financial-category tags when instrument anchor present (atomic prevention rule): - Anti-pattern: mapping an 'interest' currency amount to generic InterestExpense or mapping a 'per annum' percentage to a spread tag without checking instrument context. - Prevention checklist (apply in order): 1) If numeric token is percentage AND 'per annum'/'per year' present AND any instrument-anchor (note/loan/term loan/seller note) in sentence ±1 -> map to DebtInstrumentInterestRateStatedPercentage. 2) If numeric token is currency AND interest lexical cue ('interest charges', 'interest expense', 'interest on') AND instrument-anchor in sentence ±1 -> map to InterestExpenseDebt (link numeric to instrument anchor). 3) If both 'spread'/'margin' and 'per annum' cues occur, prefer per-annum/stated-rate mapping; log conflict for QA. 4) If customer + revenue percent detected, map to ConcentrationRiskPercentage1; do not map to generic 'percentage' tags. 5) If instrument-anchor is absent for interest-charge currency amounts, map to generic InterestExpense and flag for human review; add the sentence to a retraining queue. - Unit-tests: include all examples referenced in the above heuristics and assert instrument-specific tags beat generic alternatives.\n[err-00002] helpful=0 harmful=0 :: Atomic negation-to-zero rule for availability quantities (prevention of treating negation as 'absent' rather than numeric zero). Purpose: ensure explicit negative availability phrases ('no', 'none', 'not available') are normalized to numeric zero for quantity tags and mapped to the most specific availability tag. Rules:\n1) Negation cues (case-insensitive regex examples): /\\bno\\b/, /\\bnone\\b/, /\\bnot\\s+available\\b/, /\\bthere\\s+are\\s+no\\b/, /\\bzero\\b/ within ±6 tokens of an availability noun ('available', 'remain', 'remain\\s+available', 'available\\s+for\\s+grant').\n2) Quantity mapping: when negation cue co-occurs with availability noun and a plan/instrument anchor as applicable (e.g., 'under the Plan', 'under the facility'), assign numeric value 0 and map to the specific quantity tag (e.g., ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant = 0; LineOfCreditFacilityRemainingBorrowingCapacity = $0 when explicit 'amount available under the facility was $0' or 'no availability under the credit facility').\n3) Scope constraints (do NOT apply universal zero conversion): do not convert negations that apply to non-quantity facts or idiomatic phrases ('no material impact', 'no change', 'no further details'); require proximity to a numeric/quantity noun and an anchor.\n4) Tag-type constraint: only auto-convert to zero for quantity/amount-of-shares/remaining-capacity numeric tags; do not auto-convert percentages unless explicit context indicates 'zero percent' (e.g., 'no revenue' vs 'zero percent of revenue' are different; flag ambiguous percent-negations for review).\n5) Token-window & antecedent resolution: allow antecedent anchors in previous sentence up to ±1 sentence when anaphoric phrase 'the Plan'/'the facility' is used; require confidence threshold for cross-sentence negation mapping; otherwise flag for human review.\n6) Unit-tests/examples to add:\n   - 'no shares remain available under the 2014 Long Term Incentive Plan' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant = 0.\n   - 'There are no amounts available under the credit facility' -> LineOfCreditFacilityRemainingBorrowingCapacity = 0.\n   - 'No material impact was expected' -> do NOT map to any numeric tag (must be filtered by scope constraint).\n7) Logging: any auto-zero assignment should be recorded with the negation cue span and the anchor span for traceability and QA.\n[err-00004] helpful=0 harmful=0 :: Anti-pattern prevention: Do not map currency amounts labeled as 'interest charges'/'interest expense' to generic InterestExpense when an instrument-anchor is present; instead map to InterestExpenseDebt and normalize explicit zeros. - Exact lexical cues (case-insensitive): /interest\\s+charge(s)?\\b/, /interest\\s+expense(s)?\\b/, /interest\\s+on\\s+the\\s+(note|notes|loan|term\\s+loan|seller\\s+note|revolver)/i. - Instrument-anchor detection: detect instrument names (Seller Notes, Term Loan, Revolver, Senior Notes, etc.) in same sentence OR previous sentence (allow antecedent resolution up to ±1 sentence and span <= 40 tokens). - Association window: currency numeric token within ±12 tokens of interest lexical cue (primary) and instrument-anchor within ±40 tokens across sentence boundary if needed. - Mapping rule: if both interest lexical cue and instrument-anchor present -> assign InterestExpenseDebt (link numeric to instrument id). If interest lexical cue present but no instrument-anchor -> assign generic InterestExpense and flag 'interest-amount-no-instrument' for review. - Zero/numeric normalization: if the numeric token is explicit 'zero', 'no interest', 'none' appearing within ±6 tokens of interest lexical cue and instrument-anchor present, normalize to numeric 0 and assign InterestExpenseDebt = 0; log negation cue span and anchor span for traceability. - Precedence: this instrument-specific mapping overrides any generic expense or cash-flow tag. - Unit-tests (atomic): - '$179,507 of interest charges associated with the Seller Notes for the year' -> $179,507 = InterestExpenseDebt (Seller Notes). - 'No interest expense was recorded on the Term Loan' -> InterestExpenseDebt = 0 (Term Loan), logged. - '$331,397 of interest expense for the six months ended June 30 related to the Term Loan' -> $331,397 = InterestExpenseDebt. - Logging: record instrument anchor span and interest phrase span for each mapping for QA and retraining; aggregate 'interest-amount-no-instrument' cases into review queue.\n## PROBLEM-SOLVING HEURISTICS\n\n[ph-00006] helpful=0 harmful=0 :: Delta decision flow (apply in order for each numeric token): 1) Sentence-level scan: detect instrument-type cues (convertible/preferred/mandatory) and offering cues (underwriters, overallotment, offering language) across the sentence ±1 surrounding sentence. 2) If instrument-type == convertible: - If numeric token is a price or appears adjacent to unit tokens like 'per share', 'per common share', 'per depositary share': assign DebtInstrumentConvertibleConversionPrice1 unless an explicit secondary-market sale cue is present. - If numeric token is shares and offering cues present: assign StockIssuedDuringPeriodSharesNewIssues. 3) If offering cues present (even if instrument-type absent): - If numeric token is number-of-shares -> assign StockIssuedDuringPeriodSharesNewIssues (primary issuance). - If numeric token is price and context uses 'offering price', 'issued at', 'offering at' -> prefer issuance-price tag (if available) else flag for review. 4) If no instrument-type or offering cues: use existing lexical-to-tag mapping (e.g., 'sold' -> SaleOfStockNumberOfSharesIssuedInTransaction) as fallback. 5) Tie-breaker precedence (high -> low): instrument-specific issuance tags (convertible conversion price, mandatory-convertible issuance) > issuance/share-specific tags (StockIssuedDuringPeriodSharesNewIssues) > generic sale tags (SaleOfStock*). 6) Ambiguity handling: if fallback mapping would assign a generic sale tag but any instrument/offering cue matched (score difference < threshold), flag the example and record sentence+reason for human review and training. 7) Unit-test generation examples to add to test suite: - \"We sold 17,250,000 shares, including the underwriters' exercise of the overallotment option\" -> 17,250,000 = StockIssuedDuringPeriodSharesNewIssues. - \"Sempra Energy 6% Mandatory Convertible Preferred Stock, Series A, was issued at $100.00 per share\" -> $100.00 = DebtInstrumentConvertibleConversionPrice1. - \"We sold 500,000 shares on the open market\" -> 500,000 = SaleOfStockNumberOfSharesIssuedInTransaction.\n## CONTEXT CLUES & INDICATORS\n\n[ctx-00001] helpful=0 harmful=0 :: Lexical-to-tag mapping (exact cues + variants). Use exact phrase detection before higher-level semantic heuristics. Patterns to detect (case-insensitive): - 'purchase price', 'total purchase price', 'aggregate purchase price' -> tag PaymentsToAcquireBusinessesGross. Regex examples: /(?:aggregate\\s+|total\\s+)?purchase\\s+price/i. - 'consideration', 'consideration transferred', 'aggregate consideration' -> tag BusinessCombinationConsiderationTransferred1. Regex examples: /(?:aggregate\\s+)?consideration(?:\\s+transferred)?/i. - 'cash paid', 'cash consideration', 'cash consideration paid' -> PaymentsToAcquireBusinessesGross. Regex: /cash(?:\\s+consideration)?\\s+paid/i. - 'shares issued', 'shares were issued', 'issued X shares' -> BusinessAcquisitionEquityInterestsIssuedOrIssuableNumberOfSharesIssued. Regex: /(?:issued|issued\\s+approximately)\\s+\\d+[\\d,]*(?:\\s+shares)?/i. Apply these matches to the phrase window that contains the numeric amount (±8 tokens) to ensure the amount belongs to the detected cue.\n[ctx-00005] helpful=0 harmful=0 :: Instrument-type detection patterns (case-insensitive regexes and token cues): - Convertible indicators: /\\bconvertible\\b/, /\\bconversion price\\b/, /\\bconversion cap\\b/, /\\bconvertible preferred\\b/, /\\bmandatory convertible\\b/, /\\bmandatory convertible preferred\\b/. - Preferred-stock signals: /\\bpreferred stock\\b/, /\\bseries [A-Z]+\\b/, /\\bdividend(?:-bearing)?\\b/. - Debt-like convertible signals: /\\b6% mandatory convertible preferred stock\\b/ (literal patterns for numerated series acceptable). Offering / primary-issuance indicators: - underwriters: /\\bunderwriter(s)?\\b/, /\\bwe sold\\b/, /boffering\\b/, /\\boverallotment\\b/, /\\bexercise[d]?\\s+overallotment\\b/, /\\bprimary offering\\b/, /\\boffered and sold\\b/, /\\bpurchased by the underwriters\\b/. Sale / secondary-market indicators (inverse cues): /\\bwe sold to third parties\\b/, /\\bsecondary offering\\b/, /\\btraded on\\b/, /\\bsold on the market\\b/. Numeric association window policy: - Primary association window = ±8 tokens around numeric token. - If an instrument-type cue appears anywhere in the same sentence, treat instrument-type as global for that numeric token (i.e., instrument cues outrank local lexical matches within window). - If offering cue appears in same sentence or adjacent sentence (±1 sentence), mark transaction as primary issuance. Precedence mapping rules (applied after detection): - If instrument-type == convertible AND numeric_context == price -> map numeric to DebtInstrumentConvertibleConversionPrice1 (convertible conversion/issuance price). - If offering_flag == true AND numeric_context == shares -> map numeric to StockIssuedDuringPeriodSharesNewIssues. - If instrument-type == convertible AND offering_flag == true AND numeric_context == shares -> StockIssuedDuringPeriodSharesNewIssues (shares issued in offering of convertible instrument). - Only if no instrument-type OR offering cues detected, or if explicit secondary-sale cues present, fall back to SaleOfStockNumberOfSharesIssuedInTransaction / SaleOfStockPricePerShare. Distance weighting: - When multiple cues present, compute score = (instrument_cue_present ? 10 : 0) + (offering_cue_present ? 8 : 0) + (1 / (1 + token_distance_to_numeric)). Choose tag with highest score. Logging: - If generic sale tag would be selected but instrument-type OR offering cues exist with nonzero score, log for human review and mark as 'contextual-overlap' example for retraining.\n[ctx-00008] helpful=0 harmful=0 :: Credit-facility vs spread disambiguation (atomic heuristics):\n1) Purpose: ensure currency amounts describing facility capacity map to LineOfCreditFacilityMaximumBorrowingCapacity and percentage 'margin/spread' phrases over LIBOR/ABR map to DebtInstrumentBasisSpreadOnVariableRate1.\n2) Exact lexical cues (case-insensitive):\n   - Facility-capacity cues (map currency -> LineOfCreditFacilityMaximumBorrowingCapacity): /\\b(revolv(?:ing)?\\s+credit\\s+facilit(?:y|ies)|credit\\s+facility|revolver)\\b/, /\\bin\\s+an\\s+aggregate\\s+principal\\s+amount\\b/, /\\b(up\\s+to)\\b/, /\\bmaximum\\s+amount\\b/, /\\bcommitment\\b/.\n   - Outstanding/borrowings cues (do NOT map to capacity): /\\boutstanding\\b/, /\\bborrowed\\b/, /\\bamounts?\\s+outstanding\\b/, /\\bprincipal\\s+amounts?\\s+outstanding\\b/.\n   - Spread/margin cues (map percentage -> DebtInstrumentBasisSpreadOnVariableRate1): /\\bmargin(s)?\\b/, /\\bspread(s)?\\b/, /\\bover\\s+(?:LIBOR|ABR|an?\\s+index)\\b/, /\\bin\\s+the\\s+case\\s+of\\s+(?:LIBOR|ABR)\\s+loan(s)?\\b/.\n   - Absolute/effective-rate cues (do NOT map to spread): /\\binterest\\s+rate\\b/, /\\beffective\\s+rate\\b/, /\\bper annum\\b/, /\\bAPR\\b/.\n3) Token association window policy: apply matches to numeric tokens using a ±8-token window for lexical cues and ±1 sentence for facility-level cues (e.g., named facility in prior sentence). If a facility-capacity cue appears anywhere in the same sentence or the immediately preceding sentence, currency amounts within ±16 tokens of that cue are capacity candidates.\n4) Precedence rules (apply in order):\n   a) If numeric is currency AND a facility-capacity cue matches (within window) -> assign LineOfCreditFacilityMaximumBorrowingCapacity.\n   b) If numeric is currency AND an outstanding/borrowings cue matches -> assign outstanding-balance tag (do not map to capacity).\n   c) If numeric is a percentage AND a spread/margin cue matches (within ±3 tokens) AND the phrase references LIBOR/ABR/index -> assign DebtInstrumentBasisSpreadOnVariableRate1.\n   d) If numeric is a percentage AND absolute/effective-rate cues match (within ±3 tokens) -> assign the appropriate interest-rate tag (do NOT map to basis/spread); if no interest-rate tag exists in taxonomy, flag for human review rather than mapping to spread.\n   e) If a conflict exists (e.g., 'margin' and 'interest rate' both present), prefer the more specific cue: 'margin/spread over LIBOR/ABR' > 'interest rate' only when text explicitly says 'margin' or 'spread'; otherwise prefer 'interest rate' mapping.\n5) Normalization and token checks:\n   - Recognize percentages with % or the word 'percent' or numeric forms like '1.00%–2.00%'.\n   - Recognize currency with $ or currency words (dollars, EUR, etc.).\n6) Logging & QA:\n   - If mapping would assign a spread tag but the sentence contains 'interest rate'/'per annum' within ±3 tokens of the percentage, log as 'potential-rate-vs-spread' for human review and add to targeted unit-tests.\n7) Minimal unit-tests to add (atomic examples):\n   - \"revolving credit facilities in an aggregate principal amount of up to $225.0 million\" -> $225.0 million = LineOfCreditFacilityMaximumBorrowingCapacity.\n   - \"The margin ranges from 1.00% to 2.00% in the case of LIBOR loans\" -> 1.00% and 2.00% = DebtInstrumentBasisSpreadOnVariableRate1.\n   - \"The interest rate is 5.00% per annum\" -> 5.00% = interest-rate tag (do NOT map to DebtInstrumentBasisSpreadOnVariableRate1); if interest-rate tag missing, flag for review.\n   - \"$50 million outstanding under the revolver\" -> $50 million = outstanding-balance tag (do NOT map to capacity).\n8) Implementation notes (for classifiers / regex pipelines):\n   - Apply these patterns before generic lexical-to-tag fallbacks.\n   - When multiple tags are plausible, compute priority score where facility-capacity cue adds +10, outstanding cue +12 (to avoid mis-tagging as capacity), spread/margin +10, interest-rate cue +11; choose highest score and log ties.\n   - Add examples that mix LIBOR/ABR and 'margin' with numeric ranges to training/regression suites to prevent collapse into absolute-rate tags.\n[ctx-00009] helpful=0 harmful=0 :: Credit-facility availability vs capacity — atomic disambiguation rule (apply before generic 'availability' fallback):\n1) Purpose: ensure currency amounts that reference facility size/capacity map to LineOfCreditFacilityMaximumBorrowingCapacity and only map to LineOfCreditFacilityRemainingBorrowingCapacity when the sentence explicitly reports a point-in-time available amount.\n2) Exact lexical patterns (case-insensitive regexes):\n   - Facility-capacity anchor (detect stated cap): /(?:has|has a|has an|in an aggregate principal amount of|in an aggregate amount of|in an aggregate principal amount of up to|up to)\\s+\\$?[\\d,]+(?:\\.\\d+)?\\s*(?:million|billion)?\\s*(?:revolv(?:ing)?\\s+credit\\s+facilit(?:y|ies)|credit\\s+facility|revolver)/i\n   - Explicit remaining-amount cues (map to remaining borrowing capacity): /(?:amount available under the (?:credit )?facility(?: totaled|was|is)|available under the facility totaled|was available under the facility|amount available under the facility is)\\b/i\n   - Comparative/constraint cues (signal comparison to a stated cap): /availability\\s+(?:under|of)\\s+(?:this|the)?\\s*(?:credit )?facilit(?:y|ies)\\s+may\\s+be\\s+less\\s+than\\s+\\$?[\\d,]+(?:\\.\\d+)?/i, /may\\s+be\\s+less\\s+than\\b/i, /as\\s+a\\s+result\\s+of\\b/i, /for\\s+certain\\s+subsidiaries\\b/i, /for\\s+specific\\s+entities\\b/i\n3) Association windows and antecedent resolution:\n   - If a facility-capacity anchor (pattern above) appears anywhere in the same sentence OR in the immediately preceding sentence, consider that dollar amount the canonical facility maximum for subsequent comparative/availability clauses. (Sentence window = ±1 sentence.)\n   - Token association: when anchored, allow currency amounts in comparative clauses up to ±16 tokens from the comparative phrase to be treated as referencing the stated cap.\n4) Precedence decision flow (apply in order):\n   a) If numeric is currency AND explicit remaining-amount cues match (within ±8 tokens) -> assign LineOfCreditFacilityRemainingBorrowingCapacity.\n   b) Else if numeric is currency AND comparative/constraint cue matches (e.g., \"availability may be less than $X\") AND X equals the earlier-detected facility-capacity anchor amount (or the sentence contains a nearby explicit facility-capacity anchor) -> assign LineOfCreditFacilityMaximumBorrowingCapacity (the phrase is comparing to the contractual cap or describing effective cap reductions).\n   c) Else if numeric is currency AND comparative/constraint cue matches BUT no prior anchor exists: if clause contains constraint markers ('as a result of', 'for certain subsidiaries', 'for specific entities', 'may be less than') prefer MaximumBorrowingCapacity (treat as described cap limit) but mark as 'ambiguous-availability-without-anchor' and log for review.\n   d) Else if numeric is currency AND no comparative/anchor cues but lexical 'availability' appears alone (no 'amount available', no 'totaled') -> treat as ambiguous: do NOT auto-assign RemainingBorrowingCapacity; instead prefer MaximumBorrowingCapacity only if a facility-capacity anchor exists in same or previous sentence; otherwise flag for human review.\n5) Tie-breaker and override: facility-capacity anchor presence overrides the naive 'availability -> remaining' rule. Explicit remaining-amount lexical patterns override capacity mapping and must map to RemainingBorrowingCapacity regardless of anchors.\n6) Examples / unit-tests (add to targeted suite):\n   - \"The Company has a $75 million revolving credit facility (credit facility)\" -> $75 million = LineOfCreditFacilityMaximumBorrowingCapacity.\n   - \"availability under this credit facility may be less than $75 million as a result of outstanding letters of credit...\" -> $75 million = LineOfCreditFacilityMaximumBorrowingCapacity (because X matches stated cap and clause is comparative/constraint).\n   - \"an outstanding letter of credit under the credit facility totaled $12.5 million and the amount available under the facility totaled $62.5 million\" -> $12.5M = LettersOfCreditOutstandingAmount; $62.5M = LineOfCreditFacilityRemainingBorrowingCapacity (explicit remaining-amount cue).\n   - \"availability under the facility may be less than $40 million\" (no prior stated cap mentioned) -> flag 'ambiguous-availability-without-anchor' and queue for human review (do not auto-assign RemainingBorrowingCapacity).\n7) Logging & QA: any case where 'availability' appears but the rule chooses MaximumBorrowingCapacity only because of an antecedent anchor must be logged as 'availability-referenced-cap' with the anchor span and numeric comparison; ambiguous/no-anchor cases must be logged as 'ambiguous-availability' and added to training data.\n8) Implementation notes: incorporate these checks before any generic lexical mapping that equates 'availability' -> remaining capacity; add unit-tests above and regressions that ensure 'amount available' still maps to RemainingBorrowingCapacity.\n[ctx-00011] helpful=0 harmful=0 :: Interest-rate 'per annum' -> DebtInstrumentInterestRateStatedPercentage (atomic heuristic): - Purpose: map percentages expressed as annual/stated interest rates on named debt instruments to DebtInstrumentInterestRateStatedPercentage. - Exact lexical cues (case-insensitive regexes): /(per\\s+annum|per\\s+year|annually|annual\\s+rate|%\\s+per\\s+annum|APR)\\b/ and instrument anchors: /\\b(note|notes|loan|loans|seller\\s+note|senior\\s+notes|term\\s+loan|revolver|debt\\b)/i. - Association window: require both a percentage token and at least one instrument-anchor token in the same sentence OR instrument-anchor within the previous sentence (±1 sentence). If instrument name present in same sentence, require token-distance <= 12 tokens; if in prior sentence, allow <= 40 token span across sentence boundary. - Precedence: If 'per annum' (or equivalent) is detected within ±3 tokens of the percentage, prefer DebtInstrumentInterestRateStatedPercentage over spread/basis tags. - Conflict rule: If both 'margin'/'spread' cues and 'per annum' cues are present, prefer 'per annum' -> stated-rate mapping, but log as 'rate-vs-spread-conflict' for QA. - Unit-tests/examples: - \"8% per annum on the Seller Notes\" -> 8% = DebtInstrumentInterestRateStatedPercentage (anchor 'Seller Notes'). - \"The interest rate is 5.00% per year on the term loan\" -> 5.00% = DebtInstrumentInterestRateStatedPercentage. - Implementation note: apply before generic percentage-to-spread fallbacks.\n[ctx-00012] helpful=0 harmful=0 :: Monetary 'interest charges' mapping to instrument-specific InterestExpenseDebt (atomic heuristic): - Purpose: ensure currency amounts described as interest charges/interest expense tied to a particular note/loan map to InterestExpenseDebt (and are linked to the instrument identity) rather than a generic InterestExpense tag. - Exact lexical cues (case-insensitive regexes): /interest\\s+charge(s)?\\b/, /interest\\s+expense(s)?\\b/, /interest\\s+cost(s)?\\b/, /(interest\\s+charges)\\s+associated\\s+with/, /interest\\s+relating\\s+to/, /interest\\s+on\\s+the\\s+(?:note|notes|loan|loan\\s+agreement)/i. - Association policy: require a currency token (e.g., $179,507) in same sentence and an instrument anchor (note/loan name like 'Seller Notes') in same sentence OR previous sentence. Primary token-distance window = ±12 tokens around numeric; allow ±1 sentence antecedent resolution with span <= 40 tokens. - Precedence: instrument-specific InterestExpenseDebt overrides generic InterestExpense when instrument anchor present. If instrument anchor not present, map to generic InterestExpense and flag 'interest-amount-no-instrument' for review. - Unit-tests/examples: - \"$179,507 of interest charges associated with the Seller Notes for the year\" -> $179,507 = InterestExpenseDebt (linked to Seller Notes). - \"$331,397 of interest expense for the six months ended June 30 related to the Term Loan\" -> $331,397 = InterestExpenseDebt. - Logging: record sentence span and instrument anchor for any instrument-linked interest mapping for traceability.\n[ctx-00013] helpful=0 harmful=0 :: Customer-concentration percentage mapping -> ConcentrationRiskPercentage1 (atomic heuristic): - Purpose: map percentages that quantify customer concentration of revenues to ConcentrationRiskPercentage1. - Exact lexical cues/patterns (case-insensitive regexes): /(?:two|three|top|largest|the\\s+two\\s+largest|the\\s+largest)\\s+customers\\b/, /customer\\s+concentration\\b/, /accounts?\\s+for\\s+about|accounted\\s+for\\s+approximately|accounted\\s+for\\s+|represent(s|ed)\\s+approximately\\s+\\d+\\%/i. Percentage capture window: detect percentage token within ±10 tokens of customer/revenue cue and/or the phrase 'of (our|the)? revenues' or 'of revenue'. - Precedence: when percentage is explicitly tied to 'customers' + 'revenues', map to ConcentrationRiskPercentage1 even if other percentage-tag candidates exist. - Unit-tests/examples: - \"Our two largest customers accounted for approximately 44% of our revenues\" -> 44% = ConcentrationRiskPercentage1. - \"The largest customer represented 22% of revenue\" -> 22% = ConcentrationRiskPercentage1. - Ambiguity handling: if percent lacks 'customer' anchor but 'of revenues' alone appears, mark as potential concentration and log for human review.\n[ctx-00001] helpful=0 harmful=0 :: Equity / Plan lexical-to-tag atomic rules (exact cues + variants). Purpose: deterministically map par-value, shares-outstanding, plan-availability and plan-authorized numeric tokens to the most specific US GAAP tag. Rules (apply in order):\n1) Par/Stated value per share -> CommonStockParOrStatedValuePerShare\n   - Exact lexical cues (case-insensitive regex examples): /\\$?\\s*[0-9]{1,3}(?:[\\,\\d]*)(?:\\.\\d+)?\\s*(?:per|par)\\s+share(s)?\\b/, /par\\s+value\\s+of\\s+\\$?\\s*[0-9.,]+\\b/, /stated\\s+value\\s+per\\s+share\\b/.\n   - Association window: numeric token and 'per share'/'par value' cue must co-occur in the same sentence and lie within ±8 tokens.\n   - Precedence: if matched, assign CommonStockParOrStatedValuePerShare regardless of other nearby 'price' or 'per share' generic sale cues.\n   - Unit-tests: '$0.001 par value per share' -> CommonStockParOrStatedValuePerShare = 0.001; 'stated value per common share of $0.01' -> CommonStockParOrStatedValuePerShare = 0.01.\n\n2) 'Shares outstanding' -> CommonStockSharesOutstanding\n   - Exact lexical cues: /shares\\s+outstanding\\b/, /outstanding\\s+shares\\b/, /shares\\s+were\\s+outstanding\\b/.\n   - Association window: numeric token within ±8 tokens of the cue; sentence-level anchor required.\n   - Precedence: this tag wins over generic 'shares issued' or offering tags when 'outstanding' is present and no offering/underwriter cues are present in ±1 sentence.\n   - Unit-tests: '28,026,713 shares outstanding' -> CommonStockSharesOutstanding = 28,026,713.\n\n3) Plan context: map plan-specific share counts to plan tags\n   - Plan-anchor detection (case-insensitive): /(?:long[- ]term incentive plan|2014\\s+Long\\s+Term\\s+Incentive\\s+Plan|LTIP|stock\\s+plan|equity\\s+compensation\\s+plan)\\b/ (allow named-year or 'the Plan' with antecedent resolution from prior sentence).\n   - If plan-anchor present in same sentence OR immediately preceding sentence (±1 sentence) then apply plan-specific mappings:\n     a) 'available'/'remain available' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant\n        - Cues: /available\\s+.*?shares|remain\\s+available|shares\\s+available\\s+for\\s+grant\\b/; numeric token within ±8 tokens maps to that tag.\n     b) 'maximum number' / 'may be delivered' / 'authorized' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized\n        - Cues: /maximum\\s+number\\s+of\\s+shares|may\\s+be\\s+delivered\\s+.*?is\\s+\\$?\\s*[\\d,]+|authorized\\s+to\\s+issue\\s+up\\s+to\\s+\\$?\\s*[\\d,]+\\b/, numeric token maps to Authorized tag.\n   - Token association: allow antecedent plan-name in previous sentence when 'the Plan' or year-named plan is used; antecedent span <= 40 tokens across sentence boundary.\n   - Precedence: plan-specific tags override generic share tags (e.g., StockIssuedDuringPeriodSharesNewIssues, SaleOfStockNumberOfSharesIssuedInTransaction) whenever the plan-anchor is detected.\n   - Unit-tests: 'no shares remain available under the 2014 Long Term Incentive Plan' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant = 0; 'maximum number of shares that may be delivered under the plan is 15,000,000' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized = 15,000,000.\n\n4) Association & ambiguity handling\n   - If both a plan-anchor and offering/underwriter cues are present, prefer plan-specific mappings for availability/authorized fields and issuance-specific mappings for issuance events; log any example where plan-anchor and issuance-anchor both score >0 as 'plan-vs-issuance-overlap' for human review.\n   - If no plan-anchor is found but text uses 'available under the plan' with an antecedent plan name earlier in document >1 sentence away, require human-review flag (do not auto-assign) unless antecedent resolution confidence >= threshold.\n\n5) Implementation notes\n   - Apply these rules before generic 'per share' or 'shares' fallbacks; add unit-tests above and log 'plan-availability-zero' cases for QA traceability.\n[ctx-00003] helpful=0 harmful=0 :: Atomic rule: Map 'LIBOR plus X%' (and close variants) -> DebtInstrumentBasisSpreadOnVariableRate1. - Purpose: avoid misinterpreting 'LIBOR plus X%' as an absolute stated interest rate. - Exact lexical patterns (case-insensitive regexes): /(LIBOR|ABR|an? index)\\s*(?:\\+|plus|\\+/-|\\band\\s+an?\\s+adjusted\\s+rate|with\\s+a\\s+margin\\s+of)\\s*([0-9]+(?:\\.[0-9]+)?\\s*%)/i and /(?:margin|spread)\\s*(?:of)?\\s*([0-9]+(?:\\.[0-9]+)?\\s*%)\\s*(?:over|above|to|on)\\s*(LIBOR|ABR|index)/i. - Token association: require percentage token within ±3 tokens of LIBOR/ABR or 'plus'/'over' lexical cue; allow antecedent instrument references in same sentence or previous sentence ±1 if needed for linking. - Precedence/tie-breaker: If both 'per annum'/'per year'/'annual' occurs within ±3 tokens of the percentage, prefer DebtInstrumentInterestRateStatedPercentage only if there is explicit 'per annum' + instrument-anchor; otherwise prefer DebtInstrumentBasisSpreadOnVariableRate1 for 'LIBOR plus X%' forms. - Unit-tests (atomic examples): - 'LIBOR plus 4.15%' -> 4.15% = DebtInstrumentBasisSpreadOnVariableRate1. - 'the margin ranges from 1.00% to 2.00% in the case of LIBOR loans' -> both percents = DebtInstrumentBasisSpreadOnVariableRate1. - 'interest rate of 4.15% per annum' -> 4.15% = DebtInstrumentInterestRateStatedPercentage (not a spread). - Logging: any mapping where both 'margin/spread' and 'per annum' cues are within ±3 tokens should be logged as 'rate-vs-spread-conflict' with spans for QA and unit-test augmentation. - Implementation note: apply this rule before generic percentage-to-interest fallbacks and add targeted regression tests for 'plus/over' surface forms.\n[ctx-00005] helpful=0 harmful=0 :: Atomic lexical rule: map 'borrowing base' -> LineOfCreditFacilityRemainingBorrowingCapacity (alias: LineOfCreditFacilityCurrentBorrowingCapacity).\n- Exact lexical cues (case-insensitive regexes): /\\bborrowing\\s+base\\b/, /\\bamount(?:s)?\\s+available\\s+to\\s+borrow\\b/, /\\bavailable\\s+borrowing\\s+capacity\\b/, /\\bamount\\s+available\\s+under\\s+the\\s+(?:credit\\s+)?facility\\b/.\n- Association window: numeric token must lie within ±8 tokens of the cue in the same sentence; allow antecedent plan/facility name resolution in previous sentence (±1 sentence) if anchor span <= 40 tokens.\n- Precedence rules (apply in order):\n  1) If a cue above matches -> assign LineOfCreditFacilityRemainingBorrowingCapacity for the nearest numeric currency token (override generic 'capacity' or 'availability' fallbacks).\n  2) If the same sentence explicitly contains 'maximum', 'commitment', 'up to', 'in an aggregate principal amount of', or similar contractual-cap cues within ±8 tokens of a different currency token -> assign those tokens to LineOfCreditFacilityMaximumBorrowingCapacity (do NOT remap borrows labeled explicitly as 'maximum').\n  3) If a single sentence contains both a 'borrowing base' cue and a 'maximum/commitment' cue with two different currency tokens, map each numeric to the cue it is adjacent to (token-distance); if one numeric token is within distance of both cues, prefer the 'borrowing base' -> RemainingBorrowingCapacity mapping for that numeric and log as 'borrowbase-vs-commitment-conflict'.\n  4) If only the word 'capacity' or 'availability' appears without an explicit 'borrowing base' or 'amount available' phrasing, defer to existing availability-vs-capacity rules (ctx-00009 / err-00010) and require anchor-checks; do NOT treat 'capacity' alone as proof of remaining-amount.\n- Ambiguity handling: if 'borrowing base' appears but no numeric token in ±8 tokens, flag 'borrowing-base-no-amount' for review (do not guess). If numeric present but sentence contains conflicting language (e.g., 'borrowing base' and 'maximum' both adjacent to the same numeric), map to RemainingBorrowingCapacity and log conflict for QA.\n- Unit-tests (atomic examples to add):\n  - \"The borrowing base under the credit facility is $425.0 million.\" -> $425.0M = LineOfCreditFacilityRemainingBorrowingCapacity.\n  - \"An amount available under the facility totaled $62.5 million\" -> $62.5M = LineOfCreditFacilityRemainingBorrowingCapacity.\n  - \"Revolving credit facility in an aggregate principal amount of up to $225.0 million; the borrowing base available is $150.0 million\" -> $225.0M = LineOfCreditFacilityMaximumBorrowingCapacity; $150.0M = LineOfCreditFacilityRemainingBorrowingCapacity.\n  - \"Availability under this credit facility may be less than $75 million as a result of outstanding letters of credit\" (and $75M equals prior stated cap) -> follow comparative-rule in ctx-00009 (map to MaximumBorrowingCapacity), but if 'borrowing base' is used instead of 'availability' and tied to $75M map to RemainingBorrowingCapacity.\n- Logging & QA: record mapping span with label 'borrowing-base-mapped' including cue span, numeric span, and antecedent facility anchor. Add 'borrowbase-vs-commitment-conflict' and 'borrowing-base-no-amount' to review queues for retraining.\n[ctx-00001] helpful=0 harmful=0 :: Atomic rule: Parenthetical-numbered footnote component resolution (map component amounts to the aggregate/line-item the footnote enumerates). Steps (apply in order for any numeric token appearing inside a parenthetical-numbered clause like \"(3) Includes\", \"(2) Consists of\", leading \"(3)\" or a parenthetical index): 1) Detect footnote-component syntax: regex cues (case-insensitive) for leading parenthetical index + include/consist language within same clause: /^\\(\\d+\\)\\s*(Includes|Consists|Compris(es)?|Consisting\\s+of|Includes\\s+the)\\b/ or tokens pattern [\"(\\d+)\", \"Includes\", \"Consists\", \"Includes the\"]. If matched and numeric tokens present in the clause, mark numeric tokens as candidate footnote-components. 2) Antecedent anchor search (ordered scope): a) Same footnote/clause: scan earlier tokens in same footnote sentence for explicit aggregate label nouns/phrases (within the same sentence or clause) — target lexical anchors: /gain(s)?\\s+on\\s+extinguishment|loss(es)?\\s+on\\s+extinguishment|extinguishment\\s+of\\s+debt|restructur(ing|e)\\s+charge(s)?|acquisition\\s+cost(s)?|settlement\\s+charge(s)?|other\\s+loss(es|es)?/i. If found, assign the component numeric to the same aggregate tag (exact tag mapping table below). b) Previous text window: if no anchor in same sentence, search up to 2 previous sentences and the nearest note heading/title within ±3 sentences for the same anchor phrases or for explicit line-item labels (note titles like 'Debt', 'Gain (Loss) on Extinguishment of Debt', 'Restructuring') and map component amounts to that anchor tag. c) Section-level fallback: if still no explicit anchor but the surrounding note header matches a known note type (e.g., 'Debt', 'Commitments and Contingencies', 'Restructuring and Other Charges'), prefer the plausible transaction tags associated with that note (e.g., 'Debt' -> GainsLossesOnExtinguishmentOfDebt; 'Restructuring' -> RestructuringCharges). 3) Negative-evidence de-prioritization: if candidate tag would be AssetImpairmentCharges but the clause and the preceding 2 sentences do NOT contain impairment keywords (regex: /impair|impairment|write-?down|recoverable|fair\\s+value\\s+less\\s+costs/i), deprioritize and do NOT assign AssetImpairmentCharges solely because of large amount; instead prefer aggregate-anchor tag found via steps 2a-2c or queue for review. 4) Shortlist & tag mapping precedence when anchor ambiguous: construct shortlist of plausible component tags in this order of preference when multiple plausible anchors exist or when anchor is only a generic 'other'/'charges': (high) GainsLossesOnExtinguishmentOfDebt, RestructuringCharges, AcquisitionRelatedCosts, TransactionRelatedGainsLosses (domain-specific candidate tags) -> (low) AssetImpairmentCharges. Only pick AssetImpairmentCharges if explicit impairment lexical cues exist. 5) Multi-amount handling: if clause enumerates multiple numeric tokens separated by 'and' or commas under the same parenthetical index, map all enumerated amounts to the same resolved aggregate tag (do not split across different tags unless explicit sub-labels present in the clause). 6) Ambiguity/triage: if no anchor found in steps 2-4 and no strong negative cues to rule out impairment, do NOT auto-assign AssetImpairmentCharges by magnitude. Instead label the numeric(s) as 'footnote-component-ambiguous' and queue for human review / classifier-resolution. 7) Logging and provenance: when mapping via this rule, record: parenthetical index span, clause span, chosen antecedent anchor span (sentence or heading), resolved tag, and the negative-evidence span if impairment was de-prioritized. 8) Minimal unit-tests (atomic examples to add): - \"(3) Includes $18.5 million, and $135.2 million.\" where prior sentence in note states \"Gains (Losses) on Extinguishment of Debt — total $XX (see (3))\" -> both amounts -> GainsLossesOnExtinguishmentOfDebt. - \"(2) Includes $5.0 million of lease termination costs and $2.0 million of severance\" with note header 'Restructuring and Other Charges' -> both amounts -> RestructuringCharges. - \"(1) Includes of $50.0 and $10.0\" with no impairment keywords and prior heading 'Debt' or 'Note 7 — Debt' -> map to GainsLossesOnExtinguishmentOfDebt (do not map to AssetImpairmentCharges). - Clause with explicit 'impair' nearby -> map to AssetImpairmentCharges. Implementation note: run this rule before magnitude-based fallbacks and before generic lexical-to-tag mapping; add examples where parenthetical indices reference an earlier aggregate via 'see (n)' to training/regression suites to ensure antecedent resolution is learned.\n[ctx-00002] helpful=0 harmful=0 :: Atomic heuristic: Prefer Allocated/Expense taxonomy tags for share-based compensation amounts when sentence context indicates an income-statement expense. Steps (apply in order for each currency numeric candidate near \"share-based\" lexical matches): 1) Income-statement expense detection (must be true to trigger this rule): detect any of these lexical cues in same sentence or ±1 sentence: /total compensation cost|compensation cost|compensation expense|share-?based compensation expense|cost for share-?based payment arrangements|expense recognized|included in operating expenses|on the income statement|for the year ended|for the period ended/ (case-insensitive). 2) Candidate-tag shortlist: when a lexical mapping produces multiple candidate tags for the phrase \"share-based compensation\" (e.g., ShareBasedCompensation, AllocatedShareBasedCompensationExpense, EmployeeServiceShareBasedCompensationTaxBenefitFromCompensationExpense), retrieve each candidate tag's preferred label and definition from the taxonomy. 3) Taxonomy-label/definition signals: compute taxonomy-specific scores using atomic features: +10 if preferred-label or definition contains keywords: '\\bexpense\\b', '\\ballocated\\b', '\\ballocated expense\\b', '\\ballocated compensation\\b'; +6 if contains '\\bcompensation\\b' and '\\bshare\\b' or 'share-based'; +4 if contains 'employee service' (indicates benefit/tax side). 4) Context-match score: compute context score: +8 if income-statement expense detection matched (step 1), +5 if the numeric token is immediately adjacent (±8 tokens) to an explicit expense cue (e.g., 'expense', 'cost', 'total compensation cost'), +3 if sentence contains reporting-period anchors ('for the year ended', 'for the quarter ended'). 5) Decision rule (tie-breaker): final_score = taxonomy_score + context_score. Prefer the candidate with highest final_score. If top candidate has an 'Expense'/'Allocated' taxonomy signal, it must win when income-statement expense detection was true. 6) Negative prevention rule (atomic): do NOT auto-assign generic ShareBasedCompensation when income-statement expense cues are present and a taxonomy candidate with 'Expense' or 'Allocated' exists. 7) Tax-benefit mapping exception: if numeric amount co-occurs with explicit tax cues ('tax benefit', 'tax effect', 'tax benefit related to share-based compensation', 'tax benefit of $X'), map to EmployeeServiceShareBasedCompensationTaxBenefitFromCompensationExpense (explicit tax mapping overrides expense-tag rule for tax amounts). 8) Association windows: apply lexical/income-statement cue detection within the same sentence or ±1 sentence; require numeric-token distance <= 8 tokens to primary expense cue for strongest match. 9) Logging and QA: record chosen tag, competing candidate tags with taxonomy_label/definition snippets, matched expense lexical cue span, and numeric token span. If generic tag would have been selected absent this rule, mark case as 'allocated-expense-overrode-generic' for retraining. 10) Minimal unit-tests (atomic examples to add): - 'Total compensation cost for share-based payment arrangements was $10,730, $13,488 and $19,289' -> $13,488 and $19,289 => AllocatedShareBasedCompensationExpense; $10,730 if described similarly should also map to AllocatedShareBasedCompensationExpense. - 'The tax benefit related to share-based compensation was $2,678 and $5,058' -> both tax amounts => EmployeeServiceShareBasedCompensationTaxBenefitFromCompensationExpense. - 'We recognized $3,200 of share-based compensation as expense in cost of goods sold' -> $3,200 => AllocatedShareBasedCompensationExpense (expense-location cue 'cost of goods sold' present). - 'Share-based compensation outstanding under the Plan: 1,000,000 shares available' -> numeric => plan-availability tag (do not map to AllocatedShareBasedCompensationExpense because income-statement expense cues absent). Implementation note: run this rule immediately after lexical-to-tag candidate generation and before generic fallback-to-first-lexical-match; surface all logged 'allocated-expense-overrode-generic' cases to QA for verification and add to regression suite.\n[ctx-00003] helpful=0 harmful=0 :: Atomic heuristic: Tax-line polarity detection and preference for IncomeTaxExpenseBenefit (expense vs benefit). Purpose: avoid literal-phrase-only mapping for 'income tax' line-items; determine polarity (expense vs benefit) using explicit lexical cues, numeric notation, and economic context and prefer IncomeTaxExpenseBenefit when benefit cues present. Rules (apply in order): 1) Candidate scope: apply when a numeric currency/amount token is in the same clause/sentence as any tax lexical anchor: /income\\s+tax\\b/, /income\\s+tax\\s+expense\\b/, /income\\s+tax\\s+provision\\b/, /provision\\s+for\\s+income\\s+taxes\\b/, /current\\s+tax\\b/, /deferred\\s+tax\\b/. 2) Explicit-benefit lexical cue (highest-confidence): if the same sentence (±0 tokens) contains words/phrases: /benefit(s)?\\b/, /tax\\s+benefit\\b/, /income\\s+tax\\s+benefit\\b/, /credit(s)?\\s+for\\s+income\\s+taxes\\b/, or parenthetical heading variants like /income\\s+tax\\s+benefit\\s*\\(expense\\)|income\\s+tax\\s*\\(benefit\\)/i -> assign IncomeTaxExpenseBenefit (override IncomeTaxExpense). 3) Numeric-sign / notation heuristic (high-confidence): if the numeric token is explicitly negative (leading '-' sign) OR enclosed in parentheses (e.g., '(' and ')') when usual format uses parentheses for negatives, treat as negative -> assign IncomeTaxExpenseBenefit (log that the numeric sign indicated a benefit). 4) Economic-context heuristic (moderate-confidence): if the same sentence or immediately adjacent sentence (±1 sentence) contains pre-tax-loss indicators: /pre-?tax\\s+loss(es)?\\b/, /loss\\s+before\\s+income\\s+tax(es)?\\b/, /net\\s+loss\\b/, /loss\\s+for\\s+the\\s+year\\b/, /income\\s*\\(loss\\)\\s+before\\s+income\\s+tax(es)?\\b/, then prefer IncomeTaxExpenseBenefit over IncomeTaxExpense for tax-line numeric(s) linked to the tax lexical anchors. 5) Parenthetical/label disambiguation (high-confidence): if heading or nearby label contains the pattern 'Income tax (benefit) (expense)' or 'Income tax benefit (expense)' or 'Income tax (expense) (benefit)' choose the more specific tag that matches the explicit parenthetical ordering if 'benefit' is present; otherwise use label ordering + numeric sign to decide. 6) Precedence and tie-breaker: precedence of cues = explicit-benefit-lexical > numeric-sign/parentheses > parenthetical/heading cue > economic-context. If multiple cues conflict (e.g., positive numeric but explicit 'benefit' word), prefer explicit lexical cue but log conflict and mark for review if numeric polarity contradicts lexical cue. 7) Ambiguity handling: if no benefit cues present and neither numeric sign nor pre-tax-loss context present, fall back to existing lexical mapping (IncomeTaxExpense) but add an 'uncertain-tax-polarity' flag and queue example for review/training. 8) Logging & traceability: record selected tag, matched cue type(s) and spans (lexical-benefit span, numeric-sign span, pre-tax-loss phrase span), and confidence score. Any case where economic-context changed a literal lexical match must be logged as 'context-overrode-lexical-tax' for QA. 9) Unit-tests (atomic examples to add): - \"Income tax expense (benefit) of $34.4 and $53.1\" -> both amounts = IncomeTaxExpenseBenefit (parenthetical label includes 'benefit'). - \"We recorded a pre-tax loss of $100 and an income tax expense of $10\" (where 'income tax' appears but context implies benefit) -> $10 = IncomeTaxExpenseBenefit (pre-tax-loss context triggers benefit). - \"Income tax expense was $(5.0) for the year\" -> $(5.0) = IncomeTaxExpenseBenefit (parentheses -> negative). - \"The tax benefit related to continuing operations was $2.5\" -> $2.5 = IncomeTaxExpenseBenefit (explicit 'benefit'). - \"Income tax expense of $7.0 on income before taxes of $20.0\" -> $7.0 = IncomeTaxExpense (no benefit cues). 10) Implementation note: run this heuristic immediately after tax-lexical anchor detection and before any strict lexical-to-tag assignment; surface logged conflicts to the human-review queue and add them to retraining dataset to reduce reliance on exact-token-match.\n[ctx-00004] helpful=0 harmful=0 :: Atomic heuristic: Regulatory rate-requests mapping -> PublicUtilitiesRequestedRateIncreaseDecreaseAmount\n- Purpose: deterministically map currency numeric tokens that express a utility's requested (filed/submitted/asked-for) rate increase or decrease to PublicUtilitiesRequestedRateIncreaseDecreaseAmount and avoid false mapping to Revenues/Expense/generic financial tags.\n- Exact filing/request lexical cues (case-insensitive regex examples): /\\bfiled\\b/, /\\bfiled an application\\b/, /\\bsubmitted a request\\b/, /\\brequested\\b/, /\\bseeks to increase\\b/, /\\bseeking approval to increase\\b/, /\\bpetition(ed)?\\b/, /\\bproposed\\b/, /\\bseeks to decrease\\b/, /\\bsubmitted a petition\\b/, /\\bstipulation .* for a net increase\\b/, /(for|requesting|seeking).*rate (increase|decrease) of/i. If any of these cues co-occur with a rate/increase/decrease lexical anchor, treat as regulatory-request.\n- Rate-change lexical anchors: /rate(s)? (increase|decrease)|increase[s]? rates?|decrease[s]? rates?|net increase|net decrease|rate adjustment|proposed rate change|requested rate change/.\n- Association window & antecedent resolution: require numeric token in the same sentence and within ±12 tokens of a filing/request cue OR within the same clause. Allow antecedent anchors up to ±1 sentence when the numeric is introduced as 'the net increase of $X' or via a parenthetical referring to the filing (e.g., 'in the filing, for a net increase of $1.2 million').\n- Decision rule (apply in order):\n  1) If a filing/request cue AND a rate-change anchor are detected as above -> assign PublicUtilitiesRequestedRateIncreaseDecreaseAmount to the nearest currency numeric token (regardless of 'net' / 'after adjustments' language). If phrase explicitly contains 'decrease', preserve semantic sign (tag remains same but mark as decrease).\n  2) If 'approved', 'authorized', 'granted', 'effective', 'in effect as of', or 'we will implement' appear in place of filing/request cues -> do NOT map to Requested tag; instead map to the taxonomy's approved/implemented-rate-change tag (e.g., PublicUtilitiesApprovedRateIncreaseDecreaseAmount) or, if that tag is absent, flag for human-review rather than mapping to Revenues.\n  3) If sentence describes expected/estimated revenue impact using verbs like 'will result in', 'expected to increase (our) revenues by', 'resulting in additional revenues of' -> do NOT map to the Requested-rate tag; map to the appropriate Revenues/EstimatedImpact tag or flag for review (avoid mapping requested-rate -> Revenues).\n- Precedence/tie-breaker: when a filing/request cue is present, this rule overrides generic lexical matches (e.g., 'increase', 'increase of $X' that could be mis-mapped to Revenues or Contract-related tags). If both filing and 'expected revenue' cues appear, prefer requested-rate mapping but log for human review because text describes both regulatory request and revenue impact.\n- Net/after-adjustment handling: presence of modifiers like 'net', 'after adjustments', 'after pro forma adjustments', or 'net of' does NOT change mapping — still map to PublicUtilitiesRequestedRateIncreaseDecreaseAmount if filing/request cues remain present; record modifier span in logs for provenance.\n- Negative/zero handling: if filing/request clause uses 'decrease' or explicitly states 'a decrease of $X' map same tag and mark as decrease; if phrase is 'no change requested' or contains negation near rate-change anchor, normalize numeric to 0 and map to PublicUtilitiesRequestedRateIncreaseDecreaseAmount = 0 and log negation span.\n- Token-normalization: recognize approximate/caretakers tokens ('approximately', 'about', '~', 'approx.') and numeric ranges ('approximately $5.9 million', '$5.5 – $6.0 million') — map central expression to requested tag and attach span confidence; for ranges, map whole range as candidate value and flag for downstream normalization.\n- Logging & QA: always record filing/request cue span, rate-change anchor span, numeric span, and chosen tag; if the pipeline would otherwise map the numeric to Revenues or to a recognized/approved tag, log as 'regulatory-request-vs-other' for QA. Queue ambiguous/dual-cue sentences (both filing and approved language or both revenue-impact and filing) for human review.\n- Unit-tests (atomic examples to add):\n  - 'filed an application with the Commission for a natural gas rate increase of approximately $5.9 million' -> $5.9M = PublicUtilitiesRequestedRateIncreaseDecreaseAmount.\n  - 'submitted a request to decrease its electric rates by $7.2 million' -> $7.2M (decrease) = PublicUtilitiesRequestedRateIncreaseDecreaseAmount.\n  - 'filed a general rate case with a requested overall increase of approximately $2.3 million' -> $2.3M = PublicUtilitiesRequestedRateIncreaseDecreaseAmount.\n  - 'filed a stipulation with the Commission for a net increase of $1.2 million' -> $1.2M = PublicUtilitiesRequestedRateIncreaseDecreaseAmount (net modifier preserved in log).\n  - 'the Commission approved an increase of $4.0 million' -> do NOT map to Requested tag; map to PublicUtilitiesApprovedRateIncreaseDecreaseAmount or flag for review.\n  - 'the filing is expected to result in annual revenue increases of $3.0 million' -> do NOT map to Requested tag; map to Revenues/EstimatedImpact or flag for review.\n- Implementation note: run this rule early in lexical-to-tag pipeline (before generic currency-to-revenue fallbacks). Ensure supervision records include cue spans to train classifiers to distinguish requested vs approved vs revenue-impact contexts.\n[ctx-00005] helpful=0 harmful=0 :: Atomic rule: Lease-range endpoint mapping when a single 'between A and B' range is used with both 'lease assets' and 'lease liabilities'. Purpose: deterministically map numeric endpoints in phrases like \"recognition of additional lease assets and lease liabilities between $250.0 and $350.0 as of <date>\". Detection patterns (case-insensitive): /(?:recognition|recognise|recognized|recognised).*lease assets?\\s+and\\s+lease liabilities?\\s+between\\s+\\$?[0-9,]+(?:\\.\\d+)?\\s+and\\s+\\$?[0-9,]+(?:\\.\\d+)?/i or general pattern /(lease assets?|lease liabilities?).{0,80}?between\\s+\\$?[0-9,]+(?:\\.\\d+)?\\s+and\\s+\\$?[0-9,]+(?:\\.\\d+)?/i. Decision flow (apply in order): 1) If the clause explicitly assigns amounts to each side (e.g., \"assets of $A and liabilities of $B\"), map accordingly (assets -> OperatingLeaseRightOfUseAsset; liabilities -> OperatingLeaseLiability). 2) Else if the clause uses a two-endpoint range \"between A and B\" and both nouns 'assets' and 'liabilities' appear: a) If nouns appear in order 'assets' then 'liabilities' in the clause, map upper endpoint B -> OperatingLeaseRightOfUseAsset and lower endpoint A -> OperatingLeaseLiability. b) If nouns appear in reverse order ('liabilities' then 'assets'), invert mapping (upper -> liability, lower -> asset). 3) Else if only a single endpoint token is present (e.g., only \"$350.0\" appears) or endpoints are not clearly ordered, apply nearest-noun lexical association (token-distance window ±8 tokens): map the numeric to the most specific tag matching the nearest noun (\"asset\" -> OperatingLeaseRightOfUseAsset; \"liability\" -> OperatingLeaseLiability). 4) If token-distance method yields ties or no nearby asset/liability noun within ±8 tokens, mark the numeric as 'lease-range-ambiguous' and queue for human review (do NOT fall back to generic money tags). 5) Logging: record noun order, token distances, chosen mapping, and clause span. Unit-tests (atomic): - \"recognition of additional lease assets and lease liabilities between $250.0 and $350.0 as of January 1, 2019\" -> $350.0 => OperatingLeaseRightOfUseAsset; $250.0 => OperatingLeaseLiability (assets before liabilities rule). - \"recognition of additional lease liabilities and lease assets between $100 and $200\" -> $200 => OperatingLeaseLiability; $100 => OperatingLeaseRightOfUseAsset (reverse-order rule). - \"We recognized $350.0 of additional lease assets and liabilities\" (single token nearest 'assets') -> $350.0 => OperatingLeaseRightOfUseAsset. Implementation note: apply this rule before generic currency-to-asset/liability fallbacks and log ambiguous-range cases for QA.\n[ctx-00006] helpful=0 harmful=0 :: Atomic lexical-to-tag mapping: 'net sales' + geographic customer anchor -> RevenueFromContractWithCustomerExcludingAssessedTax. Purpose: deterministically map amounts described as 'net sales' to geographically qualified customers (e.g., 'to customers located outside the United States') to the most specific revenue taxonomy element and choose the assessed-tax variant. Detection patterns (case-insensitive): - Net-sales lexical cue: /\\bnet\\s+sales\\b|\\bsales,?\\s+net\\b/ within the sentence. - Geographic-customer anchors: /customers?\\s+(?:located|based)\\s+outside\\s+the\\s+United\\s+States|to\\s+customers\\s+outside\\s+the\\s+United\\s+States|international\\s+customers|foreign\\s+customers/ or short-form '\\boutside the U\\.S\\.?\\b'. Decision flow (apply in order): 1) If a currency numeric token appears within ±10 tokens of 'net sales' and a geographic-customer anchor appears in same sentence (or immediately adjacent sentence ±1), assign RevenueFromContractWithCustomerExcludingAssessedTax to that numeric. 2) Taxonomy-variant selection: prefer the 'ExcludingAssessedTax' variant when the sentence does NOT mention assessed taxes, sales taxes, VAT, GST, or tax-inclusive language. Detection regex for tax-inclusion cues: /assessed tax|sales tax|inclusive of tax|includes tax|VAT|GST|inclusive of|exclusive of taxes/i. 3) If sentence contains explicit assessed/sales-tax inclusion language, map to the 'IncludingAssessedTax' variant (if present) or flag 'revenue-tax-variant-ambiguous' for review. 4) Year-association: when multiple year-labeled numeric values are listed in same sentence (e.g., \"$634.8, $627.1 and $655.6 for 2018, 2017 and 2016\"), preserve mapping of each numeric to its year label by nearest-year-token association (token-distance window ±6 tokens) before applying revenue tag; attach year metadata to each assigned RevenueFromContractWithCustomerExcludingAssessedTax tag. 5) Ambiguity handling: if 'net sales' appears without a customer geographic anchor but a nearby phrase 'international'/'outside' exists, treat as geographic match; otherwise map 'net sales' to the generic RevenueFromContractWithCustomer tag but log for QA. 6) Unit-tests (atomic): - \"Net sales to customers located outside the United States were $634.8, $627.1 and $655.6 for 2018, 2017 and 2016\" -> map each numeric to RevenueFromContractWithCustomerExcludingAssessedTax with corresponding year association. - \"Net sales to foreign customers were $10.0\" -> $10.0 => RevenueFromContractWithCustomerExcludingAssessedTax. - \"Net sales (including sales tax) to customers outside the U.S. were $5.0\" -> map to RevenueFromContractWithCustomerIncludingAssessedTax or flag if taxonomy variant missing. Implementation note: run this rule before generic currency-to-sales fallbacks and always log the presence/absence of assessed-tax cues and year associations for traceability.\n[ctx-00007] helpful=0 harmful=0 :: Equity/Share-based two-step disambiguation (subject-action + specificity precedence) — atomic heuristic to distinguish grants-in-period vs plan-authorized vs generic common-stock-reserved for any share-count numeric. Steps (apply in order): 1) Subject & action extraction (primary anchors): - Detect subject tokens (case-insensitive): /option(s)?\\b/, /award(s)?\\b/, /grant(s)?\\b/, /share-based payment/, /the Plan\\b/, /stock plan\\b/, /Long Term Incentive Plan\\b/, /the Plan\\b/. - Detect action/verb tokens (case-insensitive): GRANT cues = /grant|granted|may continue to receive|may receive|will receive|annual option grant|annual grant|per director|per\\s+year|each\\s+director/; AUTH/RESERVE cues = /authorized|authorised|reserve(d)? for future grant|reserved for future grant|reserved for future issuance|reserved\\b/; ISSUANCE cues = /issued|issued and outstanding|issued to|issued at/; AVAILABILITY cues = /available for grant|remain available|available under the Plan/. 2) Association windows & antecedent resolution: - Require numeric token to be within ±8 tokens of the detected subject/action cue in the same sentence for high-confidence mapping. - Allow antecedent plan-subject resolution from previous sentence if anaphor ('the Plan', named plan) present; antecedent span allowed ≤ 40 tokens across sentence boundary and only ±1 sentence. 3) Per-period / per-award grant detection rules (map -> OptionsGrantsInPeriodGross): - If subject includes 'option(s)'/'grant(s)' AND action cue matches any GRANT cues above (especially modifiers: 'annual', 'per director', 'each', 'no more than', 'maximum annual grant', 'for no more than'), map numeric -> OptionsGrantsInPeriodGross (grants-in-period). - Example triggers (atomic): /annual option grant for no more than\\s+[0-9,]+/, /may continue to receive an annual option grant of\\s+[0-9,]+/, /no more than\\s+[0-9,]+\\s+shares\\s+(per|each|annually)/. 4) Plan-specific authorization/reservation detection rules (map -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized): - If action includes AUTH/RESERVE cues AND subject refers to options/awards/plan (explicit 'options to purchase', 'under the Plan', 'reserved for future grant' co-occurring with 'option(s)'/'award(s)'), map numeric -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized. - Treat the collocation 'authorized and reserved for future grant' with an 'option' subject as a strong plan-authorization signal. 5) Generic common-stock reserved fallback (map -> CommonStockCapitalSharesReservedForFutureIssuance): - If action includes 'reserved'/'reserved for future issuance' but NO explicit option/award/plan anchor within ±8 tokens or antecedent ±1 sentence, map numeric -> CommonStockCapitalSharesReservedForFutureIssuance. 6) Precedence & tie-breakers (apply when multiple candidate tags score >0): - Precedence order: (a) If GRANT cue present -> OptionsGrantsInPeriodGross (highest when 'annual', 'per', 'no more than', 'each', 'may continue to receive' appear). (b) Else if AUTH/RESERVE cue present with option/plan anchor -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized. (c) Else if only generic 'reserved' + common-stock anchor present -> CommonStockCapitalSharesReservedForFutureIssuance. - If both grant-modifier and authorization verb appear in same clause (e.g., 'may receive a grant not to exceed X shares authorized under the Plan for annual grants'), prefer the tag indicated by the modifier that scopes the number: 'per-period/per-award' modifiers (annual/per director/each) -> grants-in-period. If conflict persists, flag as 'plan-grant-auth-ambiguous' for human review and log both anchors. 7) Token matching sensitivity & confidence flags: - Treat words 'annual', 'per', 'each', 'no more than', 'maximum' as strong per-period signals (weight +10). - Treat verbs 'authorized', 'reserved for future grant', 'reserved' with an option/plan anchor as strong authorization signals (weight +9). - Map only when weighted score for chosen tag exceeds alternate by a threshold (e.g., >4); otherwise queue for review. 8) Examples / unit-tests to add (atomic): - 'non-employee directors may continue to receive an annual option grant for no more than 10,000 shares.' -> 10,000 = OptionsGrantsInPeriodGross. - 'options to purchase 989,081 shares ... were authorized and reserved for future grant.' -> 989,081 = ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized. - '1,000,000 shares reserved for future issuance under the charter' (no plan/option mention) -> 1,000,000 = CommonStockCapitalSharesReservedForFutureIssuance. - 'maximum number of shares that may be delivered under the Plan is 15,000,000' -> 15,000,000 = ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized. - 'no shares remain available under the 2014 Long Term Incentive Plan' -> 0 = ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant. 9) Logging & QA: - For every mapping log: subject anchor span, action cue span, chosen tag, competing tag(s) with score differential, and antecedent-plan span if used. - If mapping results in tie or falls below confidence threshold, label 'plan-grant-auth-ambiguous' and queue for human review/training. Implementation note: place this rule immediately after existing ctx-00001 plan-anchor detection and before any generic 'reserved'->CommonStockCapitalSharesReservedForFutureIssuance or nearest-lexical-match fallback to prevent the two mislabels observed.\n[ctx-00008] helpful=0 harmful=0 :: Atomic heuristic: Instrument-class-first mapping for share-based awards (prevent misclassifying SARs/UARs as options). Purpose: always classify award instrument type before selecting grants/issued tag or tag-variant (Gross vs Non-Options). Rules (apply in order): 1) Instrument-class lexicon (case-insensitive regexes; apply exact-match before fuzzy): - Options signals -> /\\boption(s)?\\b|stock\\s+option(s)?|option-based\\b/. - Equity-instruments-other-than-options signals -> /\\b(unit\\s+appreciation\\s+right(s)?|UARs?|UAR|SARs?|SAR|stock\\s+appreciation\\s+right(s)?|restricted\\s+stock\\s+unit(s)?|RSU(s)?|dividend\\s+equivalent\\s+unit(s)?|dividend\\s+equivalent\\b|restricted\\s+stock\\b)/. If both classes appear, prefer explicit token that matches the instrument noun closest to numeric token (distance weighting). 2) Association window: treat the instrument-class cue as global for any numeric token in the same sentence or within ±1 sentence if anaphoric ('the awards', 'such units') and antecedent span <= 40 tokens. 3) Grants-in-period mapping: when action verb indicates issuance/grant (regex: /\\b(grant(ed)?|issued|awarded|awards|grants-in-period|grants|issued and outstanding)\\b/) and instrument-class == options -> map to OptionsGrantsInPeriod... (option grants). If instrument-class == equity-instruments-other-than-options -> map to ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsGrantsInPeriod (grants-in-period for non-options). 4) Outstanding / Nonvested counts: when numeric phrase describes 'units outstanding', 'nonvested', 'nonvested units', 'dividend equivalent units outstanding' and instrument-class matches equity-instruments-other-than-options -> map to ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsNonvestedNumber (or taxonomy NonvestedNumber variant appropriate). 5) Gross-variant guard: only allow selection of an 'Options...Gross' variant when (a) instrument-class == options AND (b) either the sentence contains explicit 'gross' / 'before forfeitures' cues (/\\bgross\\b|before\\s+forfeitur(es)?|gross\\s+of\\s+forfeitures/) OR taxonomy definitions require Gross form. Otherwise, do NOT select an options-Gross variant for non-option instruments. 6) Precedence scoring & tie-breaker: compute score = (instrument_class_exact_match? 10 : 0) + (action_verb_grant? 5 : 0) + (token_distance_factor = max(0, 8 - token_distance_to_numeric)). Choose tag with highest score; require chosen tag score >= next_best + 4, else flag 'instrument-class-ambiguous' for review. 7) Examples / unit-tests (atomic): - '8 thousand unit appreciation rights issued' -> 8,000 = ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsGrantsInPeriod. - '5,000 SARs were granted' -> 5,000 = ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsGrantsInPeriod. - '10,000 options were granted' -> 10,000 = OptionsGrantsInPeriodGross (only if 'gross' cue present) else OptionsGrantsInPeriodNet/appropriate variant per taxonomy. - '33 thousand dividend equivalent units outstanding at March 31' -> 33,000 = EquityInstrumentsOtherThanOptionsNonvestedNumber. 8) Ambiguity handling & logging: log instrument-class cue span, action-verb span, chosen tag, competing tag(s) with scores, and rule reason. On low-confidence or ties, label 'instrument-class-ambiguous' and queue for human review; accumulate these cases for retraining. 9) Implementation note: run this rule before any generic 'grants'/'issued' -> options fallback and before applying 'nearest lexical match' to prevent superficial keyword collisions.\n[ctx-00009] helpful=0 harmful=0 :: Equity-reserved-vs-plan-authorized disambiguation (atomic rule)\nPurpose: When text contains \"reserved\" + a plan reference, decide whether the numeric is a corporate common-stock reservation (CommonStockCapitalSharesReservedForFutureIssuance) or a plan-authorized/share-based-compensation authorization (ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized).\nExact lexical cues (case-insensitive):\n- ESPP plan type cues: /\\bESPP\\b|Employee Stock Purchase Plan|Employee Stock Purchase Plan\\b/\n- Common-stock noun cues: /\\bclass\\s+[A-Z]\\s+common\\s+stock\\b|\\bcommon\\s+stock\\b|\\bshares\\s+of\\s+common\\s+stock\\b/ \n- Share-based-compensation award cues: /award(s)?|option(s)?|RSU(s)?|restricted\\s+stock|available\\s+for\\s+grant|available\\s+for\\s+award|available\\s+under\\s+the\\s+Plan|available\\s+for\\s+grant\\b|awards\\s+reserved|reserved\\s+for\\s+future\\s+grant|authorized\\s+to\\s+issue\\s+under\\s+the\\s+Plan/ \n- Generic reserved cue: /\\breserved\\b|reserved\\s+for\\s+future\\s+issuance\\b/\nAssociation windows & antecedent resolution:\n- Require numeric token to be within ±8 tokens of the reserved cue for high-confidence mapping.\n- Allow antecedent resolution to prior sentence (±1 sentence) when 'the Plan' or a named plan appears earlier; antecedent span must be <= 40 tokens across sentence boundary.\nDecision flow (apply in order):\n1) If an ESPP plan-type cue is present in same sentence OR antecedent plan resolved to an ESPP within ±1 sentence -> map numeric -> CommonStockCapitalSharesReservedForFutureIssuance (ESPP reservations are corporate equity reserved-for-issuance disclosures).\n2) Else if a common-stock noun cue ('Class A common stock', 'common stock', 'shares of common stock') co-occurs with reserved-language in same sentence or immediately adjacent sentence (±1) -> map numeric -> CommonStockCapitalSharesReservedForFutureIssuance.\n3) Else if reserved-language co-occurs with explicit award/instrument cues (options, RSUs, awards, 'available for grant', 'available under the Plan') within ±8 tokens OR antecedent plan resolved is clearly a 'stock plan' described as for awards -> map numeric -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized.\n4) Else (reserved + plan but no ESPP/common-stock noun and no award/instrument anchor) -> do NOT auto-assign: flag as 'reserved-plan-ambiguous' and queue for human review; prefer CommonStockCapitalSharesReservedForFutureIssuance only when explicit corporate-equity headings or charter references present.\nTie-breakers & precedence:\n- Give ESPP and explicit 'common stock' noun cues precedence over generic 'plan' anchors and over award-sounding verbs (e.g., 'reserved for issuance under the 2016 ESPP' -> CommonStockCapitalSharesReservedForFutureIssuance).\n- If both award-cues and common-stock noun cues appear, prefer CommonStockCapitalSharesReservedForFutureIssuance only when the sentence stresses issuance of common stock (e.g., 'shares of Class A common stock were initially reserved for issuance under the 2016 ESPP'); else if sentence explicitly frames reserved amount as for awards/grants ('reserved for future grant under the Stock Plan') prefer ShareBasedCompensationArrangement...Authorized.\nConfidence scoring notes:\n- ESPP present: +12 weight for CommonStock tag.\n- 'common stock' noun within ±8 tokens: +10 weight for CommonStock tag.\n- Award/instrument cue within ±8 tokens: +9 weight for ShareBasedComp tag.\n- Require chosen tag score >= next_best + 4 or mark 'reserved-plan-ambiguous' for review.\nLogging & QA:\n- Log which cues were matched (span offsets), antecedent plan name (if resolved), chosen tag, competing tags with scores, and confidence decision.\n- Add any ambiguous cases to 'reserved-plan-ambiguous' queue for annotation and retraining.\nUnit-tests (atomic examples):\n- 'A total of 3,800,000 shares of Class A common stock were initially reserved for issuance under the 2016 ESPP.' -> 3,800,000 => CommonStockCapitalSharesReservedForFutureIssuance.\n- '1,000,000 shares reserved for future issuance under the charter' -> 1,000,000 => CommonStockCapitalSharesReservedForFutureIssuance.\n- 'options to purchase 989,081 shares were authorized and reserved for future grant under the Plan.' -> 989,081 => ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized.\n- 'The Plan authorizes up to 15,000,000 shares available for grant.' -> 15,000,000 => ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized.\nImplementation note: insert this rule immediately after ctx-00001 plan-anchor detection and before any generic 'reserved' -> ShareBasedCompensationArrangement... authorized fallback to prevent overgeneralization to plan-authorized tag when the reserved instrument is corporate common stock or when an ESPP is involved.\n## OTHERS\n[misc-00002] helpful=0 harmful=0 :: Micro decision flow for acquisition-related monetary phrases (apply in order): 1) Search sentence (or immediate surrounding sentence ±1) for the exact phrase variants from the lexical-to-tag mapping. 2) If only one cue matches, assign the corresponding tag. 3) If multiple cues match, choose the cue whose token span is closest to the numeric amount (measure token-distance from numeric token to cue span). 4) If both cues are equidistant or no numeric amount is present, break ties by cue specificity: ('purchase price' > 'cash paid' > 'consideration'). 5) If still ambiguous, prefer PaymentsToAcquireBusinessesGross when the sentence explicitly mentions payments, cash, or amounts described as 'paid' or 'paid as part of the acquisition'; prefer BusinessCombinationConsiderationTransferred1 only when the text uses 'consideration' or explicitly 'consideration transferred' and describes the composition of consideration (e.g., cash + shares + other instruments). 6) Log ambiguous cases for human review and add the sentence to a short test-suite.\n\n**Reflection:**\n(empty)\n\n**Question:**\nYou are XBRL expert.  Here is a list of US GAAP tags options: ,OperatingLeasesRentExpenseNet,MinorityInterestOwnershipPercentageByParent,ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsGrantsInPeriodWeightedAverageGrantDateFairValue,DerivativeNotionalAmount,PreferredStockDividendRatePercentage,GuaranteeObligationsMaximumExposure,LossContingencyEstimateOfPossibleLoss,OperatingLeaseRightOfUseAsset,NumberOfOperatingSegments,PaymentsToAcquireBusinessesNetOfCashAcquired,DebtInstrumentBasisSpreadOnVariableRate1,InterestExpense,ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsNonvestedNumber,CommonStockSharesOutstanding,StockRepurchaseProgramRemainingAuthorizedRepurchaseAmount1,LineOfCreditFacilityInterestRateAtPeriodEnd,ContractWithCustomerLiabilityRevenueRecognized,AmortizationOfIntangibleAssets,ShareBasedCompensationArrangementByShareBasedPaymentAwardAwardVestingPeriod1,DebtInstrumentRedemptionPricePercentage,RepaymentsOfDebt,DisposalGroupIncludingDiscontinuedOperationConsideration,LineOfCreditFacilityRemainingBorrowingCapacity,BusinessCombinationAcquisitionRelatedCosts,LesseeOperatingLeaseRenewalTerm,TreasuryStockValueAcquiredCostMethod,PreferredStockSharesAuthorized,RelatedPartyTransactionExpensesFromTransactionsWithRelatedParty,ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsVestedInPeriodTotalFairValue,UnrecognizedTaxBenefitsThatWouldImpactEffectiveTaxRate,SaleOfStockNumberOfSharesIssuedInTransaction,OperatingLeaseWeightedAverageRemainingLeaseTerm1,StockRepurchaseProgramAuthorizedAmount1,SupplementalInformationForPropertyCasualtyInsuranceUnderwritersPriorYearClaimsAndClaimsAdjustmentExpense,RelatedPartyTransactionAmountsOfTransaction,CommonStockDividendsPerShareDeclared,IncomeLossFromEquityMethodInvestments,DebtInstrumentMaturityDate,LettersOfCreditOutstandingAmount,AllocatedShareBasedCompensationExpense,EffectiveIncomeTaxRateContinuingOperations,ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized,ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant,ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsGrantsInPeriodGross,ConcentrationRiskPercentage1,OperatingLeasePayments,LongTermDebt,RestructuringCharges,CommonStockParOrStatedValuePerShare,DebtInstrumentConvertibleConversionPrice1,Revenues,DeferredFinanceCostsGross,EffectiveIncomeTaxRateReconciliationAtFederalStatutoryIncomeTaxRate,DefinedBenefitPlanContributionsByEmployer,GoodwillImpairmentLoss,LossContingencyPendingClaimsNumber,OperatingLeaseLiability,LineOfCreditFacilityMaximumBorrowingCapacity,OperatingLeaseExpense,DerivativeFixedInterestRate,LineOfCreditFacilityCommitmentFeePercentage,CumulativeEffectOfNewAccountingPrincipleInPeriodOfAdoption,SharebasedCompensationArrangementBySharebasedPaymentAwardAwardVestingRightsPercentage,DebtWeightedAverageInterestRate,PaymentsToAcquireBusinessesGross,DebtInstrumentCarryingAmount,BusinessCombinationRecognizedIdentifiableAssetsAcquiredAndLiabilitiesAssumedIntangibles,RevenueFromContractWithCustomerExcludingAssessedTax,PublicUtilitiesRequestedRateIncreaseDecreaseAmount,ContractWithCustomerLiability,DebtInstrumentTerm,DebtInstrumentFairValue,RevenueFromContractWithCustomerIncludingAssessedTax,RevenueFromRelatedParties,DebtInstrumentInterestRateEffectivePercentage,GainsLossesOnExtinguishmentOfDebt,EmployeeServiceShareBasedCompensationNonvestedAwardsTotalCompensationCostNotYetRecognizedShareBasedAwardsOtherThanOptions,DebtInstrumentUnamortizedDiscount,LineOfCreditFacilityCurrentBorrowingCapacity,CashAndCashEquivalentsFairValueDisclosure,LesseeOperatingLeaseTermOfContract,RestructuringAndRelatedCostExpectedCost1,DefinedContributionPlanCostRecognized,OperatingLeaseCost,LossContingencyDamagesSoughtValue,ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsGrantsInPeriodWeightedAverageGrantDateFairValue,ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsGrantsInPeriod,EmployeeServiceShareBasedCompensationNonvestedAwardsTotalCompensationCostNotYetRecognizedPeriodForRecognition1,EmployeeServiceShareBasedCompensationNonvestedAwardsTotalCompensationCostNotYetRecognized,FiniteLivedIntangibleAssetUsefulLife,Depreciation,AcquiredFiniteLivedIntangibleAssetsWeightedAverageUsefulLife,DeferredFinanceCostsNet,DebtInstrumentInterestRateStatedPercentage,Goodwill,CommonStockCapitalSharesReservedForFutureIssuance,LongTermDebtFairValue,OperatingLossCarryforwards,InterestExpenseDebt,UnrecognizedTaxBenefits,BusinessCombinationContingentConsiderationLiability,TreasuryStockAcquiredAverageCostPerShare,ClassOfWarrantOrRightExercisePriceOfWarrantsOrRights1,SharebasedCompensationArrangementBySharebasedPaymentAwardExpirationPeriod,NumberOfRealEstateProperties,TreasuryStockSharesAcquired,AntidilutiveSecuritiesExcludedFromComputationOfEarningsPerShareAmount,CommonStockSharesAuthorized,SharePrice,DebtInstrumentFaceAmount,AmortizationOfFinancingCosts,BusinessCombinationConsiderationTransferred1,LineOfCreditFacilityUnusedCapacityCommitmentFeePercentage,StockRepurchasedDuringPeriodShares,ProceedsFromIssuanceOfCommonStock,StockIssuedDuringPeriodSharesNewIssues,AccrualForEnvironmentalLossContingencies,BusinessAcquisitionPercentageOfVotingInterestsAcquired,LossContingencyAccrualAtCarryingValue,OperatingLeaseWeightedAverageDiscountRatePercent,ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsExercisesInPeriodTotalIntrinsicValue,BusinessAcquisitionEquityInterestsIssuedOrIssuableNumberOfSharesIssued,CapitalizedContractCostAmortization,NumberOfReportableSegments,AssetImpairmentCharges,RevenueRemainingPerformanceObligation,EquityMethodInvestmentOwnershipPercentage,MinorityInterestOwnershipPercentageByNoncontrollingOwners,AreaOfRealEstateProperty,StockRepurchasedAndRetiredDuringPeriodShares,LineOfCredit,BusinessCombinationRecognizedIdentifiableAssetsAcquiredAndLiabilitiesAssumedIntangibleAssetsOtherThanGoodwill,IncomeTaxExpenseBenefit,PropertyPlantAndEquipmentUsefulLife,LeaseAndRentalExpense,ShareBasedCompensation,EquityMethodInvestments,SaleOfStockPricePerShare,EmployeeServiceShareBasedCompensationTaxBenefitFromCompensationExpense. Answer the following 4 independent questions by providing only  4 US GAAP tags answers in the order of the questions. Each answer must be saperated by a comma (,).  Provide nothing else. \n1. What is best tag for entity \"years\" in sentence: \"The risk free interest rate is based on yields on U.S. Treasury STRIPS ( Separate Trading of Registered Interest and Principal of Securities ) with a maturity similar to the estimated expected term of the options The fair value of our stock options was estimated assuming no expected dividends and the following weighted - average assumptions : Stock Options The following table summarizes the option activity under the Plans for the three months ended March 31 , 2017 : Options to purchase Class A common stock generally vest over a three - or four - year period and are generally granted for a term of ten years .?\"\n2. What is best tag for entity \"1.0\" in sentence: \"The total intrinsic value of options exercised during the three months ended March 31 , 2017 and 2016 was $ 1.0 million and $ 0.6 million , respectively .?\"\n3. What is best tag for entity \"0.6\" in sentence: \"The total intrinsic value of options exercised during the three months ended March 31 , 2017 and 2016 was $ 1.0 million and $ 0.6 million , respectively .?\"\n4. What is best tag for entity \"5.78\" in sentence: \"The weighted - average grant - date fair value of options granted during the three months ended March 31 , 2017 and 2016 was $ 5.78 and $ 6.75 , respectively .?\"\nOutput US GAAP tags:\n\n**Context:**\n\n\n**Answer in this exact JSON format:**\n{\n  \"reasoning\": \"[Your chain of thought / reasoning / thinking process, detailed analysis and calculations]\",  \n  \"bullet_ids\": [\"calc-00001\", \"fin-00002\"],  \n  \"final_answer\": \"[Your concise final answer here]\"\n}\n\n---\n",
  "response": "{\n  \"reasoning\": \"I parsed each sentence and applied the playbook heuristics for share-based compensation and equity/plan lexical mappings. Step 1 (years — vesting/term): The sentence explicitly describes vesting periods and term for option awards: \\\"vest over a three- or four-year period\\\" and \\\"term of ten years.\\\" Per ctx-00001 (plan/equity lexical rules) and ctx-00007 (share-based two-step disambiguation) we detect a plan/option anchor and a vesting-period expression. The most specific tag for an award vesting period is ShareBasedCompensationArrangementByShareBasedPaymentAwardAwardVestingPeriod1. Step 2 (1.0 million intrinsic value): The phrase \\\"total intrinsic value of options exercised ... was $1.0 million\\\" ties a currency amount to option exercises. Instrument-class-first (ctx-00008) confirms instrument is options; ctx-00007 and ctx-00001 guide mapping exercise intrinsic values to the options-exercises intrinsic-value taxonomy element. The best-match tag is ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsExercisesInPeriodTotalIntrinsicValue. Step 3 (0.6 million intrinsic value): Same reasoning and mapping as step 2 — the $0.6 million is the intrinsic value for the other period and maps to the same tag ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsExercisesInPeriodTotalIntrinsicValue. Step 4 (5.78 weighted-average grant-date fair value): The sentence gives a weighted-average grant-date fair value for options granted. With an options instrument-anchor and a grant-date fair value phrase, the precise tag is ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsGrantsInPeriodWeightedAverageGrantDateFairValue (per ctx-00008 and ctx-00007 guidance to prefer instrument-specific grants/weighted-average fair-value tags). I validated each chosen tag is present in the provided US GAAP tag list and is the most specific match given the context (vest/term, intrinsic value of exercised options, and grant-date weighted-average fair value).\",\n  \"bullet_ids\": [\"ctx-00001\", \"ctx-00007\", \"ctx-00008\"],\n  \"final_answer\": \"ShareBasedCompensationArrangementByShareBasedPaymentAwardAwardVestingPeriod1,ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsExercisesInPeriodTotalIntrinsicValue,ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsExercisesInPeriodTotalIntrinsicValue,ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsGrantsInPeriodWeightedAverageGrantDateFairValue\"\n}",
  "prompt_time": 0.0,
  "response_time": 18.453402280807495,
  "total_time": 18.453402280807495,
  "call_time": 18.453402280807495,
  "prompt_length": 85863,
  "response_length": 2481,
  "prompt_num_tokens": 19901,
  "response_num_tokens": 1758,
  "timestamp": "20260206_111214_049",
  "datetime": "2026-02-06T11:12:14.049596"
}