## STRATEGIES & INSIGHTS

## FORMULAS & CALCULATIONS

## CODE SNIPPETS & TEMPLATES

[code-00004] helpful=0 harmful=0 :: Regex detection template (pseudo-code): - patterns = { 'PaymentsToAcquireBusinessesGross': [/(?:aggregate\s+|total\s+)?purchase\s+price/i, /cash(?:\s+consideration)?\s+paid/i], 'BusinessCombinationConsiderationTransferred1': [/(?:aggregate\s+)?consideration(?:\s+transferred)?/i], 'BusinessAcquisitionEquityInterestsIssuedOrIssuableNumberOfSharesIssued': [/issued\s+\d[\d,]*/i, /shares\s+issued/i] } - For each numeric token in sentence: find nearest matching pattern within N tokens (N=8). - Assign tag of nearest matched pattern. - If multiple tags at equal distance, apply specificity precedence: purchase_price > cash_paid > consideration. - If no match, fall back to semantic classifier but flag for review.
## COMMON MISTAKES TO AVOID

[err-00003] helpful=0 harmful=0 :: Do not conflate 'purchase price' with 'consideration'. Anti-pattern: tagging both an 'aggregate purchase price of $X' and an 'aggregate consideration of $Y' with the same 'consideration' tag. Concrete prevention: enforce lexical-match-first rule (if 'purchase price' appears, do not map that phrase to BusinessCombinationConsiderationTransferred1). Add a unit-test: example sentence 'aggregate purchase price of $162 million' must map to PaymentsToAcquireBusinessesGross; 'aggregate consideration of $1.2 billion' must map to BusinessCombinationConsiderationTransferred1.
[err-00007] helpful=0 harmful=0 :: Anti-patterns and prevention rules (atomic): - Anti-pattern: mapping any 'per share' price to SaleOfStockPricePerShare without checking instrument class. Prevention: before assigning SaleOfStockPricePerShare check for convertible/preferred/mandatory cues in same sentence; if present, map to convertible-specific price tag. - Anti-pattern: treating 'we sold X shares' as a generic secondary sale when underwriter/overallotment/offer language is present. Prevention: if 'we sold' co-occurs with underwriter/overallotment/overallotment exercise/offer language within ±1 sentence, treat as primary issuance and map share counts to StockIssuedDuringPeriodSharesNewIssues. - Anti-pattern: applying nearest-lexical-match only. Prevention: implement precedence override: instrument-type and offering flags must be evaluated and can override nearest lexical match. - Add unit-tests for regressions: include at least 10 sentences mixing convertible language with 'per share' and 'sold' / 'offered' / 'underwriters' to ensure convertible/issuance tags win over generic sale tags.
[err-00010] helpful=0 harmful=0 :: err-XXXX :: Anti-pattern: blanket-mapping 'availability' -> RemainingBorrowingCapacity. Prevention checklist (atomic):
- Do not assign RemainingBorrowingCapacity solely because the word 'availability' appears. First check for a facility-capacity anchor in same or previous sentence ("has a $X credit facility", "in an aggregate principal amount of up to $X").
- If 'availability' is used in a comparative clause referencing a previously stated cap ("may be less than $X" where X == stated cap), map to MaximumBorrowingCapacity (the sentence is comparing to the contractual cap or describing an effective cap constraint).
- If the phrase contains explicit current-amount tokens ("amount available under the facility totaled", "was available under the facility"), map to RemainingBorrowingCapacity.
- If no anchor and no explicit remaining-amount phrase exist, mark as ambiguous and require human review instead of auto-mapping.
- Add automated unit-tests for both positive and negative examples and log ambiguous cases for retraining.
[err-00014] helpful=0 harmful=0 :: Tie-breaker: prefer instrument-specific mapping over generic financial-category tags when instrument anchor present (atomic prevention rule): - Anti-pattern: mapping an 'interest' currency amount to generic InterestExpense or mapping a 'per annum' percentage to a spread tag without checking instrument context. - Prevention checklist (apply in order): 1) If numeric token is percentage AND 'per annum'/'per year' present AND any instrument-anchor (note/loan/term loan/seller note) in sentence ±1 -> map to DebtInstrumentInterestRateStatedPercentage. 2) If numeric token is currency AND interest lexical cue ('interest charges', 'interest expense', 'interest on') AND instrument-anchor in sentence ±1 -> map to InterestExpenseDebt (link numeric to instrument anchor). 3) If both 'spread'/'margin' and 'per annum' cues occur, prefer per-annum/stated-rate mapping; log conflict for QA. 4) If customer + revenue percent detected, map to ConcentrationRiskPercentage1; do not map to generic 'percentage' tags. 5) If instrument-anchor is absent for interest-charge currency amounts, map to generic InterestExpense and flag for human review; add the sentence to a retraining queue. - Unit-tests: include all examples referenced in the above heuristics and assert instrument-specific tags beat generic alternatives.
[err-00002] helpful=0 harmful=0 :: Atomic negation-to-zero rule for availability quantities (prevention of treating negation as 'absent' rather than numeric zero). Purpose: ensure explicit negative availability phrases ('no', 'none', 'not available') are normalized to numeric zero for quantity tags and mapped to the most specific availability tag. Rules:
1) Negation cues (case-insensitive regex examples): /\bno\b/, /\bnone\b/, /\bnot\s+available\b/, /\bthere\s+are\s+no\b/, /\bzero\b/ within ±6 tokens of an availability noun ('available', 'remain', 'remain\s+available', 'available\s+for\s+grant').
2) Quantity mapping: when negation cue co-occurs with availability noun and a plan/instrument anchor as applicable (e.g., 'under the Plan', 'under the facility'), assign numeric value 0 and map to the specific quantity tag (e.g., ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant = 0; LineOfCreditFacilityRemainingBorrowingCapacity = $0 when explicit 'amount available under the facility was $0' or 'no availability under the credit facility').
3) Scope constraints (do NOT apply universal zero conversion): do not convert negations that apply to non-quantity facts or idiomatic phrases ('no material impact', 'no change', 'no further details'); require proximity to a numeric/quantity noun and an anchor.
4) Tag-type constraint: only auto-convert to zero for quantity/amount-of-shares/remaining-capacity numeric tags; do not auto-convert percentages unless explicit context indicates 'zero percent' (e.g., 'no revenue' vs 'zero percent of revenue' are different; flag ambiguous percent-negations for review).
5) Token-window & antecedent resolution: allow antecedent anchors in previous sentence up to ±1 sentence when anaphoric phrase 'the Plan'/'the facility' is used; require confidence threshold for cross-sentence negation mapping; otherwise flag for human review.
6) Unit-tests/examples to add:
   - 'no shares remain available under the 2014 Long Term Incentive Plan' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant = 0.
   - 'There are no amounts available under the credit facility' -> LineOfCreditFacilityRemainingBorrowingCapacity = 0.
   - 'No material impact was expected' -> do NOT map to any numeric tag (must be filtered by scope constraint).
7) Logging: any auto-zero assignment should be recorded with the negation cue span and the anchor span for traceability and QA.
[err-00004] helpful=0 harmful=0 :: Anti-pattern prevention: Do not map currency amounts labeled as 'interest charges'/'interest expense' to generic InterestExpense when an instrument-anchor is present; instead map to InterestExpenseDebt and normalize explicit zeros. - Exact lexical cues (case-insensitive): /interest\s+charge(s)?\b/, /interest\s+expense(s)?\b/, /interest\s+on\s+the\s+(note|notes|loan|term\s+loan|seller\s+note|revolver)/i. - Instrument-anchor detection: detect instrument names (Seller Notes, Term Loan, Revolver, Senior Notes, etc.) in same sentence OR previous sentence (allow antecedent resolution up to ±1 sentence and span <= 40 tokens). - Association window: currency numeric token within ±12 tokens of interest lexical cue (primary) and instrument-anchor within ±40 tokens across sentence boundary if needed. - Mapping rule: if both interest lexical cue and instrument-anchor present -> assign InterestExpenseDebt (link numeric to instrument id). If interest lexical cue present but no instrument-anchor -> assign generic InterestExpense and flag 'interest-amount-no-instrument' for review. - Zero/numeric normalization: if the numeric token is explicit 'zero', 'no interest', 'none' appearing within ±6 tokens of interest lexical cue and instrument-anchor present, normalize to numeric 0 and assign InterestExpenseDebt = 0; log negation cue span and anchor span for traceability. - Precedence: this instrument-specific mapping overrides any generic expense or cash-flow tag. - Unit-tests (atomic): - '$179,507 of interest charges associated with the Seller Notes for the year' -> $179,507 = InterestExpenseDebt (Seller Notes). - 'No interest expense was recorded on the Term Loan' -> InterestExpenseDebt = 0 (Term Loan), logged. - '$331,397 of interest expense for the six months ended June 30 related to the Term Loan' -> $331,397 = InterestExpenseDebt. - Logging: record instrument anchor span and interest phrase span for each mapping for QA and retraining; aggregate 'interest-amount-no-instrument' cases into review queue.
[err-00002] helpful=0 harmful=0 :: [err-XXXXX] helpful=0 harmful=0 :: Anti-pattern: mapping any mention of 'Level 3' (or fair-value hierarchy) to DebtInstrumentFairValue without verifying explicit fair-value language or balance/date/VIE-listing context. Prevention checklist (atomic):
1) Do NOT assign DebtInstrumentFairValue solely because the phrase 'Level 3' or 'Level 2' appears. Require an explicit fair-value cue ('fair value', 'measured at fair value', 'at fair value') within ±8 tokens to justify a fair-value tag.
2) If numeric amounts are shown with date anchors ('as of', 'at [date]') or in table/note listing context or adjacent to 'VIE'/'variable interest entity' language, prefer DebtInstrumentCarryingAmount unless explicit fair-value language is present.
3) If 'Level X' and 'fair value' both appear, map to DebtInstrumentFairValue; if 'Level X' appears with 'as of'/'included'/'carrying' map to DebtInstrumentCarryingAmount; if both classes of cues are present, log and flag for human review under 'fairvalue-vs-carrying-conflict'.
4) Add unit-tests covering each anti-pattern and expected mapping (include the $297/$305 VIE example). 5) Log all 'level-only-ambiguous' mappings for manual QA and include them in retraining batches.
[err-00006] helpful=0 harmful=0 :: Anti-pattern prevention: Do NOT map any 'exercise price' + 'per share' phrase to generic price-per-share/sale tags without first checking instrument-anchor (atomic checklist):
1) Before assigning SaleOfStockPricePerShare or generic PricePerShare: search same sentence ±1 sentence for instrument-anchor tokens: /warrant(s)?\b/, /right(s)?\s+to\s+purchase\b/, /option(s)?\b/, /convertible\b/. If found, prefer instrument-specific exercise-price tag (warrant/option/convertible-conversion-price) that matches anchor. 
2) If anchor == 'warrant' or 'right' -> assign ClassOfWarrantOrRightExercisePriceOfWarrantsOrRights1. If anchor == 'option' -> assign option-exercise-price tag. If anchor == 'convertible' -> assign convertible-conversion price tag. 
3) If multiple anchors (e.g., 'warrants and options') use nearest-token distance to numeric; if tie, prefer the anchor explicitly adjacent to the phrase 'exercise price' or the most-specific named instrument in sentence. 
4) If no anchor found within ±1 sentence -> DO NOT auto-assign instrument-specific tag; either (a) map to generic SaleOfStockPricePerShare only if offering/sale language strongly indicates a sale-price (e.g., 'offering price', 'issued at'), otherwise (b) flag 'exercise-price-no-instrument' for human review. 
5) Add unit-tests to cover: warrant-exercise-price, option-exercise-price, convertible-conversion-price, and exercise-price with absent instrument anchor to ensure generic-sale tags do not win by default.
6) Logging: every time the anti-pattern would have applied (generic mapping prevented), log 'prevented-generic-exercise-price-mapping' with spans and chosen mapping reason for QA.
[err-00009] helpful=0 harmful=0 :: Prevent misclassification of defined-contribution plan costs vs defined-benefit disclosures (atomic heuristic)
- Purpose: ensure sentences describing 'net cost' or 'net contribution' of DC/defined contribution plans map to DefinedContributionPlanCostRecognized (expense/contribution) and are not misclassified as defined-benefit pension items or generic pension-note amounts. 
- Exact lexical cues/patterns (case-insensitive regexes): /\bdefined\s+contribution\b|\bDC\s+plan(s)?\b|\bdefined\s+contribution\s+plans?\b/, net-cost cues: /\bnet\s+cost\b|\bnet\s+contribution\b|\bemployer'?s?\s+required\s+contribution\b|\bwas\s+\$?[0-9,.]+\b|\bcontribution\s+required\b|\bcontributed\b/, explanatory equality cues: /=|equals|was\s+the\s+employer'?s?\s+required\s+contribution|which\s+equals/i. 
- Association windows: require both a DC anchor and a currency numeric token in same sentence OR DC anchor in previous sentence (±1 sentence antecedent resolution allowed, span <= 40 tokens). Primary numeric-distance window = ±12 tokens around numeric for mapping. 
- Precedence & decision flow: 1) If sentence contains DC anchor + 'net cost'/'net contribution' + currency numeric -> assign DefinedContributionPlanCostRecognized and link numeric to DC plan identity if present. 2) If 'net cost' appears but anchor ambiguous between DC and DB (defined benefit), prefer DC mapping only when explicit 'defined contribution'/'DC' or 'employer's required contribution' tied to contribution semantics is present; otherwise flag for human review rather than auto-mapping to DB tags. 3) If the sentence states 'net cost of the DC plans was $X and equals employer's required contribution' -> deterministically map to DefinedContributionPlanCostRecognized = $X. 
- Anti-pattern prevention: do NOT assign DefinedBenefitPlanCost or pension actuarial tags when 'defined contribution' lexical cue present; do not rely on generic 'pension'/'benefit' words without explicit 'defined benefit' anchor. 
- Unit-tests/examples to add:  - 'The net cost of the DC plans for the year was $9 million, which equals the employer's required contribution.' -> $9M = DefinedContributionPlanCostRecognized.  - 'Employer contributions to our defined contribution plan were $4.2M' -> $4.2M = DefinedContributionPlanCostRecognized.  - 'Net pension cost for defined benefit plans was $2M' -> map to DefinedBenefitPlanCost (do not conflate). 
- Logging: record DC-anchor span, net-cost phrase span, numeric span and mapping decision; flag any auto-mapped DC cost where 'pension' or 'benefit' words also appear nearby as 'dc-vs-db-proximity' for QA.
[err-00012] helpful=0 harmful=0 :: Atomic prevention rule: Debt-amount tag consistency and 'face' vs 'carrying' precedence in amendment/borrowing disclosures. Purpose: avoid mis-tagging contractually discussed loan amounts as 'face' when the dataset maps loan disclosures to carrying/book values. Rules (apply before generic 'principal' heuristics): 1) Detect amendment/borrowing/availability disclosure contexts by lexical anchors in same sentence OR ±1 sentence: /(amend(ed|ment)|as amended|available to borrow|availability under the (?:credit )?facility|in an aggregate principal amount of up to|revolv(?:ing)? credit facility|term loan|we may borrow|commitment)/i. 2) If anchor present and numeric token denotes the instrument's stated amount in that disclosure context -> prefer DebtInstrumentCarryingAmount. 3) Enforce cross-mention consistency: when two or more numeric mentions co-refer to the same instrument within ±1 sentence (match via instrument-name tokens, identical numeric value, or explicit anaphora 'the loan', 'the facility' referencing prior anchor), assign same tag to all mentions; if any prior mention was tagged CarryingAmount, propagate CarryingAmount to subsequent mentions unless an explicit 'face', 'original principal', 'originally issued' lexical cue appears. 4) Explicit cues forcing FaceAmount: map to DebtInstrumentFaceAmount ONLY if proximate lexical cues present within ±8 tokens: /face amount|original principal|stated principal|original principal amount|originally issued|originally issued principal|principal amount at issuance|original issue amount/. 5) Anti-pattern prevention: do NOT map any loan-mention currency to DebtInstrumentFaceAmount by default merely because it is a principal-like dollar figure; require either explicit 'face' cues OR absence of amendment/availability/disclosure anchors AND presence of issuance/origination language. 6) Fee/currency disambiguation: if the same numeric appears both as the instrument amount and as part of a fee calculation elsewhere, do not change instrument mapping — keep instrument mapping consistent; instead map fee amounts/percents per appositive/fee-base rules. 7) Unit-tests / examples to add: - "$20.0 million term loan (as amended)" -> $20.0M = DebtInstrumentCarryingAmount. - Repeated mentions of '$20.0 million' in adjacent sentences describing the same facility -> both = DebtInstrumentCarryingAmount. - 'original principal amount of $100M' -> $100M = DebtInstrumentFaceAmount (explicit face cue). 8) Logging: record instrument-anchor span, mapping decision, and whether mapping was propagated to co-referent mentions; flag 'inconsistent-instrument-tag' cases for review.
## PROBLEM-SOLVING HEURISTICS

[ph-00006] helpful=0 harmful=0 :: Delta decision flow (apply in order for each numeric token): 1) Sentence-level scan: detect instrument-type cues (convertible/preferred/mandatory) and offering cues (underwriters, overallotment, offering language) across the sentence ±1 surrounding sentence. 2) If instrument-type == convertible: - If numeric token is a price or appears adjacent to unit tokens like 'per share', 'per common share', 'per depositary share': assign DebtInstrumentConvertibleConversionPrice1 unless an explicit secondary-market sale cue is present. - If numeric token is shares and offering cues present: assign StockIssuedDuringPeriodSharesNewIssues. 3) If offering cues present (even if instrument-type absent): - If numeric token is number-of-shares -> assign StockIssuedDuringPeriodSharesNewIssues (primary issuance). - If numeric token is price and context uses 'offering price', 'issued at', 'offering at' -> prefer issuance-price tag (if available) else flag for review. 4) If no instrument-type or offering cues: use existing lexical-to-tag mapping (e.g., 'sold' -> SaleOfStockNumberOfSharesIssuedInTransaction) as fallback. 5) Tie-breaker precedence (high -> low): instrument-specific issuance tags (convertible conversion price, mandatory-convertible issuance) > issuance/share-specific tags (StockIssuedDuringPeriodSharesNewIssues) > generic sale tags (SaleOfStock*). 6) Ambiguity handling: if fallback mapping would assign a generic sale tag but any instrument/offering cue matched (score difference < threshold), flag the example and record sentence+reason for human review and training. 7) Unit-test generation examples to add to test suite: - "We sold 17,250,000 shares, including the underwriters' exercise of the overallotment option" -> 17,250,000 = StockIssuedDuringPeriodSharesNewIssues. - "Sempra Energy 6% Mandatory Convertible Preferred Stock, Series A, was issued at $100.00 per share" -> $100.00 = DebtInstrumentConvertibleConversionPrice1. - "We sold 500,000 shares on the open market" -> 500,000 = SaleOfStockNumberOfSharesIssuedInTransaction.
## CONTEXT CLUES & INDICATORS

[ctx-00001] helpful=0 harmful=0 :: Lexical-to-tag mapping (exact cues + variants). Use exact phrase detection before higher-level semantic heuristics. Patterns to detect (case-insensitive): - 'purchase price', 'total purchase price', 'aggregate purchase price' -> tag PaymentsToAcquireBusinessesGross. Regex examples: /(?:aggregate\s+|total\s+)?purchase\s+price/i. - 'consideration', 'consideration transferred', 'aggregate consideration' -> tag BusinessCombinationConsiderationTransferred1. Regex examples: /(?:aggregate\s+)?consideration(?:\s+transferred)?/i. - 'cash paid', 'cash consideration', 'cash consideration paid' -> PaymentsToAcquireBusinessesGross. Regex: /cash(?:\s+consideration)?\s+paid/i. - 'shares issued', 'shares were issued', 'issued X shares' -> BusinessAcquisitionEquityInterestsIssuedOrIssuableNumberOfSharesIssued. Regex: /(?:issued|issued\s+approximately)\s+\d+[\d,]*(?:\s+shares)?/i. Apply these matches to the phrase window that contains the numeric amount (±8 tokens) to ensure the amount belongs to the detected cue.
[ctx-00005] helpful=1 harmful=0 :: Instrument-type detection patterns (case-insensitive regexes and token cues): - Convertible indicators: /\bconvertible\b/, /\bconversion price\b/, /\bconversion cap\b/, /\bconvertible preferred\b/, /\bmandatory convertible\b/, /\bmandatory convertible preferred\b/. - Preferred-stock signals: /\bpreferred stock\b/, /\bseries [A-Z]+\b/, /\bdividend(?:-bearing)?\b/. - Debt-like convertible signals: /\b6% mandatory convertible preferred stock\b/ (literal patterns for numerated series acceptable). Offering / primary-issuance indicators: - underwriters: /\bunderwriter(s)?\b/, /\bwe sold\b/, /boffering\b/, /\boverallotment\b/, /\bexercise[d]?\s+overallotment\b/, /\bprimary offering\b/, /\boffered and sold\b/, /\bpurchased by the underwriters\b/. Sale / secondary-market indicators (inverse cues): /\bwe sold to third parties\b/, /\bsecondary offering\b/, /\btraded on\b/, /\bsold on the market\b/. Numeric association window policy: - Primary association window = ±8 tokens around numeric token. - If an instrument-type cue appears anywhere in the same sentence, treat instrument-type as global for that numeric token (i.e., instrument cues outrank local lexical matches within window). - If offering cue appears in same sentence or adjacent sentence (±1 sentence), mark transaction as primary issuance. Precedence mapping rules (applied after detection): - If instrument-type == convertible AND numeric_context == price -> map numeric to DebtInstrumentConvertibleConversionPrice1 (convertible conversion/issuance price). - If offering_flag == true AND numeric_context == shares -> map numeric to StockIssuedDuringPeriodSharesNewIssues. - If instrument-type == convertible AND offering_flag == true AND numeric_context == shares -> StockIssuedDuringPeriodSharesNewIssues (shares issued in offering of convertible instrument). - Only if no instrument-type OR offering cues detected, or if explicit secondary-sale cues present, fall back to SaleOfStockNumberOfSharesIssuedInTransaction / SaleOfStockPricePerShare. Distance weighting: - When multiple cues present, compute score = (instrument_cue_present ? 10 : 0) + (offering_cue_present ? 8 : 0) + (1 / (1 + token_distance_to_numeric)). Choose tag with highest score. Logging: - If generic sale tag would be selected but instrument-type OR offering cues exist with nonzero score, log for human review and mark as 'contextual-overlap' example for retraining.
[ctx-00008] helpful=1 harmful=0 :: Credit-facility vs spread disambiguation (atomic heuristics):
1) Purpose: ensure currency amounts describing facility capacity map to LineOfCreditFacilityMaximumBorrowingCapacity and percentage 'margin/spread' phrases over LIBOR/ABR map to DebtInstrumentBasisSpreadOnVariableRate1.
2) Exact lexical cues (case-insensitive):
   - Facility-capacity cues (map currency -> LineOfCreditFacilityMaximumBorrowingCapacity): /\b(revolv(?:ing)?\s+credit\s+facilit(?:y|ies)|credit\s+facility|revolver)\b/, /\bin\s+an\s+aggregate\s+principal\s+amount\b/, /\b(up\s+to)\b/, /\bmaximum\s+amount\b/, /\bcommitment\b/.
   - Outstanding/borrowings cues (do NOT map to capacity): /\boutstanding\b/, /\bborrowed\b/, /\bamounts?\s+outstanding\b/, /\bprincipal\s+amounts?\s+outstanding\b/.
   - Spread/margin cues (map percentage -> DebtInstrumentBasisSpreadOnVariableRate1): /\bmargin(s)?\b/, /\bspread(s)?\b/, /\bover\s+(?:LIBOR|ABR|an?\s+index)\b/, /\bin\s+the\s+case\s+of\s+(?:LIBOR|ABR)\s+loan(s)?\b/.
   - Absolute/effective-rate cues (do NOT map to spread): /\binterest\s+rate\b/, /\beffective\s+rate\b/, /\bper annum\b/, /\bAPR\b/.
3) Token association window policy: apply matches to numeric tokens using a ±8-token window for lexical cues and ±1 sentence for facility-level cues (e.g., named facility in prior sentence). If a facility-capacity cue appears anywhere in the same sentence or the immediately preceding sentence, currency amounts within ±16 tokens of that cue are capacity candidates.
4) Precedence rules (apply in order):
   a) If numeric is currency AND a facility-capacity cue matches (within window) -> assign LineOfCreditFacilityMaximumBorrowingCapacity.
   b) If numeric is currency AND an outstanding/borrowings cue matches -> assign outstanding-balance tag (do not map to capacity).
   c) If numeric is a percentage AND a spread/margin cue matches (within ±3 tokens) AND the phrase references LIBOR/ABR/index -> assign DebtInstrumentBasisSpreadOnVariableRate1.
   d) If numeric is a percentage AND absolute/effective-rate cues match (within ±3 tokens) -> assign the appropriate interest-rate tag (do NOT map to basis/spread); if no interest-rate tag exists in taxonomy, flag for human review rather than mapping to spread.
   e) If a conflict exists (e.g., 'margin' and 'interest rate' both present), prefer the more specific cue: 'margin/spread over LIBOR/ABR' > 'interest rate' only when text explicitly says 'margin' or 'spread'; otherwise prefer 'interest rate' mapping.
5) Normalization and token checks:
   - Recognize percentages with % or the word 'percent' or numeric forms like '1.00%–2.00%'.
   - Recognize currency with $ or currency words (dollars, EUR, etc.).
6) Logging & QA:
   - If mapping would assign a spread tag but the sentence contains 'interest rate'/'per annum' within ±3 tokens of the percentage, log as 'potential-rate-vs-spread' for human review and add to targeted unit-tests.
7) Minimal unit-tests to add (atomic examples):
   - "revolving credit facilities in an aggregate principal amount of up to $225.0 million" -> $225.0 million = LineOfCreditFacilityMaximumBorrowingCapacity.
   - "The margin ranges from 1.00% to 2.00% in the case of LIBOR loans" -> 1.00% and 2.00% = DebtInstrumentBasisSpreadOnVariableRate1.
   - "The interest rate is 5.00% per annum" -> 5.00% = interest-rate tag (do NOT map to DebtInstrumentBasisSpreadOnVariableRate1); if interest-rate tag missing, flag for review.
   - "$50 million outstanding under the revolver" -> $50 million = outstanding-balance tag (do NOT map to capacity).
8) Implementation notes (for classifiers / regex pipelines):
   - Apply these patterns before generic lexical-to-tag fallbacks.
   - When multiple tags are plausible, compute priority score where facility-capacity cue adds +10, outstanding cue +12 (to avoid mis-tagging as capacity), spread/margin +10, interest-rate cue +11; choose highest score and log ties.
   - Add examples that mix LIBOR/ABR and 'margin' with numeric ranges to training/regression suites to prevent collapse into absolute-rate tags.
[ctx-00009] helpful=1 harmful=0 :: Credit-facility availability vs capacity — atomic disambiguation rule (apply before generic 'availability' fallback):
1) Purpose: ensure currency amounts that reference facility size/capacity map to LineOfCreditFacilityMaximumBorrowingCapacity and only map to LineOfCreditFacilityRemainingBorrowingCapacity when the sentence explicitly reports a point-in-time available amount.
2) Exact lexical patterns (case-insensitive regexes):
   - Facility-capacity anchor (detect stated cap): /(?:has|has a|has an|in an aggregate principal amount of|in an aggregate amount of|in an aggregate principal amount of up to|up to)\s+\$?[\d,]+(?:\.\d+)?\s*(?:million|billion)?\s*(?:revolv(?:ing)?\s+credit\s+facilit(?:y|ies)|credit\s+facility|revolver)/i
   - Explicit remaining-amount cues (map to remaining borrowing capacity): /(?:amount available under the (?:credit )?facility(?: totaled|was|is)|available under the facility totaled|was available under the facility|amount available under the facility is)\b/i
   - Comparative/constraint cues (signal comparison to a stated cap): /availability\s+(?:under|of)\s+(?:this|the)?\s*(?:credit )?facilit(?:y|ies)\s+may\s+be\s+less\s+than\s+\$?[\d,]+(?:\.\d+)?/i, /may\s+be\s+less\s+than\b/i, /as\s+a\s+result\s+of\b/i, /for\s+certain\s+subsidiaries\b/i, /for\s+specific\s+entities\b/i
3) Association windows and antecedent resolution:
   - If a facility-capacity anchor (pattern above) appears anywhere in the same sentence OR in the immediately preceding sentence, consider that dollar amount the canonical facility maximum for subsequent comparative/availability clauses. (Sentence window = ±1 sentence.)
   - Token association: when anchored, allow currency amounts in comparative clauses up to ±16 tokens from the comparative phrase to be treated as referencing the stated cap.
4) Precedence decision flow (apply in order):
   a) If numeric is currency AND explicit remaining-amount cues match (within ±8 tokens) -> assign LineOfCreditFacilityRemainingBorrowingCapacity.
   b) Else if numeric is currency AND comparative/constraint cue matches (e.g., "availability may be less than $X") AND X equals the earlier-detected facility-capacity anchor amount (or the sentence contains a nearby explicit facility-capacity anchor) -> assign LineOfCreditFacilityMaximumBorrowingCapacity (the phrase is comparing to the contractual cap or describing effective cap reductions).
   c) Else if numeric is currency AND comparative/constraint cue matches BUT no prior anchor exists: if clause contains constraint markers ('as a result of', 'for certain subsidiaries', 'for specific entities', 'may be less than') prefer MaximumBorrowingCapacity (treat as described cap limit) but mark as 'ambiguous-availability-without-anchor' and log for review.
   d) Else if numeric is currency AND no comparative/anchor cues but lexical 'availability' appears alone (no 'amount available', no 'totaled') -> treat as ambiguous: do NOT auto-assign RemainingBorrowingCapacity; instead prefer MaximumBorrowingCapacity only if a facility-capacity anchor exists in same or previous sentence; otherwise flag for human review.
5) Tie-breaker and override: facility-capacity anchor presence overrides the naive 'availability -> remaining' rule. Explicit remaining-amount lexical patterns override capacity mapping and must map to RemainingBorrowingCapacity regardless of anchors.
6) Examples / unit-tests (add to targeted suite):
   - "The Company has a $75 million revolving credit facility (credit facility)" -> $75 million = LineOfCreditFacilityMaximumBorrowingCapacity.
   - "availability under this credit facility may be less than $75 million as a result of outstanding letters of credit..." -> $75 million = LineOfCreditFacilityMaximumBorrowingCapacity (because X matches stated cap and clause is comparative/constraint).
   - "an outstanding letter of credit under the credit facility totaled $12.5 million and the amount available under the facility totaled $62.5 million" -> $12.5M = LettersOfCreditOutstandingAmount; $62.5M = LineOfCreditFacilityRemainingBorrowingCapacity (explicit remaining-amount cue).
   - "availability under the facility may be less than $40 million" (no prior stated cap mentioned) -> flag 'ambiguous-availability-without-anchor' and queue for human review (do not auto-assign RemainingBorrowingCapacity).
7) Logging & QA: any case where 'availability' appears but the rule chooses MaximumBorrowingCapacity only because of an antecedent anchor must be logged as 'availability-referenced-cap' with the anchor span and numeric comparison; ambiguous/no-anchor cases must be logged as 'ambiguous-availability' and added to training data.
8) Implementation notes: incorporate these checks before any generic lexical mapping that equates 'availability' -> remaining capacity; add unit-tests above and regressions that ensure 'amount available' still maps to RemainingBorrowingCapacity.
[ctx-00011] helpful=0 harmful=0 :: Interest-rate 'per annum' -> DebtInstrumentInterestRateStatedPercentage (atomic heuristic): - Purpose: map percentages expressed as annual/stated interest rates on named debt instruments to DebtInstrumentInterestRateStatedPercentage. - Exact lexical cues (case-insensitive regexes): /(per\s+annum|per\s+year|annually|annual\s+rate|%\s+per\s+annum|APR)\b/ and instrument anchors: /\b(note|notes|loan|loans|seller\s+note|senior\s+notes|term\s+loan|revolver|debt\b)/i. - Association window: require both a percentage token and at least one instrument-anchor token in the same sentence OR instrument-anchor within the previous sentence (±1 sentence). If instrument name present in same sentence, require token-distance <= 12 tokens; if in prior sentence, allow <= 40 token span across sentence boundary. - Precedence: If 'per annum' (or equivalent) is detected within ±3 tokens of the percentage, prefer DebtInstrumentInterestRateStatedPercentage over spread/basis tags. - Conflict rule: If both 'margin'/'spread' cues and 'per annum' cues are present, prefer 'per annum' -> stated-rate mapping, but log as 'rate-vs-spread-conflict' for QA. - Unit-tests/examples: - "8% per annum on the Seller Notes" -> 8% = DebtInstrumentInterestRateStatedPercentage (anchor 'Seller Notes'). - "The interest rate is 5.00% per year on the term loan" -> 5.00% = DebtInstrumentInterestRateStatedPercentage. - Implementation note: apply before generic percentage-to-spread fallbacks.
[ctx-00012] helpful=0 harmful=0 :: Monetary 'interest charges' mapping to instrument-specific InterestExpenseDebt (atomic heuristic): - Purpose: ensure currency amounts described as interest charges/interest expense tied to a particular note/loan map to InterestExpenseDebt (and are linked to the instrument identity) rather than a generic InterestExpense tag. - Exact lexical cues (case-insensitive regexes): /interest\s+charge(s)?\b/, /interest\s+expense(s)?\b/, /interest\s+cost(s)?\b/, /(interest\s+charges)\s+associated\s+with/, /interest\s+relating\s+to/, /interest\s+on\s+the\s+(?:note|notes|loan|loan\s+agreement)/i. - Association policy: require a currency token (e.g., $179,507) in same sentence and an instrument anchor (note/loan name like 'Seller Notes') in same sentence OR previous sentence. Primary token-distance window = ±12 tokens around numeric; allow ±1 sentence antecedent resolution with span <= 40 tokens. - Precedence: instrument-specific InterestExpenseDebt overrides generic InterestExpense when instrument anchor present. If instrument anchor not present, map to generic InterestExpense and flag 'interest-amount-no-instrument' for review. - Unit-tests/examples: - "$179,507 of interest charges associated with the Seller Notes for the year" -> $179,507 = InterestExpenseDebt (linked to Seller Notes). - "$331,397 of interest expense for the six months ended June 30 related to the Term Loan" -> $331,397 = InterestExpenseDebt. - Logging: record sentence span and instrument anchor for any instrument-linked interest mapping for traceability.
[ctx-00013] helpful=0 harmful=0 :: Customer-concentration percentage mapping -> ConcentrationRiskPercentage1 (atomic heuristic): - Purpose: map percentages that quantify customer concentration of revenues to ConcentrationRiskPercentage1. - Exact lexical cues/patterns (case-insensitive regexes): /(?:two|three|top|largest|the\s+two\s+largest|the\s+largest)\s+customers\b/, /customer\s+concentration\b/, /accounts?\s+for\s+about|accounted\s+for\s+approximately|accounted\s+for\s+|represent(s|ed)\s+approximately\s+\d+\%/i. Percentage capture window: detect percentage token within ±10 tokens of customer/revenue cue and/or the phrase 'of (our|the)? revenues' or 'of revenue'. - Precedence: when percentage is explicitly tied to 'customers' + 'revenues', map to ConcentrationRiskPercentage1 even if other percentage-tag candidates exist. - Unit-tests/examples: - "Our two largest customers accounted for approximately 44% of our revenues" -> 44% = ConcentrationRiskPercentage1. - "The largest customer represented 22% of revenue" -> 22% = ConcentrationRiskPercentage1. - Ambiguity handling: if percent lacks 'customer' anchor but 'of revenues' alone appears, mark as potential concentration and log for human review.
[ctx-00001] helpful=0 harmful=0 :: Equity / Plan lexical-to-tag atomic rules (exact cues + variants). Purpose: deterministically map par-value, shares-outstanding, plan-availability and plan-authorized numeric tokens to the most specific US GAAP tag. Rules (apply in order):
1) Par/Stated value per share -> CommonStockParOrStatedValuePerShare
   - Exact lexical cues (case-insensitive regex examples): /\$?\s*[0-9]{1,3}(?:[\,\d]*)(?:\.\d+)?\s*(?:per|par)\s+share(s)?\b/, /par\s+value\s+of\s+\$?\s*[0-9.,]+\b/, /stated\s+value\s+per\s+share\b/.
   - Association window: numeric token and 'per share'/'par value' cue must co-occur in the same sentence and lie within ±8 tokens.
   - Precedence: if matched, assign CommonStockParOrStatedValuePerShare regardless of other nearby 'price' or 'per share' generic sale cues.
   - Unit-tests: '$0.001 par value per share' -> CommonStockParOrStatedValuePerShare = 0.001; 'stated value per common share of $0.01' -> CommonStockParOrStatedValuePerShare = 0.01.

2) 'Shares outstanding' -> CommonStockSharesOutstanding
   - Exact lexical cues: /shares\s+outstanding\b/, /outstanding\s+shares\b/, /shares\s+were\s+outstanding\b/.
   - Association window: numeric token within ±8 tokens of the cue; sentence-level anchor required.
   - Precedence: this tag wins over generic 'shares issued' or offering tags when 'outstanding' is present and no offering/underwriter cues are present in ±1 sentence.
   - Unit-tests: '28,026,713 shares outstanding' -> CommonStockSharesOutstanding = 28,026,713.

3) Plan context: map plan-specific share counts to plan tags
   - Plan-anchor detection (case-insensitive): /(?:long[- ]term incentive plan|2014\s+Long\s+Term\s+Incentive\s+Plan|LTIP|stock\s+plan|equity\s+compensation\s+plan)\b/ (allow named-year or 'the Plan' with antecedent resolution from prior sentence).
   - If plan-anchor present in same sentence OR immediately preceding sentence (±1 sentence) then apply plan-specific mappings:
     a) 'available'/'remain available' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant
        - Cues: /available\s+.*?shares|remain\s+available|shares\s+available\s+for\s+grant\b/; numeric token within ±8 tokens maps to that tag.
     b) 'maximum number' / 'may be delivered' / 'authorized' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized
        - Cues: /maximum\s+number\s+of\s+shares|may\s+be\s+delivered\s+.*?is\s+\$?\s*[\d,]+|authorized\s+to\s+issue\s+up\s+to\s+\$?\s*[\d,]+\b/, numeric token maps to Authorized tag.
   - Token association: allow antecedent plan-name in previous sentence when 'the Plan' or year-named plan is used; antecedent span <= 40 tokens across sentence boundary.
   - Precedence: plan-specific tags override generic share tags (e.g., StockIssuedDuringPeriodSharesNewIssues, SaleOfStockNumberOfSharesIssuedInTransaction) whenever the plan-anchor is detected.
   - Unit-tests: 'no shares remain available under the 2014 Long Term Incentive Plan' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant = 0; 'maximum number of shares that may be delivered under the plan is 15,000,000' -> ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized = 15,000,000.

4) Association & ambiguity handling
   - If both a plan-anchor and offering/underwriter cues are present, prefer plan-specific mappings for availability/authorized fields and issuance-specific mappings for issuance events; log any example where plan-anchor and issuance-anchor both score >0 as 'plan-vs-issuance-overlap' for human review.
   - If no plan-anchor is found but text uses 'available under the plan' with an antecedent plan name earlier in document >1 sentence away, require human-review flag (do not auto-assign) unless antecedent resolution confidence >= threshold.

5) Implementation notes
   - Apply these rules before generic 'per share' or 'shares' fallbacks; add unit-tests above and log 'plan-availability-zero' cases for QA traceability.
[ctx-00003] helpful=1 harmful=0 :: Atomic rule: Map 'LIBOR plus X%' (and close variants) -> DebtInstrumentBasisSpreadOnVariableRate1. - Purpose: avoid misinterpreting 'LIBOR plus X%' as an absolute stated interest rate. - Exact lexical patterns (case-insensitive regexes): /(LIBOR|ABR|an? index)\s*(?:\+|plus|\+/-|\band\s+an?\s+adjusted\s+rate|with\s+a\s+margin\s+of)\s*([0-9]+(?:\.[0-9]+)?\s*%)/i and /(?:margin|spread)\s*(?:of)?\s*([0-9]+(?:\.[0-9]+)?\s*%)\s*(?:over|above|to|on)\s*(LIBOR|ABR|index)/i. - Token association: require percentage token within ±3 tokens of LIBOR/ABR or 'plus'/'over' lexical cue; allow antecedent instrument references in same sentence or previous sentence ±1 if needed for linking. - Precedence/tie-breaker: If both 'per annum'/'per year'/'annual' occurs within ±3 tokens of the percentage, prefer DebtInstrumentInterestRateStatedPercentage only if there is explicit 'per annum' + instrument-anchor; otherwise prefer DebtInstrumentBasisSpreadOnVariableRate1 for 'LIBOR plus X%' forms. - Unit-tests (atomic examples): - 'LIBOR plus 4.15%' -> 4.15% = DebtInstrumentBasisSpreadOnVariableRate1. - 'the margin ranges from 1.00% to 2.00% in the case of LIBOR loans' -> both percents = DebtInstrumentBasisSpreadOnVariableRate1. - 'interest rate of 4.15% per annum' -> 4.15% = DebtInstrumentInterestRateStatedPercentage (not a spread). - Logging: any mapping where both 'margin/spread' and 'per annum' cues are within ±3 tokens should be logged as 'rate-vs-spread-conflict' with spans for QA and unit-test augmentation. - Implementation note: apply this rule before generic percentage-to-interest fallbacks and add targeted regression tests for 'plus/over' surface forms.
[ctx-00005] helpful=1 harmful=0 :: Atomic lexical rule: map 'borrowing base' -> LineOfCreditFacilityRemainingBorrowingCapacity (alias: LineOfCreditFacilityCurrentBorrowingCapacity).
- Exact lexical cues (case-insensitive regexes): /\bborrowing\s+base\b/, /\bamount(?:s)?\s+available\s+to\s+borrow\b/, /\bavailable\s+borrowing\s+capacity\b/, /\bamount\s+available\s+under\s+the\s+(?:credit\s+)?facility\b/.
- Association window: numeric token must lie within ±8 tokens of the cue in the same sentence; allow antecedent plan/facility name resolution in previous sentence (±1 sentence) if anchor span <= 40 tokens.
- Precedence rules (apply in order):
  1) If a cue above matches -> assign LineOfCreditFacilityRemainingBorrowingCapacity for the nearest numeric currency token (override generic 'capacity' or 'availability' fallbacks).
  2) If the same sentence explicitly contains 'maximum', 'commitment', 'up to', 'in an aggregate principal amount of', or similar contractual-cap cues within ±8 tokens of a different currency token -> assign those tokens to LineOfCreditFacilityMaximumBorrowingCapacity (do NOT remap borrows labeled explicitly as 'maximum').
  3) If a single sentence contains both a 'borrowing base' cue and a 'maximum/commitment' cue with two different currency tokens, map each numeric to the cue it is adjacent to (token-distance); if one numeric token is within distance of both cues, prefer the 'borrowing base' -> RemainingBorrowingCapacity mapping for that numeric and log as 'borrowbase-vs-commitment-conflict'.
  4) If only the word 'capacity' or 'availability' appears without an explicit 'borrowing base' or 'amount available' phrasing, defer to existing availability-vs-capacity rules (ctx-00009 / err-00010) and require anchor-checks; do NOT treat 'capacity' alone as proof of remaining-amount.
- Ambiguity handling: if 'borrowing base' appears but no numeric token in ±8 tokens, flag 'borrowing-base-no-amount' for review (do not guess). If numeric present but sentence contains conflicting language (e.g., 'borrowing base' and 'maximum' both adjacent to the same numeric), map to RemainingBorrowingCapacity and log conflict for QA.
- Unit-tests (atomic examples to add):
  - "The borrowing base under the credit facility is $425.0 million." -> $425.0M = LineOfCreditFacilityRemainingBorrowingCapacity.
  - "An amount available under the facility totaled $62.5 million" -> $62.5M = LineOfCreditFacilityRemainingBorrowingCapacity.
  - "Revolving credit facility in an aggregate principal amount of up to $225.0 million; the borrowing base available is $150.0 million" -> $225.0M = LineOfCreditFacilityMaximumBorrowingCapacity; $150.0M = LineOfCreditFacilityRemainingBorrowingCapacity.
  - "Availability under this credit facility may be less than $75 million as a result of outstanding letters of credit" (and $75M equals prior stated cap) -> follow comparative-rule in ctx-00009 (map to MaximumBorrowingCapacity), but if 'borrowing base' is used instead of 'availability' and tied to $75M map to RemainingBorrowingCapacity.
- Logging & QA: record mapping span with label 'borrowing-base-mapped' including cue span, numeric span, and antecedent facility anchor. Add 'borrowbase-vs-commitment-conflict' and 'borrowing-base-no-amount' to review queues for retraining.
[ctx-00001] helpful=0 harmful=0 :: Atomic heuristic: Distinguish 'Level X' mentions from explicit fair-value measurements; prefer carrying/balance tags for point-in-time VIE/note balances.
- Purpose: avoid mis-mapping numeric tokens adjacent to 'Level 3' (or Level 1/2) to DebtInstrumentFairValue unless the sentence explicitly states a fair-value measurement. Prefer DebtInstrumentCarryingAmount when amounts are presented as balances, as-of/date snapshots, or VIE/note balance listings.
- Exact lexical cues (case-insensitive):
  - Fair-value explicit cues (require one to justify DebtInstrumentFairValue): /fair value\b/, /measured at fair value\b/, /carried at fair value\b/, /estimated fair value\b/, /fair-value measurement\b/, /at fair value\b/.
  - Level-hierarchy cues (do NOT by themselves imply fair value): /level\s*[123]\b/, /level\s+3\b/, /level\s+1\b/, /level\s+2\b/.
  - Balance / carrying cues (favor DebtInstrumentCarryingAmount): /as of\s+[A-Za-z0-9,]+/, /at\s+(?:December|September|June|March|March|\d{1,2},\s*\d{4})/, /at\s+[A-Za-z0-9\-]+\b/, /at\s+September\s+30,?\s+\d{4}/i, /the\s+balance(s)?\s+as\s+of\b/, /included\s+at\s+/, /comprised\s+of\b/, /carrying\s+amount\b/, /carried\s+amount\b/, /balance\s+sheet\s+balance\b/, /at\s+the\s+end\s+of\s+the\s+period\b/.
  - VIE / note-listing cues (favor CarryingAmount when present): /variable\s+interest\s+entity\b/, /VIE\b/, /vies?\b/, /consolidated\s+v?ie\b/, /nonconsolidated\s+v?ie\b/, /the\s+following\s+table\s+shows\b/, /the\s+following\s+balances\b/, /included\s+in\s+the\s+consolidated\s+balance\s+sheet\b/.
- Association & token-window policy:
  - Require existence of an explicit fair-value cue within ±8 tokens of the numeric token (same sentence) to map to DebtInstrumentFairValue when a Level-X cue also appears; Level-X alone must NOT trigger fair-value mapping.
  - If a balance/date cue or a VIE/note-listing cue appears in the same sentence or within the immediately preceding sentence (±1 sentence antecedent resolution allowed, span <= 40 tokens), then treat the numeric token as a carrying/balance amount and map to DebtInstrumentCarryingAmount.
  - If both fair-value explicit cue and carrying/date/VIE-listing cue co-occur, prefer explicit fair-value language for DebtInstrumentFairValue, but log as 'fairvalue-vs-carrying-conflict' (include spans).
- Precedence (apply in order):
  1) If fair-value explicit cue present (±8 tokens) -> DebtInstrumentFairValue.
  2) Else if balance/date cue OR VIE/note-listing cue present (same sentence OR previous sentence antecedent within span limit) -> DebtInstrumentCarryingAmount.
  3) Else if only Level-X present without fair-value explicit cue -> DO NOT map to DebtInstrumentFairValue; mark as 'level-only-ambiguous' and either map conservatively to DebtInstrumentCarryingAmount if other carrying-structure words exist (e.g., 'balances', 'as of') or flag for human review.
- Ambiguity handling & logging:
  - Any mapping decision where 'Level' appears but no explicit fair-value cue should be logged with label 'level-only-ambiguous' including numeric span, 'Level' span, and surrounding sentence for QA and training.
  - Any mapping where both explicit fair-value cues and balance/date cues appear must be logged as 'fairvalue-vs-carrying-conflict' with spans.
- Unit-tests / minimal examples to add (atomic):
  - "At September 30, 2017, the variable interest entity had assets of $297 and $305 included in 'Level 3 instruments'." -> $297, $305 = DebtInstrumentCarryingAmount (note-listing + as-of date cues), NOT DebtInstrumentFairValue.
  - "The fair value of the instruments, which are Level 3, was $297 at September 30, 2017." -> $297 = DebtInstrumentFairValue (explicit 'fair value' present).
  - "Level 3 instruments included amounts of $10 and $12." -> flag 'level-only-ambiguous' for review (do not auto-assign DebtInstrumentFairValue); if surrounding sentence shows 'included in the balance sheet as of' map to CarryingAmount.
  - "For VIEs, carrying amounts as of December 31 were $X and $Y" -> map to DebtInstrumentCarryingAmount.
- Implementation notes: place this rule before any blanket 'Level X -> fair value' fallback; ensure classifier/regression tests penalize mapping to DebtInstrumentFairValue unless explicit fair-value cues are present. Record all 'level-only-ambiguous' examples into a retraining dataset.
[ctx-00003] helpful=0 harmful=0 :: Atomic rule: map 'letters of credit' currency phrases -> LettersOfCreditOutstandingAmount (override facility-capacity fallbacks)

Purpose: deterministically map currency amounts that quantify letters of credit (available / outstanding / aggregate) to LettersOfCreditOutstandingAmount (or the taxonomy's letters-of-credit outstanding/available tag) and avoid mis-mapping them to LineOfCreditFacilityMaximumBorrowingCapacity or RemainingBorrowingCapacity.

Exact lexical cues (case-insensitive regexes and phrase forms): /letters?\s+of\s+credit\b/, /letters?\s+of\s+credit\s+in\s+an\s+aggregate\s+amount\s+of\s+up\s+to\b/, /letters?\s+of\s+credit\s+outstanding\b/, /are\s+available\s+.*letters?\s+of\s+credit\b/, /available\s+letters?\s+of\s+credit\b/.

Association & token-window policy:
- Primary association window: numeric currency token must lie within ±8 tokens of a 'letters of credit' cue in the same sentence.
- Antecedent resolution: allow the named facility or 'the facility' antecedent in the immediately preceding sentence (±1 sentence) only for linking facility anchors but do NOT allow that antecedent to override the letters-of-credit mapping.

Precedence & decision flow (apply before generic 'availability' -> remaining/capacity fallbacks):
1) If numeric is currency AND a 'letters of credit' cue matches (primary window) -> assign LettersOfCreditOutstandingAmount (treat currency as letters-of-credit outstanding/available amount).
2) This mapping overrides any generic facility-capacity mapping (LineOfCreditFacilityMaximumBorrowingCapacity) or generic availability mapping (LineOfCreditFacilityRemainingBorrowingCapacity) when the 'letters of credit' cue is present and within the association window.
3) If the same sentence contains both a facility-capacity cue (e.g., 'in an aggregate principal amount of up to $X') and a separate 'letters of credit' cue with a different numeric, map each numeric to the adjacent cue by token-distance. If a single numeric token is within distance of both cues, prefer the 'letters of credit' mapping and log the conflict as 'letters-credit-vs-facility-conflict'.

Conflict handling & ambiguity:
- If 'letters of credit' appears but no currency numeric within ±8 tokens, flag 'letters-credit-no-amount' for review (do not infer amount from facility cap).
- If the sentence says 'amount available under the facility totaled $X' and separately lists 'letters of credit outstanding totaled $Y', map X -> RemainingBorrowingCapacity and Y -> LettersOfCreditOutstandingAmount per cues.

Unit-tests / minimal examples to add (atomic):
- "Letters of credit in an aggregate amount of up to $30 million are also available..." -> $30,000,000 = LettersOfCreditOutstandingAmount.
- "allow borrowings of up to $750 million under the revolver" -> $750,000,000 = LineOfCreditFacilityMaximumBorrowingCapacity (existing rules); ensure no cross-mapping when both phrases present.
- "An outstanding letter of credit under the credit facility totaled $12.5 million" -> $12,500,000 = LettersOfCreditOutstandingAmount.

Logging & QA: every automatic letters-of-credit mapping must be logged with label 'letters-credit-mapped' including cue span, numeric span, sentence index, and any preceding facility-anchor span; conflicts logged as 'letters-credit-vs-facility-conflict'.

Implementation note: insert this rule into the pipeline before the generic availability/capacity rules (ctx-00009 / ctx-00008) so that explicit 'letters of credit' cues win deterministically.
[ctx-00004] helpful=0 harmful=0 :: Atomic lexical-to-tag rule: map 'useful life(s)' / 'depreciable assets' -> PropertyPlantAndEquipmentUsefulLife
- Exact lexical cues (case-insensitive regex examples): /useful\s+life(s)?\b/, /estimated\s+useful\s+life(s)?\b/, /depreciable\s+asset(s)?\b/, /depreciable\s+life(s)?\b/, /useful\s+lives\s+of\s+our\s+depreciable\s+assets\b/. 
- Association window: numeric token (years) must co-occur in the same sentence within ±8 tokens of a cue; allow numeric ranges (e.g., 'range from 3 to 7 years' capture both endpoints). Recognize 'years' or 'yrs' and plain integers when context indicates time units. 
- Precedence: this mapping overrides any generic 'asset life' or 'term' tags and overrides generic percentage/amount heuristics. If multiple numeric years are present, map each numeric endpoint to PropertyPlantAndEquipmentUsefulLife (create two annotations if taxonomy allows ranges). 
- Antecedent resolution: allow plan/instrument mention in previous sentence if the current sentence uses anaphora ('those depreciable assets', 'these assets'); allow antecedent span across ±1 sentence up to 40 tokens only if anaphor present. 
- Ambiguity handling: if 'life' appears but no unit (years) or no explicit 'depreciable'/'asset' anchor, flag as 'useful-life-no-unit' for review rather than assigning numeric tag. 
- Unit-tests/examples: 
  - 'The estimated useful lives of our depreciable assets range from 3 to 7 years.' -> 3, 7 = PropertyPlantAndEquipmentUsefulLife.
  - 'We depreciate equipment over useful lives of five years.' -> 5 = PropertyPlantAndEquipmentUsefulLife.
- Logging: record anchor span, numeric span, and whether mapping was range/single-year for QA.
[ctx-00005] helpful=0 harmful=0 :: Atomic instrument-specific exercise-price rule: map 'exercise price' + warrant/right -> ClassOfWarrantOrRightExercisePriceOfWarrantsOrRights1 (and disambiguate from options/generic per-share price)
- Exact lexical cues (case-insensitive regex examples): /exercise\s+price\b/, /exercise\s+price\s+per\s+share\b/, /exercise\s+price\s+of\s+the\s+warrant(s)?\b/, /warrant(s)?\b/, /right(s)?\s+to\s+purchase\b/, /rights?\s+to\s+acquire\b/, /Class\s+of\s+Warrant/i. 
- Association window: require 'warrant'/'right' anchor in same sentence OR antecedent in previous sentence (±1 sentence, span <= 40 tokens) and a numeric currency token within ±8 tokens of the 'exercise price' phrase. Accept both '$X.XX' and bare numeric price tokens when 'per share' or 'per depositary share' present. 
- Disambiguation: if the instrument anchor is 'option' (\boption(s)?\b) map to the option-specific exercise-price tag if present in taxonomy; if taxonomy lacks an option tag, flag for human review but do NOT map to the warrant-specific tag. 
- Precedence/tie-breaker: when 'exercise price' + 'per share' co-occurs with a warrant/right anchor, prefer ClassOfWarrantOrRightExercisePriceOfWarrantsOrRights1 over any generic SaleOfStockPricePerShare or PricePerShare tag. Instrument-anchor detection must run before generic per-share mapping. 
- Antecedent resolution rules: if the sentence contains anaphora ('the warrants', 'these rights') and previous sentence defined 'warrants' or 'rights', allow cross-sentence mapping under same ±1-sentence rule. 
- Ambiguity handling: if 'exercise price' + 'per share' appears but no explicit instrument anchor (no 'warrant'/'right'/'option' word in ±1 sentence), do NOT auto-assign a warrant-specific tag; instead mark as 'exercise-price-no-instrument' for human review or apply semantic classifier with low confidence threshold. 
- Unit-tests/examples: 
  - 'The exercise price of the warrants is $5.00 per share.' -> $5.00 = ClassOfWarrantOrRightExercisePriceOfWarrantsOrRights1.
  - 'Rights to purchase common stock have an exercise price of $2.50 per share.' -> $2.50 = ClassOfWarrantOrRightExercisePriceOfWarrantsOrRights1.
  - 'We issued options with an exercise price of $1.20 per share' -> map to option-exercise-price tag (or flag if option tag missing). 
- Logging: record instrument-anchor span, 'exercise price' span, numeric span, antecedent sentence index and mapping decision (including 'declined-to-map' when anchor absent).
[ctx-00007] helpful=0 harmful=0 :: Atomic heuristic: Specificity-first mapping for contract/customer revenues -> RevenueFromContractWithCustomerExcludingAssessedTax

Purpose: Prevent blanket-mapping of any 'revenues' phrase to the generic Revenues tag when the phrase actually denotes revenue arising from contracts with customers (excluding assessed tax), e.g., 'reimbursable revenues', 'customer revenues', 'segment revenues', or construction/contract billing amounts.

Exact lexical cues (case-insensitive regexes and variants):
- /\breimbursable\s+revenue(s)?\b/
- /\brevenue(s)?\s+from\s+(?:contracts?\s+with\s+customers|customers?)\b/
- /(?:revenue|revenues)\s+from\s+customers?\b/
- /(?:customer|contract|segment|segmental)\s+revenue(s)?\b/
- /constitut(?:e|ed)\s+approximately\s+\d{1,3}(?:\.\d+)?%\s+of\s+our\s+total\s+consolidated\s+revenues/  (composition anchor)
- /excluding\s+assessed\s+tax/i (explicit 'excluding' qualifier)

Association & token-window policy:
- Primary association window: match lexical cue within the same sentence and associate the nearest currency numeric token that lies within ±8 tokens of the cue or within the same clause.
- Antecedent resolution: allow antecedent anchor in the immediately preceding sentence (±1 sentence) when anaphora such as 'these revenues', 'such revenues', or 'the reimbursable amounts' is used; cross-sentence span limited to <= 40 tokens and require explicit referential pronoun/anchor.
- Percentage confirmation: if a percentage token describing composition (e.g., 'constituted approximately 23.6 percent of our total consolidated revenues') appears in the same sentence and a currency token is also present, use the composition anchor to link the currency amount to customer/contract revenue tag.

Precedence and tie-breakers (apply in order):
1) If any of the contract/customer lexical cues match within window -> assign RevenueFromContractWithCustomerExcludingAssessedTax (or the most specific contract-customer revenue tag available) to the nearest currency numeric token.
2) If the sentence contains both a contract/customer cue and a generic 'revenues' cue, prefer the contract/customer tag.
3) If multiple contract-customer-like tags are possible (e.g., both 'segment revenue' and a narrower 'RevenueFromContractWithCustomerExcludingAssessedTax' exist), prefer the most specific taxonomy tag that explicitly mentions 'contract' or 'customer' and/or includes 'excluding assessed tax' when 'excluding' present.
4) Only fallback to generic Revenues when NO contract/customer cue is present within the association windows and no antecedent resolution links the numeric to a contract/customer anchor.

Conflict & ambiguity handling:
- If both a contract/customer cue and an unrelated revenue-like cue (e.g., 'non-operating revenues') are within window, prefer contract/customer mapping only when token-distance score (1/(1+distance)) + specificity bonus exceeds the other cue's score; otherwise flag as 'revenue-cue-conflict' for human review.
- If 'reimbursable' appears but no currency numeric within ±8 tokens, flag 'reimbursable-no-amount' for review (do not infer amount from nearby generic 'revenues' tokens across long spans).

Logging & QA:
- Log every automatic assignment to RevenueFromContractWithCustomerExcludingAssessedTax with spans for the lexical cue, numeric token, and any percent-composition token used to confirm mapping.
- Add 'revenue-specificity-fallback' entries when fallback to generic Revenues occurs despite presence of ambiguous cues, to be included in retraining batches.

Unit-tests / minimal examples to add (atomic):
1) 'Excluding reimbursable revenues of $39.9 million, ENL constituted approximately 23.6 percent of our total consolidated revenues...' -> $39.9M = RevenueFromContractWithCustomerExcludingAssessedTax; 23.6% = ConcentrationRiskPercentage1.
2) 'Reimbursable revenues of $12.5 million were billed to the customer under the contract.' -> $12.5M = RevenueFromContractWithCustomerExcludingAssessedTax.
3) 'Segment revenues from our European customers totaled $45 million.' -> $45M = RevenueFromContractWithCustomerExcludingAssessedTax (segment + customer anchor).
4) 'Total revenues were $1.2 billion; other operating income was $5 million.' -> $1.2B = Revenues (generic) (no contract/customer cue present).

Implementation notes:
- Insert this rule prior to any generic 'revenues' -> Revenues lexical fallback.
- Ensure the regexes and association windows are applied before coarse classifier decisions that prefer generic tags.
- Capture mapping decisions as structured logs for traceability and to generate counterexamples for retraining when false positives/negatives are found.
[ctx-00008] helpful=0 harmful=0 :: Atomic unit-driven disambiguation: share-count vs monetary-amount mapping (repurchases & issuance contexts)
- Purpose: when a sentence contains both a shares-count token and a currency token, deterministically map the shares-count numeric to a shares-count tag and the currency numeric to a monetary tag; avoid conflation. 
- Exact lexical/unit cues (case-insensitive regexes): /\bshare(s)?\b/, /\bcommon\s+share(s)?\b/, /\bordinary\s+share(s)?\b/, /\bmillion\s+shares\b/, /\bthousand\s+shares\b/. Currency detection: /\$|dollars|EUR|£|USD|\bmillion\b|\bbillion\b/. Repurchase cues: /repurchas(e|ed|ing)|purchas(e|ed|ing)\s+(back)|repurchase\s+program|bought\s+back/i. 
- Association windows: primary window = ±8 tokens around each numeric token to detect unit anchors; sentence-level scan to find both share-unit and currency-unit occurrences. 
- Precedence & decision flow (apply in order): 1) If a numeric token has a nearby share-unit cue -> assign share-count tag appropriate to transaction context (e.g., StockRepurchasedDuringPeriodShares or StockIssuedDuringPeriodSharesNewIssues if issuance/underwriter cues present). 2) If a different numeric token in same sentence has a nearby currency cue -> assign the monetary variant (e.g., StockRepurchasedDuringPeriodAmount or PaymentsToAcquireBusinessesGross). 3) If a single numeric token is adjacent to both a share-unit and currency token (ambiguous forms like '1.9 million Common Shares ($381 million)') -> split mapping: assign the numeric with 'shares' unit to shares-count tag; assign the adjacent currency numeric to monetary tag. 4) If classifier suggests mapping a currency numeric to a shares-count tag solely because 'share' appears elsewhere in sentence, override classifier and prefer unit-specific mapping; log override. 
- Tie-breaker: instrument/transaction anchors (repurchase/underwriter/offer) can escalate which shares-tag to choose (repurchase -> StockRepurchasedDuringPeriodShares; offering/underwriter -> StockIssuedDuringPeriodSharesNewIssues). 
- Unit-tests/examples to add:  - 'The company purchased 1.9 million Common Shares for $381 million under the repurchase program.' -> 1.9M = StockRepurchasedDuringPeriodShares; $381M = StockRepurchasedDuringPeriodAmount.  - 'We issued 5,000,000 shares at $10 per share in the offering' -> 5,000,000 = StockIssuedDuringPeriodSharesNewIssues; $10 (per share) = IssuancePrice/PricePerShare tag.  - 'Purchased 2 million shares' (no currency) -> 2M = StockRepurchasedDuringPeriodShares. 
- Logging: record unit spans (share-word span and currency span), numeric-token ids, mapping chosen, and any classifier-vs-rule overrides under 'unit-disambiguation-override'.
[ctx-00010] helpful=0 harmful=0 :: Atomic heuristic: Prefer generic Revenues for headline income-statement amounts; reserve RevenueFromContractWithCustomer... for explicit contract-accounting contexts.

Purpose: Prevent overapplication of contract-specific revenue tags when amounts are presented as top-line/period-line items in condensed/consolidated statements of income or in table rows that function as headline revenue lines.

Exact positive headline cues (case-insensitive regexes):
- /\bcondensed consolidated statement of (income|operations)\b/;
- /\bfor the (three|six|nine|twelve) months? (and|ended|ended\s+on)\b/;  // period-ended row context
- /\b(total|totaled|totalled|total revenues|net revenues|revenues were|revenues of)\b/;
- row/table header patterns: /\b(revenues|total revenue|net revenue|sales)\b/ appearing in a table-row/line-item context (same sentence or immediately preceding heading sentence).

Contract-accounting explicit cues (require at least one to permit contract-specific mapping):
- /contract(s?) with customer(s?)|revenue(s?) recognized? from contracts?|performance obligation(s)?|contract asset(s)?|contract liability|deferred revenue|transaction price|recognized in accordance with ASC\s*606|under ASC 606|under Topic 606|amounts recognized on contract(s)?/i

Association & token-window policy:
1) If a currency numeric token appears in a sentence that matches any positive headline cue OR in a table/row context whose header contains 'revenues' or 'total revenues' (allow antecedent heading in previous sentence within ±1 sentence), then mark that numeric as a headline-revenue candidate.
2) If numeric is a headline-revenue candidate and no contract-accounting explicit cues are present within the same sentence or the immediately preceding sentence (±1 sentence, span <= 40 tokens), assign tag = Revenues.
3) If both headline cues and contract-accounting explicit cues co-occur, prefer contract-specific tag only when an explicit contract-accounting cue is within ±8 tokens of numeric OR the sentence includes technical contract-accounting verbs ("recognized", "deferred", "recognized from contracts", "performance obligations"). Otherwise assign Revenues and log as 'headline-overrode-contract-specific'.

Precedence / Tie-breaker:
- Apply this rule before any contract-specific revenue lexical mapping (e.g., ctx-00007). Precedence: Headline-Revenues rule (this) > Contract-specific mapping unless explicit contract-accounting cue(s) present and proximal to numeric.

Negative / exception list (do NOT map to generic Revenues when any of these are present proximate to numeric):
- presence of contract-accounting explicit cues (see list above) within ±8 tokens; or explicit phrase 'reimbursable revenues' when accompanied by contract accounting language (map to RevenueFromContractWithCustomer... if the phrase is used in the context of contract recognition guidance);
- sentences explicitly describing revenue recognition method ("recognized on a percentage-of-completion basis", "accounted for under ASC 606", "transaction price allocated to performance obligations").

Unit-tests / minimal examples to add:
- 'Includes revenues of $X and $Y for the three months and nine months ended September 30, 2017 from Pet Partners.' -> $X, $Y = Revenues (headline rule applies; 'from Pet Partners' alone is insufficient for contract-specific tag).
- 'Total revenues were $1,234 for the year ended Dec 31, 2017.' -> $1,234 = Revenues.
- 'We recognized $12.0 million of revenue from contracts with customers in the quarter under ASC 606' -> $12.0M = RevenueFromContractWithCustomerExcludingAssessedTax (contract-accounting explicit cue present).
- 'Reimbursable revenues of $39.9 million, ENL constituted approximately 23.6 percent of our total consolidated revenues' -> $39.9M = RevenueFromContractWithCustomerExcludingAssessedTax (use explicit reimbursable cue + proximate contract/accounting context); 23.6% = ConcentrationRiskPercentage1.

Logging & QA:
- Log every automatic assignment where headline rule applied but a customer/source anchor exists (label 'headline-revenues-applied'); include numeric span, headline cue span (heading or phrase), customer/source span, and whether any contract-accounting cues were present and their spans.
- Log any case where contract-specific mapping is chosen despite headline cues with label 'contract-specific-chosen-over-headline' with justification spans.

Implementation notes:
- Insert this rule prior to ctx-00007 and any generic "revenues" -> Revenues fallback. Ensure rule is used by both rule-based regex pipeline and as a high-priority feature in statistical classifiers (feature: headline-revenue-candidate boolean).
[ctx-00011] helpful=0 harmful=0 :: Atomic heuristic: Appositive and clarifier numeric resolution (handle 'or $X', 'i.e., $X', 'which equals $X'). Rules (apply before lexical-tag fallbacks): 1) Detect appositive clarifiers using patterns (case-insensitive) within the same clause: /,\s*or\s+\$?[0-9,]+(?:\.\d+)?/, /\bor\s+\$?[0-9,]+(?:\.\d+)?\b/, /\bi\.e\.?\s*\$?[0-9,]+(?:\.\d+)?\b/, /which\s+is\s+\$?[0-9,]+(?:\.\d+)?/. 2) Locate the head noun/phrase the appositive modifies by scanning left within the clause up to the nearest punctuation boundary (comma/semicolon) for candidate nouns: 'difference', 'remainder', 'amount available', 'amount available under', 'amount drawn', 'fee', 'charge', 'cost', 'spread', 'margin'. 3) Decision mapping (deterministic): - If head noun ∈ {difference, remainder, undrawn, remaining, amount available, borrowing base, amount available under the facility} -> map appositive numeric -> LineOfCreditFacilityRemainingBorrowingCapacity (or facility-specific remaining-capacity tag). - If head noun ∈ {fee, charge, commission, premium, cost} AND appositive follows a phrase that quantifies the fee ("a fee of $X was charged", "we paid $X in fees") -> map to InterestExpenseDebt (or fee-specific currency tag). - If head noun == 'difference between A and B' or 'difference' and clause references a cap or drawn amount (e.g., 'difference between $A and the amount drawn') -> map appositive numeric to the arithmetic residual semantics -> RemainingBorrowingCapacity. - If head noun ambiguous (e.g., 'amount' with no modifier) -> do not auto-map; flag 'appositive-ambiguous' for review. 4) Token-window & antecedent resolution: allow antecedent noun in previous clause/sentence only when anaphora is explicit ('the difference', 'that amount', 'that difference') within ±1 sentence and span <= 40 tokens. 5) Fee-base disambiguation rule: when sentence contains 'fee of X%' or 'fee of X% applied to [BASE]' -> the percentage maps to a fee-percent tag (if available) and the BASE numeric (including any appositive) maps to capacity/principal/remaining-capacity tag as per base semantics; do NOT map the BASE to InterestExpenseDebt merely because 'fee' appears. 6) Precedence: this appositive resolution overrides shallow lexical heuristics that map nearest numeric to 'fee' or generic expense. 7) Unit-tests / examples to add: - "a fee of 1% was applied to the difference between $20.0 million and the amount drawn, or $0.2 million" -> $0.2M = LineOfCreditFacilityRemainingBorrowingCapacity; 1% = fee-percent (not a currency InterestExpenseDebt). - "the amount drawn, or $5.0 million, was recorded" -> $5.0M -> tag determined by head noun 'amount drawn' (outstanding/borrowed tag). - "the fee, or $0.3 million, was charged" -> $0.3M = InterestExpenseDebt. 8) Logging: record appositive span, resolved head noun span, chosen tag, and antecedent resolution confidence for QA.
[ctx-00013] helpful=0 harmful=0 :: [ctx-000XX] helpful=0 harmful=0 :: Atomic rule: Map percentages that quantify portions of risk/exposure (ceded/retained/assumed) -> ConcentrationRiskPercentage1

Purpose: deterministically map percentage tokens that express a share/portion of risk, exposure, or ceded/retained/assumed amounts to the concentration/exposure-percent tag rather than generic percent tags.

Exact lexical cues (case-insensitive regexes and phrase forms):
- /\bceded\b/, /\bceding\b/, /\bportion\s+of\s+risk\b/, /\bportion\s+of\s+exposure\b/, /\bpercent(?:age)?\s+ceded\b/, /\bwas\s+ceded\b/, /\bwe\s+ceded\b/, /\bretained\b|\bretaining\b/, /\bassumed\b|\bassuming\b/, /\bof\s+the\s+exposure\b/, /\bof\s+the\s+risk\b/, /\bportion\s+ceded\b/.

Percentage detection:
- Recognize percent forms: '\\d+(?:\\.\\d+)?%','\\d+(?:\\.\\d+)? percent', numeric ranges 'from X% to Y%'.

Association & token-window policy:
- Primary association window: require a percentage token to occur within ±8 tokens of any ceded/retained/assumed/exposure/risk cue in the same sentence.
- If the cue is in the previous sentence, allow antecedent resolution (±1 sentence) only when anaphora links are present ('that risk', 'such exposure', 'that portion') and total span <= 40 tokens; otherwise require same-sentence proximity.

Decision flow & precedence (apply before generic percent tag fallbacks):
1) If numeric is a percentage AND a ceded/retained/assumed/exposure/risk cue matches within window -> assign ConcentrationRiskPercentage1.
2) If the percentage also contains other percent-candidate cues (interest, spread, stated-rate), prefer the tag whose lexical cue is nearest in token distance; if 'per annum'/'interest' cues exist within ±3 tokens prefer interest-rate tags and log 'rate-vs-exposure-conflict' for QA.
3) If both 'customer'/'revenue' and 'ceded' cues co-occur and percent quantifies portion of revenue attributable to a customer, still map to ConcentrationRiskPercentage1 (customer concentration semantics); if ambiguity remains (no 'of revenue'/'of customers'/'of exposure' anchor) flag for human review.

Normalization & examples (unit-tests to add):
- '35% of the risk was ceded to reinsurers.' -> 35% = ConcentrationRiskPercentage1.
- 'We ceded 65% of our exposure under the program.' -> 65% = ConcentrationRiskPercentage1.
- 'The two largest customers accounted for approximately 44% of our revenues' -> 44% = ConcentrationRiskPercentage1 (customer-concentration path).
- 'Interest rate of 4.15% per annum and a margin of LIBOR plus 1.25%.' -> 4.15% = DebtInstrumentInterestRateStatedPercentage; 1.25% = DebtInstrumentBasisSpreadOnVariableRate1 (rate-vs-exposure-conflict rule ensures no false mapping).

Ambiguity handling & logging:
- If no ceded/retained/assumed/exposure/risk cue found within window, do NOT auto-assign ConcentrationRiskPercentage1; fall back to other percent heuristics.
- Log every auto-assignment with label 'exposure-percent-mapped' including numeric span, matched cue span, sentence index, and antecedent resolution info for QA and retraining.

Implementation notes:
- Insert this rule at high priority before generic '%' -> generic-percentage tag fallbacks and before conflicting rules that map 'percent' to interest/spread unless those interest cues are closer/proximate.
- Add unit-tests and training examples capturing 'ceded', 'retained', 'assumed', 'portion of risk/exposure', and customer-concentration contexts to avoid collapse into generic percent tags.
[ctx-00014] helpful=0 harmful=0 :: Delta rule: Repurchase-program monetary vs treasury-stock-cost disambiguation

Purpose: deterministically map monetary amounts that describe (a) repurchase-authorizations (caps) and (b) amounts repurchased under a share repurchase program to StockRepurchaseProgramAuthorizedAmount1; reserve TreasuryStockValueAcquiredCostMethod for explicit accounting-cost statements about treasury stock.

Exact lexical anchors (case-insensitive):
- Repurchase-program anchors (map currency -> StockRepurchaseProgramAuthorizedAmount1): /repurchas(e|ed|ing)\b/, /share repurchase(?:\s+authorization|\s+program)?\b/, /authorized to repurchase up to\b/, /previously announced \$?[0-9,.]+ share repurchase authorization/, /under the (?:share )?repurchase (?:program|authorization)/, /authorization (?:to repurchase|expired)\b/, /was repurchased (?:under|pursuant to) the (?:repurchase|authorization)/i
- Treasury-stock cost anchors (map currency -> TreasuryStockValueAcquiredCostMethod only): /treasury stock[,\s]+at cost\b/, /treasury stock (?:acquired )?at an? average cost of\b/, /treasury shares (?:at cost|recorded at)\b/, /treasury stock, at cost\b/, /cost method for treasury stock\b/

Association & token-window policy:
1) Primary window: if a currency numeric appears within ±8 tokens of any repurchase-program anchor in the same sentence -> assign StockRepurchaseProgramAuthorizedAmount1 and link numeric to program identity if present.
2) Antecedent resolution: if repurchase-program anchor appears in the immediately preceding sentence (±1 sentence) and anaphora like 'the program', 'the authorization' occurs in current sentence, allow linking (max span 40 tokens) -> still map to StockRepurchaseProgramAuthorizedAmount1.
3) Treasury-stock cost mapping requires explicit treasury-stock-cost anchors within ±8 tokens of the numeric. Do NOT map to TreasuryStockValueAcquiredCostMethod solely because 'repurchased' or 'repurchase' appears.

Precedence & tie-breaker (apply before any generic monetary-to-treasury fallbacks):
- If repurchase-program anchor present (per rules above) -> StockRepurchaseProgramAuthorizedAmount1 (this covers both authorization caps and amounts repurchased under that authorization).
- Else if treasury-stock-cost anchor present -> TreasuryStockValueAcquiredCostMethod.
- If both anchor-classes appear (rare), prefer the anchor that is lexically closer to the numeric; if equidistant, prefer explicit 'repurchased under the authorization' language -> StockRepurchaseProgramAuthorizedAmount1; otherwise log for manual review.

Unit-tests / minimal examples (atomic):
- 'We repurchased approximately $234.6 million of the Company’s previously announced $275.0 million share repurchase authorization.' -> $234.6, $275.0 = StockRepurchaseProgramAuthorizedAmount1.
- 'The Board authorized a new repurchase program of $100.0 million' -> $100.0 = StockRepurchaseProgramAuthorizedAmount1.
- 'Treasury stock, at cost, totaled $45.0 million as of December 31' -> $45.0 = TreasuryStockValueAcquiredCostMethod.
- 'We repurchased $5.0 million under the program and held treasury stock at an average cost of $2.00 per share' -> $5.0 = StockRepurchaseProgramAuthorizedAmount1; $2.00 (per share, average cost) -> TreasuryStockValueAcquiredCostMethod (or related per-share treasury-cost tag if present).

Edge cases & additional guidance:
- Share-count caps (e.g., '16.3 million shares authorized under the plan') should continue to map to share-based-compensation-number-of-shares-authorized tags — do NOT map share-counts to monetary repurchase tags.
- Phrases like 'authorized to repurchase up to $X' and 'previously announced $X share repurchase authorization' are canonical cap expressions and always map to StockRepurchaseProgramAuthorizedAmount1 even if described in comparative clauses.

Logging & QA:
- Log every repurchase-program mapping with label 'repurchase-program-mapped' including numeric span, repurchase-anchor span, antecedent span (if used), chosen tag, and confidence.
- Log cases where a numeric is within windows for both repurchase-program and treasury-stock-cost anchors as 'repurchase-vs-treasury-conflict' with spans for manual review and addition to retraining data.

Implementation note:
- Insert this rule before any generic 'currency near "treasury" -> TreasuryStockValueAcquiredCostMethod' fallback and before unit-driven share-vs-currency disambiguation that might bias mapping to treasury-stock by default.
[ctx-00015] helpful=0 harmful=0 :: Title: Map amortization-of-intangible and regulatory-requested-rate revenue-impact amounts (atomic heuristics)

1) Amortization of Intangible Assets -> AmortizationOfIntangibleAssets
- Purpose: deterministically map currency numeric tokens that are explicitly described as amortization expense of intangible or amortizable intangible assets to AmortizationOfIntangibleAssets instead of generic Expense or Amortization tags.
- Exact lexical cues (case-insensitive regex examples): /amortization\s+expense(s)?\b/, /amortization\s+of\s+(?:intangible|amortizable)\s+asset(s)?\b/, /amortizable\s+intangible\s+assets?\b/, /amortization\s+related\s+to\s+intangible\s+assets?\b/, /amortization\s+expense\s+for\s+intangible\s+assets\b/.
- Association window: currency numeric token must occur within ±8 tokens of a matching cue in the same sentence or in the same clause. Allow antecedent anaphora (e.g., 'such amortization') from previous sentence only when explicit referential link exists (±1 sentence, span <= 40 tokens).
- Precedence: If an amortization-intangible cue matches, assign AmortizationOfIntangibleAssets and override any generic Expense/Amortization/OperatingExpense/OtherExpense tag candidates.
- Normalization: if phrase contains 'was $X' or 'totaled $X' map numeric to currency amount value; if phrase contains 'no amortization'/'none' normalize to zero and assign AmortizationOfIntangibleAssets = 0 (log negation span).
- Tie-breaker: if simultaneously 'amortization' and another instrument-specific expense anchor appear (rare), prefer the anchor explicitly mentioning 'intangible' for AmortizationOfIntangibleAssets; otherwise flag for review.
- Unit-tests (atomic examples):
  - 'Amortization expense for amortizable intangible assets for the year was $400,000.' -> $400,000 = AmortizationOfIntangibleAssets.
  - 'The amortization of intangible assets totaled $600,000 during the period.' -> $600,000 = AmortizationOfIntangibleAssets.
- Logging: record cue span, numeric span, antecedent span (if used), and mapping decision label 'amortization-intangible-mapped'.

2) Regulatory tariff / requested-rate revenue-impact -> PublicUtilitiesRequestedRateIncreaseDecreaseAmount
- Purpose: deterministically map numeric amounts described as the change in revenues resulting from regulatory tariff filings or requested rate changes filed with public utility commissions to PublicUtilitiesRequestedRateIncreaseDecreaseAmount instead of generic Revenues.
- Exact lexical cues (case-insensitive regex examples): /(requested\s+rate(?:s)?|requested\s+increase|requested\s+decrease|requested\s+rate\s+increase|requested\s+rate\s+decrease)\b/, /regulatory\s+tariff(s)?\b/, /filed\s+with\s+the\s+public\s+utility\s+commission(s)?\b/, /filed\s+with\s+the\s+commission\b/, /resulting\s+in\s+an?\s+(?:increase|decrease)\s+in\s+revenues\b/, /annual\s+change\s+in\s+revenues\s+resulting\s+from\b/. Also capture variants: /tariff\s+filing(s)?/, /rate\s+filing(s)?/, /requested\s+rate\s+change(s)?/.
- Association window: currency numeric token must appear in the same sentence and within ±12 tokens of a matching cue, or in the same clause if comma-separated. If the sentence text is a short appositive or parenthetical ('($5.0 million)') allow ±16 tokens but require a clear regulatory cue in sentence.
- Precedence: When regulatory/requested-rate cues match, assign PublicUtilitiesRequestedRateIncreaseDecreaseAmount and override generic Revenues, RevenueFromContractWithCustomer..., or other revenue tags. If the sentence explicitly frames the amount as 'impact', 'increase' or 'decrease' of revenues due to a rate filing, map here regardless of presence of 'revenues' word.
- Sign handling: detect lexical polarity words near cue within ±6 tokens: /increase(s)?|rise|up|benefit/ => positive impact; /decrease(s)?|decline|reduction|down|adverse/ => negative impact. Store sign metadata (positive/negative/unspecified) for downstream numeric normalization (if taxonomy supports signed values); if ambiguity exists, mark 'reg-rate-impact-ambiguous-sign'.
- Tie-breaker: if a regulatory-request cue and a generic 'total revenues' headline cue both appear, the regulatory-request cue wins only if proximate (≤12 tokens) and explicitly links the numeric to 'resulting from'/'due to' language; otherwise treat as headline Revenues (log as 'reg-vs-headline-conflict').
- Unit-tests (atomic examples):
  - 'The annual change in revenues resulting from regulatory tariff filings was $5.0 million.' -> $5.0M = PublicUtilitiesRequestedRateIncreaseDecreaseAmount (positive by 'change' neutral; if sentence includes 'increase' set positive).
  - 'The annual change in revenues resulting from requested rate changes filed with public utility commissions was $2.8 million.' -> $2.8M = PublicUtilitiesRequestedRateIncreaseDecreaseAmount.
  - 'We filed requested rate increases with the commission; the change in annual revenues is expected to be $1.2 million (increase).' -> $1.2M = PublicUtilitiesRequestedRateIncreaseDecreaseAmount, sign=positive.
- Ambiguity handling & logging: if regulator/revenue cue exists but no numeric within window -> flag 'reg-rate-no-amount' for review. Log each automatic assignment with label 'reg-rate-impact-mapped' including cue span, numeric span, sign metadata, and whether the mapping overrode a generic Revenues candidate.

Implementation notes (both rules):
- Insert these rules into the regex/heuristic pipeline before any generic 'revenues' or 'expense' fallbacks and before statistical classifier tie-breakers. Ensure unit-tests are added to the regression suite. Record all prevented-generic mappings with spans for QA and retraining.
## OTHERS
[misc-00002] helpful=0 harmful=0 :: Micro decision flow for acquisition-related monetary phrases (apply in order): 1) Search sentence (or immediate surrounding sentence ±1) for the exact phrase variants from the lexical-to-tag mapping. 2) If only one cue matches, assign the corresponding tag. 3) If multiple cues match, choose the cue whose token span is closest to the numeric amount (measure token-distance from numeric token to cue span). 4) If both cues are equidistant or no numeric amount is present, break ties by cue specificity: ('purchase price' > 'cash paid' > 'consideration'). 5) If still ambiguous, prefer PaymentsToAcquireBusinessesGross when the sentence explicitly mentions payments, cash, or amounts described as 'paid' or 'paid as part of the acquisition'; prefer BusinessCombinationConsiderationTransferred1 only when the text uses 'consideration' or explicitly 'consideration transferred' and describes the composition of consideration (e.g., cash + shares + other instruments). 6) Log ambiguous cases for human review and add the sentence to a short test-suite.